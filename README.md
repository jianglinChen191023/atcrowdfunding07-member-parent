- [åå…­ ä¼šå‘˜ç³»ç»Ÿ-æ­å»ºç¯å¢ƒ](#åå…­-ä¼šå‘˜ç³»ç»Ÿ-æ­å»ºç¯å¢ƒ)
    - [1. å°šç­¹ç½‘ä¼šå‘˜ç³»ç»Ÿæ€»ç›®æ ‡](#1-å°šç­¹ç½‘ä¼šå‘˜ç³»ç»Ÿæ€»ç›®æ ‡)
    - [2. ä¼šå‘˜ç³»ç»Ÿæ¶æ„](#2-ä¼šå‘˜ç³»ç»Ÿæ¶æ„)
        - [2.1 æ¶æ„å›¾](#21-æ¶æ„å›¾)
        - [2.2 éœ€è¦åˆ›å»ºçš„å·¥ç¨‹](#22-éœ€è¦åˆ›å»ºçš„å·¥ç¨‹)
            - [2.2.1 åˆ›å»ºçˆ¶å·¥ç¨‹](#221-åˆ›å»ºçˆ¶å·¥ç¨‹)
            - [2.2.2 åˆ›å»ºå­å·¥ç¨‹æ¨¡å—](#222-åˆ›å»ºå­å·¥ç¨‹æ¨¡å—)
            - [2.2.3 ç¡®ä¿ `github` ä¸Šé¡¹ç›®ç»“æ„çš„å®Œæ•´](#223-ç¡®ä¿-github-ä¸Šé¡¹ç›®ç»“æ„çš„å®Œæ•´)
            - [2.2.4 åˆ é™¤çˆ¶é¡¹ç›®ä¸‹çš„ `src` ç›®å½•](#224-åˆ é™¤çˆ¶é¡¹ç›®ä¸‹çš„-src-ç›®å½•)
    - [3. çˆ¶å·¥ç¨‹ç¯å¢ƒ](#3-çˆ¶å·¥ç¨‹ç¯å¢ƒ)
    - [4. `Eureka` å·¥ç¨‹](#4-eureka-å·¥ç¨‹)
        - [4.1 ä¾èµ–](#41-ä¾èµ–)
        - [4.2 ä¸»å¯åŠ¨ç±»](#42-ä¸»å¯åŠ¨ç±»)
        - [4.3 é…ç½®](#43-é…ç½®)
    - [5. `Entity` å·¥ç¨‹](#5-entity-å·¥ç¨‹)
        - [5.1 å®ä½“ç±»çš„è¿›ä¸€æ­¥ç»†åˆ†](#51-å®ä½“ç±»çš„è¿›ä¸€æ­¥ç»†åˆ†)
            - [5.1.1 `VO`](#511-vo)
            - [5.1.2 `PO`](#512-po)
            - [5.1.3 `DO`](#513-do)
            - [5.1.4 `DTO`](#514-dto)
        - [5.2 åˆ›å»ºåŒ…](#52-åˆ›å»ºåŒ…)
        - [5.3 `Lombok`](#53-lombok)
            - [5.3.1 `lombok` åŸç†](#531-lombok-åŸç†)
            - [5.3.2 `Lombok` ä¾èµ–](#532-lombok-ä¾èµ–)
    - [5. `MySQL` å·¥ç¨‹](#5-mysql-å·¥ç¨‹)
        - [5.1 ä¾èµ–](#51-ä¾èµ–)
        - [5.2 ä¸»å¯åŠ¨ç±»](#52-ä¸»å¯åŠ¨ç±»)
        - [5.3 é…ç½®](#53-é…ç½®)
        - [5.4 æµ‹è¯•ç±»](#54-æµ‹è¯•ç±»)
            - [5.4.1 æµ‹è¯• `connection`](#541-æµ‹è¯•-connection)
            - [5.4.2 æµ‹è¯• `Mapper`](#542-æµ‹è¯•-mapper)
    - [6. `Api` å·¥ç¨‹](#6-api-å·¥ç¨‹)
        - [6.1 ä¾èµ–](#61-ä¾èµ–)
        - [6.2 æ¥å£](#62-æ¥å£)
        - [6.3 `MySQL`å·¥ç¨‹å¯¹å¤–æš´éœ²æœåŠ¡](#63-mysqlå·¥ç¨‹å¯¹å¤–æš´éœ²æœåŠ¡)
            - [6.3.1 `Hnadler` ä»£ç ](#631-hnadler-ä»£ç )
            - [6.3.2 `Service` æ¥å£](#632-service-æ¥å£)
            - [6.3.3 `Service` ç±»çš„ä»£ç ](#633-service-ç±»çš„ä»£ç )
    - [7. `Redis` å·¥ç¨‹](#7-redis-å·¥ç¨‹)
        - [7.1 `Linux` è‡ªåŠ¨å®‰è£… `Redis`](#71-linux-è‡ªåŠ¨å®‰è£…-redis)
        - [7.2 Reids å‘½ä»¤åˆ—è¡¨](#72-reids-å‘½ä»¤åˆ—è¡¨)
            - [7.2.1 æŸ¥çœ‹ `Redis`](#721-æŸ¥çœ‹-redis)
        - [7.3 å·¥ç¨‹ä¾èµ–](#73-å·¥ç¨‹ä¾èµ–)
        - [7.4 ä¸»å¯åŠ¨ç±»](#74-ä¸»å¯åŠ¨ç±»)
        - [7.5 æ–°å»º `application.yml` é…ç½®](#75-æ–°å»º-applicationyml-é…ç½®)
        - [7.6 æµ‹è¯•ç±»](#76-æµ‹è¯•ç±»)
    - [8. `Redis` å·¥ç¨‹å¯¹å¤–æš´éœ²æœåŠ¡](#8-redis-å·¥ç¨‹å¯¹å¤–æš´éœ²æœåŠ¡)
        - [8.1 `API` å·¥ç¨‹](#81-api-å·¥ç¨‹)
            - [8.1.1 æ–°å»º `RedisRemoteService`æ¥å£](#811-æ–°å»º-redisremoteserviceæ¥å£)
        - [8.2 `Redis` å·¥ç¨‹](#82-redis-å·¥ç¨‹)
            - [8.2.1 å¯¹å¤–æš´éœ²æœåŠ¡ è¿½åŠ ä¾èµ–](#821-å¯¹å¤–æš´éœ²æœåŠ¡-è¿½åŠ ä¾èµ–)
            - [8.2.2 è¿½åŠ  `RedisTest` æµ‹è¯•æ–¹æ³•](#822-è¿½åŠ -redistest-æµ‹è¯•æ–¹æ³•)
            - [8.2.3 æ–°å»º `handler` åŒ…, æ–°å»º `RedisHandler` ç±»](#823-æ–°å»º-handler-åŒ…-æ–°å»º-redishandler-ç±»)
    - [9. `authentication` ä¼šå‘˜ä¸­å¿ƒå·¥ç¨‹](#9-authentication-ä¼šå‘˜ä¸­å¿ƒå·¥ç¨‹)
        - [9.1 ä¾èµ–](#91-ä¾èµ–)
        - [9.2 æ–°å»º `CrowdMainClass` ä¸»å¯åŠ¨ç±»](#92-æ–°å»º-crowdmainclass-ä¸»å¯åŠ¨ç±»)
        - [9.3 æ–°å»º `application.yml` é…ç½®](#93-æ–°å»º-applicationyml-é…ç½®)
            - [9.3.1 æ–°å»ºåŒ… `templates`ã€`static`](#931-æ–°å»ºåŒ…-templatesstatic)
        - [9.4 æ–°å»º `PortalHandler` ç±»](#94-æ–°å»º-portalhandler-ç±»)
        - [9.5 æ–°å»º `portal.html` é¦–é¡µ](#95-æ–°å»º-portalhtml-é¦–é¡µ)
        - [9.6 `static` èµ„æº](#96-static-èµ„æº)
    - [10. `Zuul` ç½‘å…³é¡¹ç›®](#10-zuul-ç½‘å…³é¡¹ç›®)
        - [10.1 ä¾èµ–](#101-ä¾èµ–)
        - [10.2 æ–°å»º `CrowdMainClass` ä¸»å¯åŠ¨ç±»](#102-æ–°å»º-crowdmainclass-ä¸»å¯åŠ¨ç±»)
        - [10.3 æ–°å»º `application.yml` é…ç½®](#103-æ–°å»º-applicationyml-é…ç½®)
    - [11. å…³äºç¬¬ä¸€æ¬¡è¯·æ±‚è¶…æ—¶](#11-å…³äºç¬¬ä¸€æ¬¡è¯·æ±‚è¶…æ—¶)

- [åä¸ƒ ä¼šå‘˜æ³¨å†Œ](#åä¸ƒ-ä¼šå‘˜æ³¨å†Œ)
    - [1. è°ƒç”¨ç¬¬ä¸‰æ–¹çŸ­ä¿¡æ¥å£](#1-è°ƒç”¨ç¬¬ä¸‰æ–¹çŸ­ä¿¡æ¥å£)
        - [1.1 è¿½åŠ ä¾èµ–ã€`common`å·¥ç¨‹ã€‘](#11-è¿½åŠ ä¾èµ–commonå·¥ç¨‹)
        - [1.2 æ–°å»º `HttpUtils` ç±»ã€`common`å·¥ç¨‹ã€‘](#12-æ–°å»º-httputils-ç±»commonå·¥ç¨‹)
        - [1.3 æ–°å»º `CrowdTest` æµ‹è¯•ç±»ã€`auth` å·¥ç¨‹ã€‘](#13-æ–°å»º-crowdtest-æµ‹è¯•ç±»auth-å·¥ç¨‹)
            - [1.3.1 å‰ç½®: è¿½åŠ ä¾èµ–](#131-å‰ç½®-è¿½åŠ ä¾èµ–)
        - [1.4 `CrowdUtil` è¿½åŠ æ–¹æ³•ã€`common`å·¥ç¨‹ã€‘](#14-crowdutil-è¿½åŠ æ–¹æ³•commonå·¥ç¨‹)
    - [2. å‘é€éªŒè¯ç ã€`auth` å·¥ç¨‹ã€‘](#2-å‘é€éªŒè¯ç auth-å·¥ç¨‹)
        - [2.1 é…ç½®è·³è½¬è·¯å¾„å’Œå¯¹åº”çš„é¡µé¢](#21-é…ç½®è·³è½¬è·¯å¾„å’Œå¯¹åº”çš„é¡µé¢)
            - [2.1.1 æ–°å»º `CrowdWebMvcConfig` ç±»](#211-æ–°å»º-crowdwebmvcconfig-ç±»)
        - [2.2 ä¿®æ”¹ä»£ç  `portal.html`](#22-ä¿®æ”¹ä»£ç -portalhtml)
        - [2.3 æ–°å»º `member-reg.html` æ³¨å†Œé¡µé¢](#23-æ–°å»º-member-reghtml-æ³¨å†Œé¡µé¢)
            - [2.3.1 æ·»åŠ  `layer`åˆ° `static` ä¸‹ ğŸ“layer.zip](#231-æ·»åŠ -layeråˆ°-static-ä¸‹-layerzip)
        - [2.4 è¿½åŠ ä¾èµ–](#24-è¿½åŠ ä¾èµ–)
        - [2.5 æ–°å»º `ShortMessageProperties` ç±»](#25-æ–°å»º-shortmessageproperties-ç±»)
        - [2.6 è¿½åŠ é…ç½®](#26-è¿½åŠ é…ç½®)
        - [2.7 æ–°å»º `MemberHandler` å‘é€çŸ­ä¿¡](#27-æ–°å»º-memberhandler-å‘é€çŸ­ä¿¡)
        - [2.8 è¿½åŠ ä»£ç  `CrowdConstant`ã€`common`ã€‘](#28-è¿½åŠ ä»£ç -crowdconstantcommon)
    - [3. æ‰§è¡Œæ³¨å†Œæµç¨‹](#3-æ‰§è¡Œæ³¨å†Œæµç¨‹)
        - [3.1 è¿½åŠ ä»£ç  `MySQLRemoteService`ã€`API` å·¥ç¨‹ã€‘](#31-è¿½åŠ ä»£ç -mysqlremoteserviceapi-å·¥ç¨‹)
        - [3.2 `MySQL` é¡¹ç›®](#32-mysql-é¡¹ç›®)
            - [3.2.1 è¿½åŠ ä»£ç  `MemberProviderHandler`](#321-è¿½åŠ ä»£ç -memberproviderhandler)
            - [3.2.2 è¿½åŠ ä»£ç  `MemberService`](#322-è¿½åŠ ä»£ç -memberservice)
            - [3.2.3 è¿½åŠ ä»£ç  `MemberServiceImpl`](#323-è¿½åŠ ä»£ç -memberserviceimpl)
        - [3.3 æµ‹è¯• `http://localhost:2000/save/member/remote`](#33-æµ‹è¯•-httplocalhost2000savememberremote)
        - [3.4 `Entity` å·¥ç¨‹](#34-entity-å·¥ç¨‹)
            - [3.4.1 æ–°å»º `MemberVO` å°è£…è¡¨å•æ•°æ®](#341-æ–°å»º-membervo-å°è£…è¡¨å•æ•°æ®)
        - [3.5 `Auth` é¡¹ç›®](#35-auth-é¡¹ç›®)
            - [3.5.1 è¿½åŠ ä»£ç  `MemberHandler`](#351-è¿½åŠ ä»£ç -memberhandler)
            - [3.5.2 ç™»å½•é¡µé¢ `member-login.html`](#352-ç™»å½•é¡µé¢-member-loginhtml)
        - [3.6 `Common` å·¥ç¨‹](#36-common-å·¥ç¨‹)
            - [3.6.1 è¿½åŠ ä»£ç  `CrowdContant`](#361-è¿½åŠ ä»£ç -crowdcontant)

- [åå…« ä¼šå‘˜ç™»å½•](#åå…«-ä¼šå‘˜ç™»å½•)
    - [1. ç™»å½•æµç¨‹](#1-ç™»å½•æµç¨‹)
        - [1.1 `Entity`](#11-entity)
            - [1.1.1 æ–°å»º `MemberLoginVO`](#111-æ–°å»º-memberloginvo)
        - [1.2 `Auth` å·¥ç¨‹](#12-auth-å·¥ç¨‹)
            - [1.2.1 ä¿®æ”¹ä»£ç  `member-login.html`](#121-ä¿®æ”¹ä»£ç -member-loginhtml)
            - [1.2.2 è¿½åŠ ä»£ç  `MemberHandler`](#122-è¿½åŠ ä»£ç -memberhandler)
            - [1.2.3 è¿½åŠ ä»£ç  `CrowdWebMvcConfig` è®¾ç½®è·³è½¬é¡µé¢](#123-è¿½åŠ ä»£ç -crowdwebmvcconfig-è®¾ç½®è·³è½¬é¡µé¢)
            - [1.2.4 æ–°å»ºé¡µé¢ `member-conter.html`](#124-æ–°å»ºé¡µé¢-member-conterhtml)
    - [2. ä¼šå‘˜é€€å‡ºç™»å½•](#2-ä¼šå‘˜é€€å‡ºç™»å½•)
        - [2.1 `auth` å·¥ç¨‹](#21-auth-å·¥ç¨‹)
            - [2.1.1 ä¿®æ”¹ä»£ç `member-conter.html`](#211-ä¿®æ”¹ä»£ç member-conterhtml)
            - [2.1.2 è¿½åŠ ä»£ç  `MemberHandler`](#212-è¿½åŠ ä»£ç -memberhandler)
    - [3. çŸ¥è¯†ç‚¹: Session å…±äº«, è§£å†³ Session ä¸äº’é€šçš„é—®é¢˜](#3-çŸ¥è¯†ç‚¹-session-å…±äº«-è§£å†³-session-ä¸äº’é€šçš„é—®é¢˜)
        - [3.1 ä¼šè¯æ§åˆ¶å›é¡¾](#31-ä¼šè¯æ§åˆ¶å›é¡¾)
            - [3.1.1 Cookie çš„å·¥ä½œæœºåˆ¶](#311-cookie-çš„å·¥ä½œæœºåˆ¶)
            - [3.1.2 Session çš„å·¥ä½œæœºåˆ¶](#312-session-çš„å·¥ä½œæœºåˆ¶)
        - [3.2 è§£å†³æ–¹æ¡ˆæ¢ç´¢](#32-è§£å†³æ–¹æ¡ˆæ¢ç´¢)
            - [3.2.1 Session åŒæ­¥](#321-session-åŒæ­¥)
            - [3.2.2 å°† `Session` æ•°æ®å­˜å‚¨åœ¨ `Cookie` ä¸­](#322-å°†-session-æ•°æ®å­˜å‚¨åœ¨-cookie-ä¸­)
            - [3.2.3 åå‘ä»£ç† `hash` ä¸€è‡´æ€§](#323-åå‘ä»£ç†-hash-ä¸€è‡´æ€§)
            - [3.2.4 åç«¯ç»Ÿä¸€å­˜å‚¨ Session æ•°æ®](#324-åç«¯ç»Ÿä¸€å­˜å‚¨-session-æ•°æ®)
        - [3.3 `SpringSession` ä½¿ç”¨](#33-springsession-ä½¿ç”¨)
            - [3.3.1 å…±åŒä»£ç ](#331-å…±åŒä»£ç )
                - [3.3.1.1 å¼•å…¥ä¾èµ–](#3311-å¼•å…¥ä¾èµ–)
                - [3.3.1.2 æ–°å»º `MainClass` ä¸»å¯åŠ¨ç±»](#3312-æ–°å»º-mainclass-ä¸»å¯åŠ¨ç±»)
                - [3.3.1.3 æ–°å»º `application.yml` é…ç½®](#3313-æ–°å»º-applicationyml-é…ç½®)
            - [3.3.2 `pro18-spring-session-a`](#332-pro18-spring-session-a)
                - [3.3.2.1 æ–°å»º `HelloHandler` ç±»](#3321-æ–°å»º-hellohandler-ç±»)
            - [3.3.3 `pro18-spring-session-b`](#333-pro18-spring-session-b)
                - [3.3.3.1 æ–°å»º`HelloHandler`ç±»](#3331-æ–°å»ºhellohandlerç±»)
        - [3.4 `SpringSession` åŸºæœ¬åŸç†](#34-springsession-åŸºæœ¬åŸç†)
            - [3.4.1 `SpringSession` éœ€è¦å®Œæˆçš„ä»»åŠ¡](#341-springsession-éœ€è¦å®Œæˆçš„ä»»åŠ¡)
            - [3.4.2 `SessionRepositoryFilter`](#342-sessionrepositoryfilter)
    - [4. æ˜Ÿå›¾/æ¶æ„å›¾](#4-æ˜Ÿå›¾æ¶æ„å›¾)
    - [5. ç™»å½•æ£€æŸ¥](#5-ç™»å½•æ£€æŸ¥)
        - [5.1 ä»£ç : è®¾ç½® `Session` å…±äº«](#51-ä»£ç -è®¾ç½®-session-å…±äº«)
            - [5.1.1 `zuulã€auth` å·¥ç¨‹](#511-zuulauth-å·¥ç¨‹)
        - [5.2 ä»£ç : å‡†å¤‡ä¸éœ€è¦ç™»å½•æ£€æŸ¥çš„èµ„æº](#52-ä»£ç -å‡†å¤‡ä¸éœ€è¦ç™»å½•æ£€æŸ¥çš„èµ„æº)
            - [5.2.1 æ–°å»º `AccessPassResources` ç±»](#521-æ–°å»º-accesspassresources-ç±»)
        - [5.3 ä»£ç : `zuul` å·¥ç¨‹](#53-ä»£ç -zuul-å·¥ç¨‹)
            - [5.3.1 æ–°å»º `CrowdAccessFilter` ç±»](#531-æ–°å»º-crowdaccessfilter-ç±»)
            - [5.3.2 è¿½åŠ ä¾èµ–](#532-è¿½åŠ ä¾èµ–)
        - [5.4 `auth` å·¥ç¨‹](#54-auth-å·¥ç¨‹)
            - [5.4.1 è¿½åŠ ä»£ç  `member-login.html`](#541-è¿½åŠ ä»£ç -member-loginhtml)
    - [6 ä¿®æ”¹é‡å®šå‘åœ°å€, ä½¿ç”¨ `zuul`](#6-ä¿®æ”¹é‡å®šå‘åœ°å€-ä½¿ç”¨-zuul)
        - [6.1 å› ä¸º `Cookie` é—®é¢˜ä¸èƒ½ä½¿ç”¨é‡å®šå‘è·¨é¡¹ç›®è·³è½¬, æ‰€ä»¥é›†ä¸­è®¿é—® `zuul` æ¥è¿›è¡Œé‡å®šå‘](#61-å› ä¸º-cookie-é—®é¢˜ä¸èƒ½ä½¿ç”¨é‡å®šå‘è·¨é¡¹ç›®è·³è½¬-æ‰€ä»¥é›†ä¸­è®¿é—®-zuul-æ¥è¿›è¡Œé‡å®šå‘)
        - [6.2 å‰ç«¯é‡å®šå‘åœ°å€, ä½¿ç”¨ Session å…±äº«å­˜å‚¨ `zuul` åœ°å€è§£å†³](#62-å‰ç«¯é‡å®šå‘åœ°å€-ä½¿ç”¨-session-å…±äº«å­˜å‚¨-zuul-åœ°å€è§£å†³)
            - [6.2.1 é¡¹ç›®å¯åŠ¨è‡ªåŠ¨å­˜å‚¨ `zuul` åœ°å€](#621-é¡¹ç›®å¯åŠ¨è‡ªåŠ¨å­˜å‚¨-zuul-åœ°å€)
            - [6.2.2 è¿½åŠ ä»£ç  `CrowdConstant` ã€`common`å·¥ç¨‹ã€‘](#622-è¿½åŠ ä»£ç -crowdconstant-commonå·¥ç¨‹)
            - [6.2.3 å‰ç«¯é‡å®šå‘å¯ä»¥ä½¿ç”¨ `${session.zuulPath}`è·å–åœ°å€](#623-å‰ç«¯é‡å®šå‘å¯ä»¥ä½¿ç”¨-sessionzuulpathè·å–åœ°å€)


# åå…­ ä¼šå‘˜ç³»ç»Ÿ-æ­å»ºç¯å¢ƒ

## 1. å°šç­¹ç½‘ä¼šå‘˜ç³»ç»Ÿæ€»ç›®æ ‡

- æ­å»ºç¯å¢ƒ
- ä¼šå‘˜ç™»å½•æ³¨å†Œ
- å‘èµ·ä¼—ç­¹é¡¹ç›®
- å±•ç¤ºä¼—ç­¹é¡¹ç›®
- æ”¯æŒä¼—ç­¹é¡¹ç›®
- è®¢å•
- æ”¯ä»˜



## 2. ä¼šå‘˜ç³»ç»Ÿæ¶æ„

### 2.1 æ¶æ„å›¾

![img](https://cdn.nlark.com/yuque/0/2022/jpeg/12811585/1660761992125-e76f9523-8539-4e87-809f-523efdb400ba.jpeg)



### 2.2 éœ€è¦åˆ›å»ºçš„å·¥ç¨‹

| **å·¥ç¨‹**         | **å·¥ç¨‹åç§°**                                      | **ç«¯å£å·** |
| ---------------- | ------------------------------------------------- | ---------- |
| çˆ¶å·¥ç¨‹ã€èšåˆå·¥ç¨‹ | `atcrowdfunding07-member-parent`                  |            |
| æ³¨å†Œä¸­å¿ƒ         | `atcrowdfunding08-member-eureka`                  | 1000       |
| å®ä½“ç±»æ¨¡å—       | `atcrowdfunding09-member-entity`                  |            |
| MySQL æ•°æ®æœåŠ¡   | `atcrowdfunding10-member-mysql-provider`          | 2000       |
| Redis æ•°æ®æœåŠ¡   | `atcrowdfunding11-member-redis-provider`          | 3000       |
| ä¼šå‘˜ä¸­å¿ƒ         | `atcrowdfunding12-member-authentication-consumer` | 4000       |
| é¡¹ç›®ç»´æŠ¤         | `atcrowdfunding13-member-project-consumer`        | 5000       |
| è®¢å•ç»´æŠ¤         | `atcrowdfunding14-member-order-consumer`          | 7000       |
| æ”¯ä»˜åŠŸèƒ½         | `atcrowdfunding15-member-pay-consumer`            | 8000       |
| ç½‘å…³             | `atcrowdfunding16-member-zuul`                    | 80         |
| API æ¨¡å—         | `atcrowdfunding17-member-api`                     |            |



#### 2.2.1 åˆ›å»ºçˆ¶å·¥ç¨‹

- çˆ¶å·¥ç¨‹ã€èšåˆå·¥ç¨‹: `atcrowdfunding07-member-parent`(å”¯ä¸€çš„ `pom` å·¥ç¨‹)

    - `groupId`: `com.atguigu.crowd`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660707430789-dd0a8cba-3455-4555-bfd3-6e09c1873e07.png)

1. å¿½ç•¥æŸäº›æ–‡ä»¶

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660707703340-661f1278-d781-4f9d-9036-6cebddd3bb89.png)

```latex
### Java template
# Compiled class file
*.class

# Log file
*.log

# BlueJ files
*.ctxt

# Mobile Tools for Java (J2ME)
.mtj.tmp/

# Package Files #
*.jar
*.war
*.nar
*.ear
*.zip
*.tar.gz
*.rar

# virtual machine crash logs, see http://www.java.com/en/download/help/error_hotspot.xml
hs_err_pid*

# IntelliJ project files
.idea
*.iml
out
gen

*/target/
.gitignore
```



1. ä¸Šä¼ åˆ° Github

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660707610301-75ac1d1f-a18b-4b04-b631-d9508b3d7823.png)

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660752238786-a7b567fe-f0a7-44a7-a4b6-128da88463ee.png)



1. è·å–ä»¤ç‰Œ

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660708042836-1497af56-4f8b-43cd-b963-3fa01013619b.png)

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660708053831-2fc3084a-fdbb-4523-8d31-90861c211974.png)

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660708068382-832697e0-2707-449c-b4a0-6b29fc2f0fd8.png)

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660708079398-a4ebb822-9277-4fc0-86e8-5e3096bf2623.png)



1. ä½¿ç”¨ä»¤ç‰Œ

æ­¤å¤„ä¸ºè¯­é›€åŠ å¯†æ–‡æœ¬å¡ç‰‡ï¼Œç‚¹å‡»é“¾æ¥æŸ¥çœ‹ï¼šhttps://www.yuque.com/lingchen-bf1rc/hoahc6/rkxxg5#Fpv7c

```bash
git remote set-url origin https://ä»¤ç‰Œ@github.com/ç”¨æˆ·å/atcrowdfunding07-member-parent.git
```

- ç”¨æˆ·å: [https://github.com/](https://github.com/jianglinChen191023)ç”¨æˆ·å

1. åˆ° GitHub ä¸Šåˆ›å»º `README.md` æ–‡ä»¶: `Add a README`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660752398366-57894d6d-ce0b-4107-9606-86ee518b0b09.png)



1. æ›´æ–°åˆ°æœ¬åœ°: `git pull`



#### 2.2.2 åˆ›å»ºå­å·¥ç¨‹æ¨¡å—

åˆ†æ”¯: `git checkout -b 16.0.0_build_environment`



- æ³¨å†Œä¸­å¿ƒ: `atcrowdfunding08-member-eureka`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660748801355-aa089955-2b04-4c61-bb35-ee124e0793a1.png)



- å®ä½“ç±»æ¨¡å—: `atcrowdfunding09-member-entity`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660749600504-abcace78-e006-4ea6-b24c-5f456a3ba6aa.png)



- MySQL æ•°æ®æœåŠ¡: `atcrowdfunding10-member-mysql-provider`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660749646155-51baeb1e-8d18-4ae4-82f6-fb8f83f992c6.png)



- Redis æ•°æ®æœåŠ¡: `atcrowdfunding11-member-redis-provider`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660749689336-fe15aac4-f87d-40a5-ba8b-33aed63ec078.png)



- ä¼šå‘˜ä¸­å¿ƒ: `atcrowdfunding12-member-authentication-consumer`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660749736843-deb054d8-b097-4b28-86a0-4c884c4fcd47.png)



- é¡¹ç›®ç»´æŠ¤: `atcrowdfunding13-member-project-consumer`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660749794116-95648241-955c-4750-a8af-c61feb4f9777.png)



- è®¢å•ç»´æŠ¤: `atcrowdfunding14-member-order-consumer`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660749819591-ac051a78-eedc-44fe-a28f-55f740754f71.png)



- æ”¯ä»˜åŠŸèƒ½: `atcrowdfunding15-member-pay-consumer`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660749894730-b5fb2891-df3a-4713-8e26-a0086f86fb39.png)



- ç½‘å…³: `atcrowdfunding16-member-zuul`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660760529179-834536c1-0845-4cbe-8f04-f5bde543a909.png)



- API æ¨¡å—: `atcrowdfunding17-member-api`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660762061884-37abcf11-b193-46aa-b3ef-9824a3abcbff.png)



#### 2.2.3 ç¡®ä¿ `github` ä¸Šé¡¹ç›®ç»“æ„çš„å®Œæ•´

- å› ä¸º `github` ä¸Šä¸èƒ½ä¿å­˜ç©ºæ–‡ä»¶å¤¹, æ‰€ä»¥è¦åœ¨é¡¹ç›®ç©ºæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºæ–‡ä»¶, ç¡®ä¿ `github` ä¸Šçš„é¡¹ç›®ç»“æ„çš„å®Œæ•´

```bash
find . \( -type d -empty \) -exec touch {}/.gitxxx \;
```



#### 2.2.4 åˆ é™¤çˆ¶é¡¹ç›®ä¸‹çš„ `src` ç›®å½•



## 3. çˆ¶å·¥ç¨‹ç¯å¢ƒ

- ä¾èµ–ç®¡ç†

```xml
<!-- é…ç½®åœ¨çˆ¶å·¥ç¨‹ä¸­è¦ç®¡ç†çš„ä¾èµ– -->
<dependencyManagement>
    <dependencies>
        <!-- å¯¼å…¥ SpringCloud éœ€è¦ä½¿ç”¨çš„ä¾èµ–ä¿¡æ¯ -->
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-dependencies</artifactId>
            <version>Greenwich.SR2</version>
            <type>pom</type>
            <!-- import ä¾èµ–èŒƒå›´è¡¨ç¤ºå°† spring-cloud-dependencies åŒ…ä¸­çš„ä¾èµ–ä¿¡æ¯å¯¼å…¥ -->
            <scope>import</scope>
        </dependency>
        <!-- å¯¼å…¥ SpringBoot éœ€è¦ä½¿ç”¨çš„ä¾èµ–ä¿¡æ¯ -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-dependencies</artifactId>
            <version>2.1.6.RELEASE</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
        <dependency>
            <groupId>org.mybatis.spring.boot</groupId>
            <artifactId>mybatis-spring-boot-starter</artifactId>
            <version>2.1.1</version>
        </dependency>
        <dependency>
            <groupId>com.alibaba</groupId>
            <artifactId>druid-spring-boot-starter</artifactId>
            <version>1.1.17</version>
        </dependency>
     </dependencies>
</dependencyManagement>
```



## 4. `Eureka` å·¥ç¨‹

### 4.1 ä¾èµ–

```xml
    <dependencies>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <!-- è¿™ä¸ªæ’ä»¶å°† SpringBoot åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„ jar åŒ… -->
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <executions>
                    <execution>
                        <goals>
                            <goal>repackage</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
```



### 4.2 ä¸»å¯åŠ¨ç±»

```java
package com.atguigu.crowd;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;

/**
 * @author chenjianglin
 * @date 2022/8/18 02:05
 */
@EnableEurekaServer
@SpringBootApplication
public class CrowdMainClass {

    public static void main(String[] args) {
        SpringApplication.run(CrowdMainClass.class, args);
    }
    
}
```



### 4.3 é…ç½®

```yaml
server:
  port: 1000

spring:
  application:
    name: atguigu-crowd-eureka

eureka:
  instance:
    hostname: location
  client:
    # è‡ªå·±å°±æ˜¯æ³¨å†Œä¸­å¿ƒ, æ‰€ä»¥è‡ªå·±ä¸æ³¨å†Œè‡ªå·±
    register-with-eureka: false
    # è‡ªå·±å°±æ˜¯æ³¨å†Œä¸­å¿ƒ, æ‰€ä»¥ä¸éœ€è¦"ä»æ³¨å†Œä¸­å¿ƒå–å›ä¿¡æ¯"
    fetch-registry: false
    # å®¢æˆ·ç«¯è®¿é—® Eureka æ—¶ä½¿ç”¨çš„åœ°å€
    service-url:
      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka
```



## 5. `Entity` å·¥ç¨‹

### 5.1 å®ä½“ç±»çš„è¿›ä¸€æ­¥ç»†åˆ†

![img](https://cdn.nlark.com/yuque/0/2022/jpeg/12811585/1660763085899-37674a6e-4e2a-4634-95c3-1a37e84771bd.jpeg)

- ä½¿ç”¨ `org.springframework.beans.BeanUtils.copyProperties(Object, Object)` åœ¨ä¸åŒå®ä½“ç±»ä¹‹é—´å¤åˆ¶å±æ€§
- `MemberVO` -> å¤åˆ¶å±æ€§ -> `MemberPO`

------

#### 5.1.1 `VO`

- `View Object` è§†å›¾å¯¹è±¡

    - ç”¨é€”1: å°è£…æµè§ˆå™¨è¡¨å•æäº¤çš„æ•°æ®ä¸º `VO` å¯¹è±¡

        - **æ¥é€**æµè§ˆå™¨å‘é€è¿‡æ¥çš„æ•°æ®

    - ç”¨é€”2: åç«¯ç¨‹åºå°†æ•°æ®å°è£…ä¸º `VO` å¯¹è±¡åå‘é€åˆ°æµè§ˆå™¨æ˜¾ç¤º

        - æŠŠæ•°æ®**å‘é€**ç»™æµè§ˆå™¨å»æ˜¾ç¤º



#### 5.1.2 `PO`

- `Persistent Object` æŒä¹…åŒ–å¯¹è±¡

    - ç”¨é€”1: å°†æ•°æ®å°è£…åˆ° `PO` å¯¹è±¡å­˜å…¥æ•°æ®åº“
    - ç”¨é€”2: å°†æ•°æ®åº“æ•°æ®æŸ¥è¯¢å‡ºæ¥å­˜å…¥ `PO` å¯¹è±¡

- æ‰€ä»¥ `PO` å¯¹è±¡æ˜¯å’Œæ•°æ®åº“è¡¨å¯¹åº”, ä¸€ä¸ªæ•°æ®åº“è¡¨å¯¹åº”ä¸€ä¸ª `PO` å¯¹è±¡



#### 5.1.3 `DO`

- `Data Object` æ•°æ®å¯¹è±¡

    - ç”¨é€”1: ä» `Redis` æŸ¥è¯¢å¾—åˆ°æ•°æ®å°è£…ä¸º `DO` å¯¹è±¡
    - ç”¨é€”2: ä» `ElasticSearch` æŸ¥è¯¢å¾—åˆ°æ•°æ®å°è£…ä¸º `DO` å¯¹è±¡
    - ç”¨é€”3: ä» `Solr` æŸ¥è¯¢å¾—åˆ°æ•°æ®å°è£…ä¸º `DO` å¯¹è±¡

- ä»ä¸­é—´ä»¶æˆ–å…¶ä»–ç¬¬ä¸‰æ–¹æ¥å£æŸ¥è¯¢åˆ°çš„æ•°æ®å°è£…ä¸º `DO` å¯¹è±¡



#### 5.1.4 `DTO`

- `Data Transfer Object` æ•°æ®ä¼ è¾“å¯¹è±¡

    - ç”¨é€”1: ä» `Consumer` å‘é€æ•°æ®åˆ° `Provider`
    - ç”¨é€”2: `Provider` è¿”å›æ•°æ®ç»™ `Consumer`



### 5.2 åˆ›å»ºåŒ…

- `con.atguigu.crowd.entity.po`
- `con.atguigu.crowd.entity.vo`



### 5.3 `Lombok`

| **æ³¨è§£**              | **è¯´æ˜**                                   |
| --------------------- | ------------------------------------------ |
| `@Data`               | get set equals hashCodetoString()æ„é€ å™¨... |
| `@Setter`             |                                            |
| `@Getter`             |                                            |
| `@ToString`           |                                            |
| `@EqualsAndHashCode`  |                                            |
| `@AllArgsConstructor` | æœ‰å‚æ„é€ å™¨                                 |
| `@NoArgsConstructor`  | æ— å‚æ„é€ å™¨                                 |

- ç»„åˆä½¿ç”¨ `@Data` `@AllArgsConstructor` `@NoArgsConstructor`



#### 5.3.1 `lombok` åŸç†

- æ ¹æ®æ³¨è§£ç¡®å®šè¦ç”Ÿæˆçš„ä»£ç ï¼Œ ç„¶åå°†ç”Ÿæˆçš„ä»£ç ä¾µå…¥åˆ°å­—èŠ‚ç æ–‡ä»¶ä¸­

![img](https://cdn.nlark.com/yuque/0/2022/jpeg/12811585/1660854421832-f3271bb0-ac5a-40d7-bfbf-810af7fcbcfb.jpeg)



#### 5.3.2 `Lombok` ä¾èµ–

```xml
<dependencies>
  <dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
  </dependency>
</dependencies>
```



## 5. `MySQL` å·¥ç¨‹

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660866025697-5e59e7d5-494c-4865-901d-073d7e47b115.png)

------

### 5.1 ä¾èµ–

```xml
 <dependencies>
    <!-- ä¸ºèƒ½å¤Ÿä½¿ç”¨å®ä½“ç±» -->
    <dependency>
        <groupId>com.atguigu.crowd</groupId>
        <artifactId>atcrowdfunding09-member-entity</artifactId>
        <version>1.0-SNAPSHOT</version>
    </dependency>

    <!-- ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨å·¥å…·ç±» -->
    <dependency>
        <groupId>com.atguigu.crowd</groupId>
        <artifactId>atcrowdfunding05-common-util</artifactId>
        <version>1.0-SNAPSHOT</version>
    </dependency>

    <!-- æ•´åˆ MyBatis -->
    <dependency>
        <groupId>org.mybatis.spring.boot</groupId>
        <artifactId>mybatis-spring-boot-starter</artifactId>
    </dependency>

    <!-- MySQL é©±åŠ¨-->
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
    </dependency>

    <!-- æ•´åˆæ•°æ®åº“è¿æ¥æ±  -->
    <dependency>
        <groupId>com.alibaba</groupId>
        <artifactId>druid-spring-boot-starter</artifactId>
    </dependency>

    <!-- SpringBoot æµ‹è¯• -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
   
    <!-- å¯¹å¤–æš´éœ²æœåŠ¡ -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>

    <!-- ä½œä¸ºå®¢æˆ·ç«¯è®¿é—® Eureka æ³¨å†Œä¸­å¿ƒ -->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
    </dependency>
</dependencies>

<build>
    <plugins>
        <!-- è¿™ä¸ªæ’ä»¶å°† SpringBoot åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„ jar åŒ… -->
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
            <executions>
                <execution>
                    <goals>
                        <goal>repackage</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```



### 5.2 ä¸»å¯åŠ¨ç±»

```java
package com.atguigu.crowd;

import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

/**
 * @author chenjianglin
 * @date 2022/8/19 05:02
 */
@MapperScan("com.atguigu.crowd.mapper")
@SpringBootApplication
public class CrowdMainClass {

    public static void main(String[] args) {
        SpringApplication.run(CrowdMainClass.class, args);
    }

}
```



### 5.3 é…ç½®

```yaml
server:
  port: 2000

eureka:
  client:
    service-url:
      defaultZone: http://localhost:1000/eureka

# ç”Ÿæˆçš„å…¬é’¥
public-key: MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAMNXQuj4GCqDt+t3ex6W9u5hf50/o/JZKS6C0lKlzzUXvWHqAhJxqWoa3C2+Jp+CUtJhugMtTpeLMf5+Acokg8ECAwEAAQ==

spring:
  application:
    name: atguigu-crowd-mysql
  datasource:
    name: mydb
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://175.178.174.83:3306/project_crowd ?useUnicode=true&characterEncoding=UTF-8&serverTimezone=UTC&useSSL=false
    username: root
    # ç”Ÿæˆçš„åŠ å¯†åçš„å¯†ç 
    password: lEdXTUweRH6bqzFKEy07vHkzKrziXqkHBQNwjK6FohatpabGU+2uxc73RZftE1vD3F5GDPZDhNg6vebNTNAOcA==
    # é…ç½® connection-propertiesï¼Œå¯ç”¨åŠ å¯†ï¼Œé…ç½®å…¬é’¥ã€‚
    druid:
      connection-properties: config.decrypt=true;config.decrypt.key=${public-key}
      # å¯ç”¨ConfigFilter
      filter:
        config:
          enabled: true

mybatis:
  mapper-locations: classpath*:/mybatis/mapper/*Mapper.xml
logging:
  level:
    com.atguigu.crowd.mapper: debug
    com.atguigu.crowd.test: debug
```



### 5.4 æµ‹è¯•ç±»

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660856789891-4bd1e4c5-f0ed-497e-8f97-267a05013a8c.png)

#### 5.4.1 æµ‹è¯• `connection`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660862236306-3a6ca70e-f178-4e01-8ade-cce8523d43c8.png)

------

```java
package com.atguigu.crowd.test;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import javax.sql.DataSource;
import java.sql.Connection;
import java.sql.SQLException;

/**
 * @author chenjianglin
 * @date 2022/8/19 05:05
 */
@RunWith(SpringRunner.class)
@SpringBootTest
public class MyBatisTest {

    @Autowired
    private DataSource dataSource;

    private Logger logger = LoggerFactory.getLogger(MyBatisTest.class);
    
    @Test
    public void test() throws SQLException {
        Connection connection = dataSource.getConnection();
        logger.debug("connection: " + connection.toString());
    }

}
```



#### 5.4.2 æµ‹è¯• `Mapper`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660865495253-13248331-5fb0-482c-a1a9-1bbbb874f79e.png)

------

- `testMember` æ–¹æ³•

```java
package com.atguigu.crowd.test;

import com.atguigu.crowd.entity.po.MemberPO;
import com.atguigu.crowd.mapper.MemberPOMapper;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.test.context.junit4.SpringRunner;

import javax.sql.DataSource;
import java.sql.Connection;
import java.sql.SQLException;

/**
 * @author chenjianglin
 * @date 2022/8/19 05:05
 */
@RunWith(SpringRunner.class)
@SpringBootTest
public class MyBatisTest {

    @Autowired
    private DataSource dataSource;

    private Logger logger = LoggerFactory.getLogger(MyBatisTest.class);

    @Autowired
    private MemberPOMapper memberPOMapper;

    @Test
    public void test() throws SQLException {
        Connection connection = dataSource.getConnection();
        logger.debug("connection: " + connection.toString());
    }

    @Test
    public void testMember() {
        BCryptPasswordEncoder bCryptPasswordEncoder = new BCryptPasswordEncoder();
        String source = "123123";
        String encode = bCryptPasswordEncoder.encode(source);
        MemberPO memberPO = new MemberPO(null, "jack", encode, "æ°å…‹", "jack@qq.com", 1, 1, "æ°å…‹", "430626220104045821", 2);
        memberPOMapper.insert(memberPO);
    }

}
```

- ä½¿ç”¨ `atcrowdfunding06-common-reverse` åˆ›å»º `MemberPO`å®ä½“ç±»

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660863785162-764b1423-8866-464d-8d7d-ca889f23ddc8.png)

- å¤åˆ¶åˆ° é¡¹ç›®ä¸­

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660864037860-e37c0937-a893-4bab-b631-17ec5f6ff591.png)



```java
package com.atguigu.crowd.entity.po;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@NoArgsConstructor
@AllArgsConstructor
@Data
public class MemberPO {
    private Integer id;

    private String loginacct;

    private String userpswd;

    private String username;

    private String email;

    private Integer authstatus;

    private Integer usertype;

    private String realname;

    private String cardnum;

    private Integer accttype;
}
package com.atguigu.crowd.entity.po;

import java.util.ArrayList;
import java.util.List;

public class MemberPOExample {
    protected String orderByClause;

    protected boolean distinct;

    protected List<Criteria> oredCriteria;

    public MemberPOExample() {
        oredCriteria = new ArrayList<Criteria>();
    }

    public void setOrderByClause(String orderByClause) {
        this.orderByClause = orderByClause;
    }

    public String getOrderByClause() {
        return orderByClause;
    }

    public void setDistinct(boolean distinct) {
        this.distinct = distinct;
    }

    public boolean isDistinct() {
        return distinct;
    }

    public List<Criteria> getOredCriteria() {
        return oredCriteria;
    }

    public void or(Criteria criteria) {
        oredCriteria.add(criteria);
    }

    public Criteria or() {
        Criteria criteria = createCriteriaInternal();
        oredCriteria.add(criteria);
        return criteria;
    }

    public Criteria createCriteria() {
        Criteria criteria = createCriteriaInternal();
        if (oredCriteria.size() == 0) {
            oredCriteria.add(criteria);
        }
        return criteria;
    }

    protected Criteria createCriteriaInternal() {
        Criteria criteria = new Criteria();
        return criteria;
    }

    public void clear() {
        oredCriteria.clear();
        orderByClause = null;
        distinct = false;
    }

    protected abstract static class GeneratedCriteria {
        protected List<Criterion> criteria;

        protected GeneratedCriteria() {
            super();
            criteria = new ArrayList<Criterion>();
        }

        public boolean isValid() {
            return criteria.size() > 0;
        }

        public List<Criterion> getAllCriteria() {
            return criteria;
        }

        public List<Criterion> getCriteria() {
            return criteria;
        }

        protected void addCriterion(String condition) {
            if (condition == null) {
                throw new RuntimeException("Value for condition cannot be null");
            }
            criteria.add(new Criterion(condition));
        }

        protected void addCriterion(String condition, Object value, String property) {
            if (value == null) {
                throw new RuntimeException("Value for " + property + " cannot be null");
            }
            criteria.add(new Criterion(condition, value));
        }

        protected void addCriterion(String condition, Object value1, Object value2, String property) {
            if (value1 == null || value2 == null) {
                throw new RuntimeException("Between values for " + property + " cannot be null");
            }
            criteria.add(new Criterion(condition, value1, value2));
        }

        public Criteria andIdIsNull() {
            addCriterion("id is null");
            return (Criteria) this;
        }

        public Criteria andIdIsNotNull() {
            addCriterion("id is not null");
            return (Criteria) this;
        }

        public Criteria andIdEqualTo(Integer value) {
            addCriterion("id =", value, "id");
            return (Criteria) this;
        }

        public Criteria andIdNotEqualTo(Integer value) {
            addCriterion("id <>", value, "id");
            return (Criteria) this;
        }

        public Criteria andIdGreaterThan(Integer value) {
            addCriterion("id >", value, "id");
            return (Criteria) this;
        }

        public Criteria andIdGreaterThanOrEqualTo(Integer value) {
            addCriterion("id >=", value, "id");
            return (Criteria) this;
        }

        public Criteria andIdLessThan(Integer value) {
            addCriterion("id <", value, "id");
            return (Criteria) this;
        }

        public Criteria andIdLessThanOrEqualTo(Integer value) {
            addCriterion("id <=", value, "id");
            return (Criteria) this;
        }

        public Criteria andIdIn(List<Integer> values) {
            addCriterion("id in", values, "id");
            return (Criteria) this;
        }

        public Criteria andIdNotIn(List<Integer> values) {
            addCriterion("id not in", values, "id");
            return (Criteria) this;
        }

        public Criteria andIdBetween(Integer value1, Integer value2) {
            addCriterion("id between", value1, value2, "id");
            return (Criteria) this;
        }

        public Criteria andIdNotBetween(Integer value1, Integer value2) {
            addCriterion("id not between", value1, value2, "id");
            return (Criteria) this;
        }

        public Criteria andLoginacctIsNull() {
            addCriterion("loginacct is null");
            return (Criteria) this;
        }

        public Criteria andLoginacctIsNotNull() {
            addCriterion("loginacct is not null");
            return (Criteria) this;
        }

        public Criteria andLoginacctEqualTo(String value) {
            addCriterion("loginacct =", value, "loginacct");
            return (Criteria) this;
        }

        public Criteria andLoginacctNotEqualTo(String value) {
            addCriterion("loginacct <>", value, "loginacct");
            return (Criteria) this;
        }

        public Criteria andLoginacctGreaterThan(String value) {
            addCriterion("loginacct >", value, "loginacct");
            return (Criteria) this;
        }

        public Criteria andLoginacctGreaterThanOrEqualTo(String value) {
            addCriterion("loginacct >=", value, "loginacct");
            return (Criteria) this;
        }

        public Criteria andLoginacctLessThan(String value) {
            addCriterion("loginacct <", value, "loginacct");
            return (Criteria) this;
        }

        public Criteria andLoginacctLessThanOrEqualTo(String value) {
            addCriterion("loginacct <=", value, "loginacct");
            return (Criteria) this;
        }

        public Criteria andLoginacctLike(String value) {
            addCriterion("loginacct like", value, "loginacct");
            return (Criteria) this;
        }

        public Criteria andLoginacctNotLike(String value) {
            addCriterion("loginacct not like", value, "loginacct");
            return (Criteria) this;
        }

        public Criteria andLoginacctIn(List<String> values) {
            addCriterion("loginacct in", values, "loginacct");
            return (Criteria) this;
        }

        public Criteria andLoginacctNotIn(List<String> values) {
            addCriterion("loginacct not in", values, "loginacct");
            return (Criteria) this;
        }

        public Criteria andLoginacctBetween(String value1, String value2) {
            addCriterion("loginacct between", value1, value2, "loginacct");
            return (Criteria) this;
        }

        public Criteria andLoginacctNotBetween(String value1, String value2) {
            addCriterion("loginacct not between", value1, value2, "loginacct");
            return (Criteria) this;
        }

        public Criteria andUserpswdIsNull() {
            addCriterion("userpswd is null");
            return (Criteria) this;
        }

        public Criteria andUserpswdIsNotNull() {
            addCriterion("userpswd is not null");
            return (Criteria) this;
        }

        public Criteria andUserpswdEqualTo(String value) {
            addCriterion("userpswd =", value, "userpswd");
            return (Criteria) this;
        }

        public Criteria andUserpswdNotEqualTo(String value) {
            addCriterion("userpswd <>", value, "userpswd");
            return (Criteria) this;
        }

        public Criteria andUserpswdGreaterThan(String value) {
            addCriterion("userpswd >", value, "userpswd");
            return (Criteria) this;
        }

        public Criteria andUserpswdGreaterThanOrEqualTo(String value) {
            addCriterion("userpswd >=", value, "userpswd");
            return (Criteria) this;
        }

        public Criteria andUserpswdLessThan(String value) {
            addCriterion("userpswd <", value, "userpswd");
            return (Criteria) this;
        }

        public Criteria andUserpswdLessThanOrEqualTo(String value) {
            addCriterion("userpswd <=", value, "userpswd");
            return (Criteria) this;
        }

        public Criteria andUserpswdLike(String value) {
            addCriterion("userpswd like", value, "userpswd");
            return (Criteria) this;
        }

        public Criteria andUserpswdNotLike(String value) {
            addCriterion("userpswd not like", value, "userpswd");
            return (Criteria) this;
        }

        public Criteria andUserpswdIn(List<String> values) {
            addCriterion("userpswd in", values, "userpswd");
            return (Criteria) this;
        }

        public Criteria andUserpswdNotIn(List<String> values) {
            addCriterion("userpswd not in", values, "userpswd");
            return (Criteria) this;
        }

        public Criteria andUserpswdBetween(String value1, String value2) {
            addCriterion("userpswd between", value1, value2, "userpswd");
            return (Criteria) this;
        }

        public Criteria andUserpswdNotBetween(String value1, String value2) {
            addCriterion("userpswd not between", value1, value2, "userpswd");
            return (Criteria) this;
        }

        public Criteria andUsernameIsNull() {
            addCriterion("username is null");
            return (Criteria) this;
        }

        public Criteria andUsernameIsNotNull() {
            addCriterion("username is not null");
            return (Criteria) this;
        }

        public Criteria andUsernameEqualTo(String value) {
            addCriterion("username =", value, "username");
            return (Criteria) this;
        }

        public Criteria andUsernameNotEqualTo(String value) {
            addCriterion("username <>", value, "username");
            return (Criteria) this;
        }

        public Criteria andUsernameGreaterThan(String value) {
            addCriterion("username >", value, "username");
            return (Criteria) this;
        }

        public Criteria andUsernameGreaterThanOrEqualTo(String value) {
            addCriterion("username >=", value, "username");
            return (Criteria) this;
        }

        public Criteria andUsernameLessThan(String value) {
            addCriterion("username <", value, "username");
            return (Criteria) this;
        }

        public Criteria andUsernameLessThanOrEqualTo(String value) {
            addCriterion("username <=", value, "username");
            return (Criteria) this;
        }

        public Criteria andUsernameLike(String value) {
            addCriterion("username like", value, "username");
            return (Criteria) this;
        }

        public Criteria andUsernameNotLike(String value) {
            addCriterion("username not like", value, "username");
            return (Criteria) this;
        }

        public Criteria andUsernameIn(List<String> values) {
            addCriterion("username in", values, "username");
            return (Criteria) this;
        }

        public Criteria andUsernameNotIn(List<String> values) {
            addCriterion("username not in", values, "username");
            return (Criteria) this;
        }

        public Criteria andUsernameBetween(String value1, String value2) {
            addCriterion("username between", value1, value2, "username");
            return (Criteria) this;
        }

        public Criteria andUsernameNotBetween(String value1, String value2) {
            addCriterion("username not between", value1, value2, "username");
            return (Criteria) this;
        }

        public Criteria andEmailIsNull() {
            addCriterion("email is null");
            return (Criteria) this;
        }

        public Criteria andEmailIsNotNull() {
            addCriterion("email is not null");
            return (Criteria) this;
        }

        public Criteria andEmailEqualTo(String value) {
            addCriterion("email =", value, "email");
            return (Criteria) this;
        }

        public Criteria andEmailNotEqualTo(String value) {
            addCriterion("email <>", value, "email");
            return (Criteria) this;
        }

        public Criteria andEmailGreaterThan(String value) {
            addCriterion("email >", value, "email");
            return (Criteria) this;
        }

        public Criteria andEmailGreaterThanOrEqualTo(String value) {
            addCriterion("email >=", value, "email");
            return (Criteria) this;
        }

        public Criteria andEmailLessThan(String value) {
            addCriterion("email <", value, "email");
            return (Criteria) this;
        }

        public Criteria andEmailLessThanOrEqualTo(String value) {
            addCriterion("email <=", value, "email");
            return (Criteria) this;
        }

        public Criteria andEmailLike(String value) {
            addCriterion("email like", value, "email");
            return (Criteria) this;
        }

        public Criteria andEmailNotLike(String value) {
            addCriterion("email not like", value, "email");
            return (Criteria) this;
        }

        public Criteria andEmailIn(List<String> values) {
            addCriterion("email in", values, "email");
            return (Criteria) this;
        }

        public Criteria andEmailNotIn(List<String> values) {
            addCriterion("email not in", values, "email");
            return (Criteria) this;
        }

        public Criteria andEmailBetween(String value1, String value2) {
            addCriterion("email between", value1, value2, "email");
            return (Criteria) this;
        }

        public Criteria andEmailNotBetween(String value1, String value2) {
            addCriterion("email not between", value1, value2, "email");
            return (Criteria) this;
        }

        public Criteria andAuthstatusIsNull() {
            addCriterion("authstatus is null");
            return (Criteria) this;
        }

        public Criteria andAuthstatusIsNotNull() {
            addCriterion("authstatus is not null");
            return (Criteria) this;
        }

        public Criteria andAuthstatusEqualTo(Integer value) {
            addCriterion("authstatus =", value, "authstatus");
            return (Criteria) this;
        }

        public Criteria andAuthstatusNotEqualTo(Integer value) {
            addCriterion("authstatus <>", value, "authstatus");
            return (Criteria) this;
        }

        public Criteria andAuthstatusGreaterThan(Integer value) {
            addCriterion("authstatus >", value, "authstatus");
            return (Criteria) this;
        }

        public Criteria andAuthstatusGreaterThanOrEqualTo(Integer value) {
            addCriterion("authstatus >=", value, "authstatus");
            return (Criteria) this;
        }

        public Criteria andAuthstatusLessThan(Integer value) {
            addCriterion("authstatus <", value, "authstatus");
            return (Criteria) this;
        }

        public Criteria andAuthstatusLessThanOrEqualTo(Integer value) {
            addCriterion("authstatus <=", value, "authstatus");
            return (Criteria) this;
        }

        public Criteria andAuthstatusIn(List<Integer> values) {
            addCriterion("authstatus in", values, "authstatus");
            return (Criteria) this;
        }

        public Criteria andAuthstatusNotIn(List<Integer> values) {
            addCriterion("authstatus not in", values, "authstatus");
            return (Criteria) this;
        }

        public Criteria andAuthstatusBetween(Integer value1, Integer value2) {
            addCriterion("authstatus between", value1, value2, "authstatus");
            return (Criteria) this;
        }

        public Criteria andAuthstatusNotBetween(Integer value1, Integer value2) {
            addCriterion("authstatus not between", value1, value2, "authstatus");
            return (Criteria) this;
        }

        public Criteria andUsertypeIsNull() {
            addCriterion("usertype is null");
            return (Criteria) this;
        }

        public Criteria andUsertypeIsNotNull() {
            addCriterion("usertype is not null");
            return (Criteria) this;
        }

        public Criteria andUsertypeEqualTo(Integer value) {
            addCriterion("usertype =", value, "usertype");
            return (Criteria) this;
        }

        public Criteria andUsertypeNotEqualTo(Integer value) {
            addCriterion("usertype <>", value, "usertype");
            return (Criteria) this;
        }

        public Criteria andUsertypeGreaterThan(Integer value) {
            addCriterion("usertype >", value, "usertype");
            return (Criteria) this;
        }

        public Criteria andUsertypeGreaterThanOrEqualTo(Integer value) {
            addCriterion("usertype >=", value, "usertype");
            return (Criteria) this;
        }

        public Criteria andUsertypeLessThan(Integer value) {
            addCriterion("usertype <", value, "usertype");
            return (Criteria) this;
        }

        public Criteria andUsertypeLessThanOrEqualTo(Integer value) {
            addCriterion("usertype <=", value, "usertype");
            return (Criteria) this;
        }

        public Criteria andUsertypeIn(List<Integer> values) {
            addCriterion("usertype in", values, "usertype");
            return (Criteria) this;
        }

        public Criteria andUsertypeNotIn(List<Integer> values) {
            addCriterion("usertype not in", values, "usertype");
            return (Criteria) this;
        }

        public Criteria andUsertypeBetween(Integer value1, Integer value2) {
            addCriterion("usertype between", value1, value2, "usertype");
            return (Criteria) this;
        }

        public Criteria andUsertypeNotBetween(Integer value1, Integer value2) {
            addCriterion("usertype not between", value1, value2, "usertype");
            return (Criteria) this;
        }

        public Criteria andRealnameIsNull() {
            addCriterion("realname is null");
            return (Criteria) this;
        }

        public Criteria andRealnameIsNotNull() {
            addCriterion("realname is not null");
            return (Criteria) this;
        }

        public Criteria andRealnameEqualTo(String value) {
            addCriterion("realname =", value, "realname");
            return (Criteria) this;
        }

        public Criteria andRealnameNotEqualTo(String value) {
            addCriterion("realname <>", value, "realname");
            return (Criteria) this;
        }

        public Criteria andRealnameGreaterThan(String value) {
            addCriterion("realname >", value, "realname");
            return (Criteria) this;
        }

        public Criteria andRealnameGreaterThanOrEqualTo(String value) {
            addCriterion("realname >=", value, "realname");
            return (Criteria) this;
        }

        public Criteria andRealnameLessThan(String value) {
            addCriterion("realname <", value, "realname");
            return (Criteria) this;
        }

        public Criteria andRealnameLessThanOrEqualTo(String value) {
            addCriterion("realname <=", value, "realname");
            return (Criteria) this;
        }

        public Criteria andRealnameLike(String value) {
            addCriterion("realname like", value, "realname");
            return (Criteria) this;
        }

        public Criteria andRealnameNotLike(String value) {
            addCriterion("realname not like", value, "realname");
            return (Criteria) this;
        }

        public Criteria andRealnameIn(List<String> values) {
            addCriterion("realname in", values, "realname");
            return (Criteria) this;
        }

        public Criteria andRealnameNotIn(List<String> values) {
            addCriterion("realname not in", values, "realname");
            return (Criteria) this;
        }

        public Criteria andRealnameBetween(String value1, String value2) {
            addCriterion("realname between", value1, value2, "realname");
            return (Criteria) this;
        }

        public Criteria andRealnameNotBetween(String value1, String value2) {
            addCriterion("realname not between", value1, value2, "realname");
            return (Criteria) this;
        }

        public Criteria andCardnumIsNull() {
            addCriterion("cardnum is null");
            return (Criteria) this;
        }

        public Criteria andCardnumIsNotNull() {
            addCriterion("cardnum is not null");
            return (Criteria) this;
        }

        public Criteria andCardnumEqualTo(String value) {
            addCriterion("cardnum =", value, "cardnum");
            return (Criteria) this;
        }

        public Criteria andCardnumNotEqualTo(String value) {
            addCriterion("cardnum <>", value, "cardnum");
            return (Criteria) this;
        }

        public Criteria andCardnumGreaterThan(String value) {
            addCriterion("cardnum >", value, "cardnum");
            return (Criteria) this;
        }

        public Criteria andCardnumGreaterThanOrEqualTo(String value) {
            addCriterion("cardnum >=", value, "cardnum");
            return (Criteria) this;
        }

        public Criteria andCardnumLessThan(String value) {
            addCriterion("cardnum <", value, "cardnum");
            return (Criteria) this;
        }

        public Criteria andCardnumLessThanOrEqualTo(String value) {
            addCriterion("cardnum <=", value, "cardnum");
            return (Criteria) this;
        }

        public Criteria andCardnumLike(String value) {
            addCriterion("cardnum like", value, "cardnum");
            return (Criteria) this;
        }

        public Criteria andCardnumNotLike(String value) {
            addCriterion("cardnum not like", value, "cardnum");
            return (Criteria) this;
        }

        public Criteria andCardnumIn(List<String> values) {
            addCriterion("cardnum in", values, "cardnum");
            return (Criteria) this;
        }

        public Criteria andCardnumNotIn(List<String> values) {
            addCriterion("cardnum not in", values, "cardnum");
            return (Criteria) this;
        }

        public Criteria andCardnumBetween(String value1, String value2) {
            addCriterion("cardnum between", value1, value2, "cardnum");
            return (Criteria) this;
        }

        public Criteria andCardnumNotBetween(String value1, String value2) {
            addCriterion("cardnum not between", value1, value2, "cardnum");
            return (Criteria) this;
        }

        public Criteria andAccttypeIsNull() {
            addCriterion("accttype is null");
            return (Criteria) this;
        }

        public Criteria andAccttypeIsNotNull() {
            addCriterion("accttype is not null");
            return (Criteria) this;
        }

        public Criteria andAccttypeEqualTo(Integer value) {
            addCriterion("accttype =", value, "accttype");
            return (Criteria) this;
        }

        public Criteria andAccttypeNotEqualTo(Integer value) {
            addCriterion("accttype <>", value, "accttype");
            return (Criteria) this;
        }

        public Criteria andAccttypeGreaterThan(Integer value) {
            addCriterion("accttype >", value, "accttype");
            return (Criteria) this;
        }

        public Criteria andAccttypeGreaterThanOrEqualTo(Integer value) {
            addCriterion("accttype >=", value, "accttype");
            return (Criteria) this;
        }

        public Criteria andAccttypeLessThan(Integer value) {
            addCriterion("accttype <", value, "accttype");
            return (Criteria) this;
        }

        public Criteria andAccttypeLessThanOrEqualTo(Integer value) {
            addCriterion("accttype <=", value, "accttype");
            return (Criteria) this;
        }

        public Criteria andAccttypeIn(List<Integer> values) {
            addCriterion("accttype in", values, "accttype");
            return (Criteria) this;
        }

        public Criteria andAccttypeNotIn(List<Integer> values) {
            addCriterion("accttype not in", values, "accttype");
            return (Criteria) this;
        }

        public Criteria andAccttypeBetween(Integer value1, Integer value2) {
            addCriterion("accttype between", value1, value2, "accttype");
            return (Criteria) this;
        }

        public Criteria andAccttypeNotBetween(Integer value1, Integer value2) {
            addCriterion("accttype not between", value1, value2, "accttype");
            return (Criteria) this;
        }
    }

    public static class Criteria extends GeneratedCriteria {

        protected Criteria() {
            super();
        }
    }

    public static class Criterion {
        private String condition;

        private Object value;

        private Object secondValue;

        private boolean noValue;

        private boolean singleValue;

        private boolean betweenValue;

        private boolean listValue;

        private String typeHandler;

        public String getCondition() {
            return condition;
        }

        public Object getValue() {
            return value;
        }

        public Object getSecondValue() {
            return secondValue;
        }

        public boolean isNoValue() {
            return noValue;
        }

        public boolean isSingleValue() {
            return singleValue;
        }

        public boolean isBetweenValue() {
            return betweenValue;
        }

        public boolean isListValue() {
            return listValue;
        }

        public String getTypeHandler() {
            return typeHandler;
        }

        protected Criterion(String condition) {
            super();
            this.condition = condition;
            this.typeHandler = null;
            this.noValue = true;
        }

        protected Criterion(String condition, Object value, String typeHandler) {
            super();
            this.condition = condition;
            this.value = value;
            this.typeHandler = typeHandler;
            if (value instanceof List<?>) {
                this.listValue = true;
            } else {
                this.singleValue = true;
            }
        }

        protected Criterion(String condition, Object value) {
            this(condition, value, null);
        }

        protected Criterion(String condition, Object value, Object secondValue, String typeHandler) {
            super();
            this.condition = condition;
            this.value = value;
            this.secondValue = secondValue;
            this.typeHandler = typeHandler;
            this.betweenValue = true;
        }

        protected Criterion(String condition, Object value, Object secondValue) {
            this(condition, value, secondValue, null);
        }
    }
}
```



![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660864374028-937103e0-8bf3-491d-9ef4-b5f55a61c046.png)

```java
package com.atguigu.crowd.mapper;

import com.atguigu.crowd.entity.po.MemberPO;
import com.atguigu.crowd.entity.po.MemberPOExample;
import org.apache.ibatis.annotations.Param;

import java.util.List;

public interface MemberPOMapper {
    int countByExample(MemberPOExample example);

    int deleteByExample(MemberPOExample example);

    int deleteByPrimaryKey(Integer id);

    int insert(MemberPO record);

    int insertSelective(MemberPO record);

    List<MemberPO> selectByExample(MemberPOExample example);

    MemberPO selectByPrimaryKey(Integer id);

    int updateByExampleSelective(@Param("record") MemberPO record, @Param("example") MemberPOExample example);

    int updateByExample(@Param("record") MemberPO record, @Param("example") MemberPOExample example);

    int updateByPrimaryKeySelective(MemberPO record);

    int updateByPrimaryKey(MemberPO record);
}
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.atguigu.crowd.mapper.MemberPOMapper" >
  <resultMap id="BaseResultMap" type="com.atguigu.crowd.entity.po.MemberPO" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="loginacct" property="loginacct" jdbcType="VARCHAR" />
    <result column="userpswd" property="userpswd" jdbcType="VARCHAR" />
    <result column="username" property="username" jdbcType="VARCHAR" />
    <result column="email" property="email" jdbcType="VARCHAR" />
    <result column="authstatus" property="authstatus" jdbcType="INTEGER" />
    <result column="usertype" property="usertype" jdbcType="INTEGER" />
    <result column="realname" property="realname" jdbcType="VARCHAR" />
    <result column="cardnum" property="cardnum" jdbcType="VARCHAR" />
    <result column="accttype" property="accttype" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Example_Where_Clause" >
    <where >
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause" >
    <where >
      <foreach collection="example.oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    id, loginacct, userpswd, username, email, authstatus, usertype, realname, cardnum, 
    accttype
  </sql>
  <select id="selectByExample" resultMap="BaseResultMap" parameterType="com.atguigu.crowd.entity.po.MemberPOExample" >
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from t_member
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from t_member
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from t_member
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <delete id="deleteByExample" parameterType="com.atguigu.crowd.entity.po.MemberPOExample" >
    delete from t_member
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.atguigu.crowd.entity.po.MemberPO" >
    insert into t_member (id, loginacct, userpswd, 
      username, email, authstatus, 
      usertype, realname, cardnum, 
      accttype)
    values (#{id,jdbcType=INTEGER}, #{loginacct,jdbcType=VARCHAR}, #{userpswd,jdbcType=VARCHAR}, 
      #{username,jdbcType=VARCHAR}, #{email,jdbcType=VARCHAR}, #{authstatus,jdbcType=INTEGER}, 
      #{usertype,jdbcType=INTEGER}, #{realname,jdbcType=VARCHAR}, #{cardnum,jdbcType=VARCHAR}, 
      #{accttype,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.atguigu.crowd.entity.po.MemberPO" >
    insert into t_member
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="loginacct != null" >
        loginacct,
      </if>
      <if test="userpswd != null" >
        userpswd,
      </if>
      <if test="username != null" >
        username,
      </if>
      <if test="email != null" >
        email,
      </if>
      <if test="authstatus != null" >
        authstatus,
      </if>
      <if test="usertype != null" >
        usertype,
      </if>
      <if test="realname != null" >
        realname,
      </if>
      <if test="cardnum != null" >
        cardnum,
      </if>
      <if test="accttype != null" >
        accttype,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="loginacct != null" >
        #{loginacct,jdbcType=VARCHAR},
      </if>
      <if test="userpswd != null" >
        #{userpswd,jdbcType=VARCHAR},
      </if>
      <if test="username != null" >
        #{username,jdbcType=VARCHAR},
      </if>
      <if test="email != null" >
        #{email,jdbcType=VARCHAR},
      </if>
      <if test="authstatus != null" >
        #{authstatus,jdbcType=INTEGER},
      </if>
      <if test="usertype != null" >
        #{usertype,jdbcType=INTEGER},
      </if>
      <if test="realname != null" >
        #{realname,jdbcType=VARCHAR},
      </if>
      <if test="cardnum != null" >
        #{cardnum,jdbcType=VARCHAR},
      </if>
      <if test="accttype != null" >
        #{accttype,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.atguigu.crowd.entity.po.MemberPOExample" resultType="java.lang.Integer" >
    select count(*) from t_member
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map" >
    update t_member
    <set >
      <if test="record.id != null" >
        id = #{record.id,jdbcType=INTEGER},
      </if>
      <if test="record.loginacct != null" >
        loginacct = #{record.loginacct,jdbcType=VARCHAR},
      </if>
      <if test="record.userpswd != null" >
        userpswd = #{record.userpswd,jdbcType=VARCHAR},
      </if>
      <if test="record.username != null" >
        username = #{record.username,jdbcType=VARCHAR},
      </if>
      <if test="record.email != null" >
        email = #{record.email,jdbcType=VARCHAR},
      </if>
      <if test="record.authstatus != null" >
        authstatus = #{record.authstatus,jdbcType=INTEGER},
      </if>
      <if test="record.usertype != null" >
        usertype = #{record.usertype,jdbcType=INTEGER},
      </if>
      <if test="record.realname != null" >
        realname = #{record.realname,jdbcType=VARCHAR},
      </if>
      <if test="record.cardnum != null" >
        cardnum = #{record.cardnum,jdbcType=VARCHAR},
      </if>
      <if test="record.accttype != null" >
        accttype = #{record.accttype,jdbcType=INTEGER},
      </if>
    </set>
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map" >
    update t_member
    set id = #{record.id,jdbcType=INTEGER},
      loginacct = #{record.loginacct,jdbcType=VARCHAR},
      userpswd = #{record.userpswd,jdbcType=VARCHAR},
      username = #{record.username,jdbcType=VARCHAR},
      email = #{record.email,jdbcType=VARCHAR},
      authstatus = #{record.authstatus,jdbcType=INTEGER},
      usertype = #{record.usertype,jdbcType=INTEGER},
      realname = #{record.realname,jdbcType=VARCHAR},
      cardnum = #{record.cardnum,jdbcType=VARCHAR},
      accttype = #{record.accttype,jdbcType=INTEGER}
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.atguigu.crowd.entity.po.MemberPO" >
    update t_member
    <set >
      <if test="loginacct != null" >
        loginacct = #{loginacct,jdbcType=VARCHAR},
      </if>
      <if test="userpswd != null" >
        userpswd = #{userpswd,jdbcType=VARCHAR},
      </if>
      <if test="username != null" >
        username = #{username,jdbcType=VARCHAR},
      </if>
      <if test="email != null" >
        email = #{email,jdbcType=VARCHAR},
      </if>
      <if test="authstatus != null" >
        authstatus = #{authstatus,jdbcType=INTEGER},
      </if>
      <if test="usertype != null" >
        usertype = #{usertype,jdbcType=INTEGER},
      </if>
      <if test="realname != null" >
        realname = #{realname,jdbcType=VARCHAR},
      </if>
      <if test="cardnum != null" >
        cardnum = #{cardnum,jdbcType=VARCHAR},
      </if>
      <if test="accttype != null" >
        accttype = #{accttype,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.atguigu.crowd.entity.po.MemberPO" >
    update t_member
    set loginacct = #{loginacct,jdbcType=VARCHAR},
      userpswd = #{userpswd,jdbcType=VARCHAR},
      username = #{username,jdbcType=VARCHAR},
      email = #{email,jdbcType=VARCHAR},
      authstatus = #{authstatus,jdbcType=INTEGER},
      usertype = #{usertype,jdbcType=INTEGER},
      realname = #{realname,jdbcType=VARCHAR},
      cardnum = #{cardnum,jdbcType=VARCHAR},
      accttype = #{accttype,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
</mapper>
```



## 6. `Api` å·¥ç¨‹

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660873057527-e33e6a90-37b3-4e46-96c7-df60ed3138fe.png)

------

### 6.1 ä¾èµ–

```xml
<dependencies>
    <dependency>
        <groupId>com.atguigu.crowd</groupId>
        <artifactId>atcrowdfunding05-common-util</artifactId>
        <version>1.0-SNAPSHOT</version>
    </dependency>
    <dependency>
        <groupId>com.atguigu.crowd</groupId>
        <artifactId>atcrowdfunding09-member-entity</artifactId>
        <version>1.0-SNAPSHOT</version>
    </dependency>
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-openfeign</artifactId>
    </dependency>
</dependencies>
```



### 6.2 æ¥å£

```java
package com.atguigu.crowd.api;

import com.atguigu.crowd.entity.po.MemberPO;
import com.atguigu.crowd.util.ResultEntity;
import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

/**
 * @author chenjianglin
 * @date 2022/8/19 09:05
 */
@FeignClient("atguigu-crowd-mysql")
public interface MySQLRemoteService {

    /**
     * æ ¹æ®è´¦å·æŸ¥è¯¢
     * 
     * @param loginacc è´¦å·
     * @return
     */
    @RequestMapping("/get/memberpo/login/acct/remote")
    ResultEntity<MemberPO> getMemberPOByLoginAcctRemote(@RequestParam("loginacc") String loginacc);

}
```



### 6.3 `MySQL`å·¥ç¨‹å¯¹å¤–æš´éœ²æœåŠ¡

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660874434538-669f0b42-a24d-4844-8b9a-0ab06d2df13d.png)

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660872968226-313cbd18-aebb-4ca0-becc-7fdcaebd4f4c.png)

------

#### 6.3.1 `Hnadler` ä»£ç 

```java
package com.atguigu.crowd.handler;

import com.atguigu.crowd.entity.po.MemberPO;
import com.atguigu.crowd.service.api.MemberService;
import com.atguigu.crowd.util.ResultEntity;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

/**
 * @author chenjianglin
 * @date 2022/8/19 09:11
 */
@RestController
public class MemberProviderHandler {

    @Autowired
    private MemberService memberService;

    @RequestMapping("/get/memberpo/login/acct/remote")
    public ResultEntity<MemberPO> getMemberPOByLoginAcctRemote(@RequestParam("loginacct") String loginacct) {
        try {
            // è°ƒç”¨æœ¬åœ° Service å®ŒæˆæŸ¥è¯¢
            MemberPO memberPO = memberService.getMemberPOByLoginAcct(loginacct);
            // å¦‚æœæ²¡æœ‰æŠ›å¼‚å¸¸, é‚£ä¹ˆå°±è¿”å›æˆåŠŸçš„ç»“æœ
            return ResultEntity.successWithData(memberPO);
        } catch (Exception e){
            // å¦‚æœæ•è·åˆ°å¼‚å¸¸åˆ™è¿”å›å¤±è´¥çš„ç»“æœ
            return ResultEntity.failed(e.getMessage());
        }
    }
}
```

#### 6.3.2 `Service` æ¥å£

```java
package com.atguigu.crowd.service.api;

import com.atguigu.crowd.entity.po.MemberPO;

/**
 * @author chenjianglin
 * @date 2022/8/19 09:15
 */
public interface MemberService {

    /**
     * æ ¹æ®è´¦å·æŸ¥è¯¢
     *
     * @param loginacct è´¦å·
     * @return
     */
    MemberPO getMemberPOByLoginAcct(String loginacct);

}
```

#### 6.3.3 `Service` ç±»çš„ä»£ç 

```java
package com.atguigu.crowd.service.impl;

import com.atguigu.crowd.entity.po.MemberPO;
import com.atguigu.crowd.entity.po.MemberPOExample;
import com.atguigu.crowd.mapper.MemberPOMapper;
import com.atguigu.crowd.service.api.MemberService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;

/**
 * ## 1.åœ¨ç±»ä¸Šä½¿ç”¨ @Transactional(readOnly = true)
 * - é’ˆå¯¹æŸ¥è¯¢æ“ä½œè®¾ç½®äº‹åŠ¡å±æ€§
 *
 * @author chenjianglin
 * @date 2022/8/19 09:16
 */
@Transactional(readOnly = true)
@Service
public class MemberServiceImpl implements MemberService {

    @Autowired
    private MemberPOMapper memberPOMapper;

    @Override
    public MemberPO getMemberPOByLoginAcct(String loginacct) {
        // åˆ›å»º Example å¯¹è±¡
        MemberPOExample memberPOExample = new MemberPOExample();

        // åˆ›å»º Criteria å¯¹è±¡
        MemberPOExample.Criteria criteria = memberPOExample.createCriteria();

        // å°è£…æŸ¥è¯¢æ¡ä»¶
        criteria.andLoginacctEqualTo(loginacct);

        // æ‰§è¡ŒæŸ¥è¯¢
        List<MemberPO> list = memberPOMapper.selectByExample(memberPOExample);

        // 5.è·å–ç»“æœ
        if(list == null || list.size() == 0) {
            return null;
        }
        
        return list.get(0);
    }
}
```



## 7. `Redis` å·¥ç¨‹

- ç›®æ ‡: æŠ½å–é¡¹ç›®ä¸­æ‰€æœ‰è®¿é—® `Redis` çš„æ“ä½œ

### 7.1 `Linux` è‡ªåŠ¨å®‰è£… `Redis`

```bash
wget -c http://mirrors.linuxeye.com/oneinstack-full.tar.gz && tar xzf oneinstack-full.tar.gz && ./oneinstack/install.sh --redis 
```

- ä¿®æ”¹redisçš„é…ç½®æ–‡ä»¶: `redis.conf`, æ³¨é‡Šæ‰é…ç½®æ–‡ä»¶é‡Œçš„è¿™ä¸€è¡Œ: `bind 127.0.0.1`
- å°†`protected-mode yes `æ”¹æˆ:`protected-mode no` æ„æ€æ˜¯ä¸ä½¿ç”¨å¯†ç ç™»å½•

### 7.2 Reids å‘½ä»¤åˆ—è¡¨

| å‘½ä»¤                                                         | è¯´æ˜                    |
| ------------------------------------------------------------ | ----------------------- |
| `/usr/local/redis/bin/redis-server /usr/local/redis/etc/redis.conf` | å¯åŠ¨ `Linux` çš„ `Redis` |
| `ps -ef | grep redis | grep -v grep`                         | æŸ¥çœ‹ `Redis`            |
| `/usr/local/redis/bin/redis-cli -h 127.0.0.1`                | ç™»å½• `Redis`            |
| `keys *`                                                     | æŸ¥çœ‹æ‰€æœ‰                |
|                                                              |                         |

#### 7.2.1 æŸ¥çœ‹ `Redis`

```bash
ps -ef | grep redis | grep -v grep
```

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660876054593-ee6dedc3-0f21-4ca4-bc8a-9f4e8b3c5b27.png)



### 7.3 å·¥ç¨‹ä¾èµ–

```xml
<dependencies>
    <!-- æ•´åˆ Redis -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-redis</artifactId>
    </dependency>

    <!-- SpringBoot æµ‹è¯• -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
</dependencies>

<build>
    <plugins>
        <!-- è¿™ä¸ªæ’ä»¶å°† SpringBoot åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„ jar åŒ… -->
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
            <executions>
                <execution>
                    <goals>
                        <goal>repackage</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```



### 7.4 ä¸»å¯åŠ¨ç±»

```java
package com.atguigu.crowd;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

/**
 * @author chenjianglin
 * @date 2022/8/19 11:05
 */
@SpringBootApplication
public class CrowdMainClass {

    public static void main(String[] args) {
        SpringApplication.run(CrowdMainClass.class, args);
    }

}
```

### 7.5 æ–°å»º `application.yml` é…ç½®

```yaml
server:
  port: 3000

spring:
  application:
    name: atguigu-crowd-redis
  redis:
    host: 127.0.0.1

eureka:
  client:
    service-url:
      defaultZone: http://localhost:1000/eureka
```



### 7.6 æµ‹è¯•ç±»

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1660955755275-432e9dd7-f4ca-4f41-9b66-7bf765b03458.png)

------

```java
package com.atguigu.crowd;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.data.redis.core.ValueOperations;
import org.springframework.test.context.junit4.SpringRunner;

/**
 * @author chenjianglin
 * @date 2022/8/19 11:14
 */
@RunWith(SpringRunner.class)
@SpringBootTest
public class RedisTest {

    // private Logger logger = LoggerFactory.getLogger(RedisTest.class);

    @Autowired
    private StringRedisTemplate redisTemplate;

    @Test
    public void testSet(){
        ValueOperations<String, String> operations = redisTemplate.opsForValue();

        operations.set("apple", "red");
    }

}
```



## 8. `Redis` å·¥ç¨‹å¯¹å¤–æš´éœ²æœåŠ¡

### 8.1 `API` å·¥ç¨‹

#### 8.1.1 æ–°å»º `RedisRemoteService`æ¥å£

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661693533381-25454274-ea82-4072-b4ff-8ecfe4a2e96b.png)

```java
package com.atguigu.crowd.api;

import com.atguigu.crowd.util.ResultEntity;
import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import java.util.concurrent.TimeUnit;

/**
 * @author é™ˆæ±Ÿæ—
 * @date 2022/8/28 21:30
 */
@FeignClient("atguigu-crowd-redis")
public interface RedisRemoteService {

    /**
     * ä¿å­˜
     *
     * @param key
     * @param value
     * @return
     */
    @RequestMapping("/set/redis/key/value/remote")
    ResultEntity<String> setRedisKeyValueRemote(
            @RequestParam("key") String key,
            @RequestParam("value") String value);

    /**
     * è®¾ç½®å¸¦è¶…æ—¶æ—¶é—´çš„
     *
     * @param key
     * @param value
     * @param time  æ—¶é—´
     * @param timeUnit æ—¶é—´å•ä½
     * @return
     */
    @RequestMapping("/set/redis/key/value/remote/with/timeout")
    ResultEntity<String> setRedisKeyValueRemoteWithTimeout(
            @RequestParam("key") String key,
            @RequestParam("value") String value,
            @RequestParam("time") long time,
            @RequestParam("timeUnit") TimeUnit timeUnit);

    /**
     * æ ¹æ® Key è·å–
     *
     * @param key
     * @return
     */
    @RequestMapping("get/redis/key/value/by/key")
    ResultEntity<String> getRedisKeyValueByKey(@RequestParam("key") String key);

    /**
     * æ ¹æ® Key åˆ é™¤
     *
     * @param key
     * @return
     */
    @RequestMapping("remove/redis/key/remote")
    ResultEntity<String> removeRedisKeyRemote(@RequestParam("key") String key);

}
```



### 8.2 `Redis` å·¥ç¨‹

#### 8.2.1 å¯¹å¤–æš´éœ²æœåŠ¡ è¿½åŠ ä¾èµ–

```xml
<!-- å¯¹å¤–æš´éœ²æœåŠ¡ -->
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-web</artifactId>
</dependency>

<!-- ä½œä¸ºå®¢æˆ·ç«¯è®¿é—® Eureka æ³¨å†Œä¸­å¿ƒ -->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
</dependency>

<!-- ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨å·¥å…·ç±» -->
<dependency>
    <groupId>com.atguigu.crowd</groupId>
    <artifactId>atcrowdfunding05-common-util</artifactId>
    <version>1.0-SNAPSHOT</version>
</dependency>

<!-- ä¸ºèƒ½å¤Ÿä½¿ç”¨å®ä½“ç±» -->
<dependency>
    <groupId>com.atguigu.crowd</groupId>
    <artifactId>atcrowdfunding09-member-entity</artifactId>
    <version>1.0-SNAPSHOT</version>
</dependency>
```



#### 8.2.2 è¿½åŠ  `RedisTest` æµ‹è¯•æ–¹æ³•

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661693754588-d693a971-4c03-43d9-825c-6b35203fe027.png)

------

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661693807950-a6dd3c89-2645-47d4-878e-7499353994af.png)

```java
@Test 
public void testExSet() {
    ValueOperations<String, String> operations = redisTemplate.opsForValue();
    
    // å­˜æ´» 5000 ç§’
    operations.set("banana", "yellow", 5000, TimeUnit.SECONDS);
}
```



#### 8.2.3 æ–°å»º `handler` åŒ…, æ–°å»º `RedisHandler` ç±»

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661694452017-1143ea90-2378-45f8-9751-dfb107d6265a.png)

```java
package com.atguigu.crowd.handler;

import com.atguigu.crowd.util.ResultEntity;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.data.redis.core.ValueOperations;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import java.util.concurrent.TimeUnit;

/**
 * @author é™ˆæ±Ÿæ—
 * @date 2022/8/28 21:39
 */
@RestController
public class RedisHandler {

    @Autowired
    private StringRedisTemplate redisTemplate;

    /**
     * ä¿å­˜
     *
     * @param key
     * @param value
     * @return
     */
    @RequestMapping("/set/redis/key/value/remote")
    ResultEntity<String> setRedisKeyValueRemote(
            @RequestParam("key") String key,
            @RequestParam("value") String value) {
        try {
            ValueOperations<String, String> operations = redisTemplate.opsForValue();
            operations.set(key, value);

            return ResultEntity.successWithoutData();
        } catch(Exception e) {
            return ResultEntity.failed(e.getMessage());
        }
    }

    /**
     * è®¾ç½®å¸¦è¶…æ—¶æ—¶é—´çš„
     *
     * @param key
     * @param value
     * @param time æ—¶é—´
     * @param timeUnit æ—¶é—´å•ä½
     * @return
     */
    @RequestMapping("/set/redis/key/value/remote/with/timeout")
    ResultEntity<String> setRedisKeyValueRemoteWithTimeout(
            @RequestParam("key") String key,
            @RequestParam("value") String value,
            @RequestParam("time") long time,
            @RequestParam("timeUnit") TimeUnit timeUnit) {
        try {
            ValueOperations<String, String> operations = redisTemplate.opsForValue();
            operations.set(key, value, time, timeUnit);

            return ResultEntity.successWithoutData();
        } catch(Exception e) {
            return ResultEntity.failed(e.getMessage());
        }
    }

    /**
     * æ ¹æ® Key è·å–
     *
     * @param key
     * @return
     */
    @RequestMapping("get/redis/key/value/by/key")
    ResultEntity<String> getRedisKeyValueByKey(@RequestParam("key") String key) {
        try {
            ValueOperations<String, String> operations = redisTemplate.opsForValue();
            String value = operations.get(key);

            return ResultEntity.successWithData(value);
        } catch(Exception e) {
            return ResultEntity.failed(e.getMessage());
        }
    }

    /**
     * æ ¹æ® Key åˆ é™¤
     *
     * @param key
     * @return
     */
    @RequestMapping("remove/redis/key/remote")
    ResultEntity<String> removeRedisKeyRemote(@RequestParam("key") String key) {
        try {
            redisTemplate.delete(key);

            return ResultEntity.successWithoutData();
        } catch(Exception e) {
            return ResultEntity.failed(e.getMessage());
        }
    }
}
```



## 9. `authentication` ä¼šå‘˜ä¸­å¿ƒå·¥ç¨‹

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661697476147-0cd37190-ad03-45fc-b846-7f553c6858a4.png)

------

### 9.1 ä¾èµ–

```xml
<dependencies>
  <!-- å¯¹å¤–æš´éœ²æœåŠ¡ -->
  <dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
  </dependency>
  
  <!-- æ•´åˆè§†å›¾ -->
  <dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-thymeleaf</artifactId>
  </dependency>
  
  <!-- ä½œä¸ºå®¢æˆ·ç«¯è®¿é—® Eureka æ³¨å†Œä¸­å¿ƒ -->
  <dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
  </dependency>
  
  <dependency>
      <groupId>com.atguigu.crowd</groupId>
      <artifactId>atcrowdfunding17-member-api</artifactId>
      <version>1.0-SNAPSHOT</version>
  </dependency>
</dependencies>

<build>
    <plugins>
        <!-- è¿™ä¸ªæ’ä»¶å°† SpringBoot åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„ jar åŒ… -->
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
            <executions>
                <execution>
                    <goals>
                        <goal>repackage</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```



### 9.2 æ–°å»º `CrowdMainClass` ä¸»å¯åŠ¨ç±»

```java
package com.atguigu.crowd;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;
import org.springframework.cloud.openfeign.EnableFeignClients;

/**
 * `@EnableFeignClients` å¯ç”¨ Feign å®¢æˆ·ç«¯åŠŸèƒ½
 * `@EnableDiscoveryClient` å½“å‰ç‰ˆæœ¬å¯ä»¥ä¸å†™
 *
 * @author é™ˆæ±Ÿæ—
 * @date 2022/8/28 21:51
 */
@EnableFeignClients
@EnableDiscoveryClient
@SpringBootApplication
public class CrowdMainClass {

    public static void main(String[] args) {
        SpringApplication.run(CrowdMainClass.class, args);
    }

}
```



### 9.3 æ–°å»º `application.yml` é…ç½®

```yaml
server:
  port: 4000

spring:
  application:
    name: atguigu-crowd-auth

eureka:
  client:
    service-url:
      defaultZone: http://localhost:1000/eureka

ribbon:
  # 10ç§’ - å¤„ç†è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º5ç§’
  ReadTimeout: 10000
  # 10ç§’ - è¿æ¥å»ºç«‹çš„è¶…æ—¶æ—¶é•¿ï¼Œé»˜è®¤5ç§’
  ConnectTimeout: 10000
```



#### 9.3.1 æ–°å»ºåŒ… `templates`ã€`static`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661696005316-59625806-3823-456f-a226-213501b49623.png)



### 9.4 æ–°å»º `PortalHandler` ç±»

```java
package com.atguigu.crowd.handler;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

/**
 * @author é™ˆæ±Ÿæ—
 * @date 2022/8/28 22:14
 */
@Controller
public class PortalHandler {

    /**
     * æ˜¾ç¤ºé¦–é¡µ
     * 
     * @return
     */
    @RequestMapping("/")
    public String toPortalPage() {
        // è¿™é‡Œå®é™…å¼€å‘ä¸­éœ€è¦è·å–æ•°æ®

        return "portal";
    }

}
```



### 9.5 æ–°å»º `portal.html` é¦–é¡µ

```html
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <base th:href="@{/}">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/carousel.css">
    <script src="jquery/jquery-2.1.1.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="script/docs.min.js"></script>
    <script src="script/back-to-top.js"></script>
    <script>
        $(".thumbnail img").css("cursor", "pointer");
        $(".thumbnail img").click(function () {
            window.location.href = "project.html";
        });
    </script>
    <style>
        h3 {
            font-weight: bold;
        }

        #footer {
            padding: 15px 0;
            background: #fff;
            border-top: 1px solid #ddd;
            text-align: center;
        }

        #topcontrol {
            color: #fff;
            z-index: 99;
            width: 30px;
            height: 30px;
            font-size: 20px;
            background: #222;
            position: relative;
            right: 14px !important;
            bottom: 11px !important;
            border-radius: 3px !important;
        }

        #topcontrol:after {
            /*top: -2px;*/
            left: 8.5px;
            content: "\f106";
            position: absolute;
            text-align: center;
            font-family: FontAwesome;
        }

        #topcontrol:hover {
            color: #fff;
            background: #18ba9b;
            -webkit-transition: all 0.3s ease-in-out;
            -moz-transition: all 0.3s ease-in-out;
            -o-transition: all 0.3s ease-in-out;
            transition: all 0.3s ease-in-out;
        }

        /* ä¾§æ å¯¼èˆª */
        .sideBox {
            padding: 10px;
            height: 220px;
            background: #fff;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .sideBox .hd {
            height: 30px;
            line-height: 30px;
            background: #f60;
            padding: 0 10px;
            text-align: center;
            overflow: hidden;
        }

        .sideBox .hd .more {
            color: #fff;
        }

        .sideBox .hd h3 span {
            font-weight: bold;
            font-size: 14px;
            color: #fff;
        }

        .sideBox .bd {
            padding: 5px 0 0;
        }

        #sideMenu .bd li {
            margin-bottom: 2px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            overflow: hidden;
        }

        #sideMenu .bd li a {
            display: block;
            background: #EAE6DD;
        }

        #sideMenu .bd li a:hover {
            background: #D5CFBF;
        }

        /* åˆ—è¡¨é¡µ */
        #mainBox {
            margin-bottom: 10px;
            padding: 10px;
            background: #fff;
            overflow: hidden;
        }

        #mainBox .mHd {
            border-bottom: 2px solid #09c;
            height: 30px;
            line-height: 30px;
        }

        #mainBox .mHd h3 {
            display: initial;
            *display: inline;
            zoom: 1;
            padding: 0 15px;
            background: #09c;
            color: #fff;
        }

        #mainBox .mHd h3 span {
            color: #fff;
            font-size: 14px;
            font-weight: bold;
        }

        #mainBox .path {
            float: right;
        }

        /* ä½ç½®å¯¼èˆª */
        .path {
            height: 30px;
            line-height: 30px;
            padding-left: 10px;
        }

        .path a, .path span {
            margin: 0 5px;
        }

        /* æ–‡ç« åˆ—è¡¨ */
        .newsList {
            padding: 10px;
            text-align: left;
        }

        .newsList li {
            background: url("../images/share/point.png") no-repeat 2px 14px;
            padding-left: 10px;
            height: 30px;
            line-height: 30px;
        }

        .newsList li a {
            display: inline-block;
            *display: inline;
            zoom: 1;
            font-size: 14px;
        }

        .newsList li .date {
            float: right;
            color: #999;
        }

        .newsList li.split {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dotted #ddd;
            height: 0px;
            line-height: 0px;
            overflow: hidden;
        }

        /* é€šç”¨å¸¦å›¾ç‰‡çš„ä¿¡æ¯åˆ—è¡¨_æ™®é€šå¼ */
        .picList {
            padding: 10px;
            text-align: left;
        }

        .picList li {
            margin: 0 5px;
            height: 190px;
        }

        h3.break {
            font-size: 16px;
            display: block;
            white-space: nowrap;
            word-wrap: normal;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        h3.break > a {
            text-decoration: none;
        }

    </style>
</head>
<body>
<div class="navbar-wrapper">
    <div class="container">
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand" href="index.html" style="font-size:32px;">å°šç­¹ç½‘-åˆ›æ„äº§å“ä¼—ç­¹å¹³å°</a>
                </div>
                <div id="navbar" class="navbar-collapse collapse" style="float:right;">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="login.html">ç™»å½•</a></li>
                        <li><a href="reg.html">æ³¨å†Œ</a></li>
                        <li><a>|</a></li>
                        <li><a href="admin-login.html">ç®¡ç†å‘˜å…¥å£</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
</div>


<!-- Carousel
================================================== -->
<div id="myCarousel" class="carousel slide" data-ride="carousel">
    <!-- Indicators -->
    <ol class="carousel-indicators">
        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
        <li data-target="#myCarousel" data-slide-to="1"></li>
        <li data-target="#myCarousel" data-slide-to="2"></li>
    </ol>
    <div class="carousel-inner" role="listbox">
        <div class="item active" onclick="window.location.href='project.html'" style="cursor:pointer;">
            <img src="img/carousel-1.jpg" alt="First slide">
        </div>
        <div class="item" onclick="window.location.href='project.html'" style="cursor:pointer;">
            <img src="img/carousel-2.jpg" alt="Second slide">
        </div>
        <div class="item" onclick="window.location.href='project.html'" style="cursor:pointer;">
            <img src="img/carousel-3.jpg" alt="Third slide">
        </div>
    </div>
    <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left"></span>
        <span class="sr-only">Previous</span>
    </a>
    <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right"></span>
        <span class="sr-only">Next</span>
    </a>
</div><!-- /.carousel -->


<!-- Marketing messaging and featurettes
================================================== -->
<!-- Wrap the rest of the page in another container to center all the content. -->

<div class="container marketing">

    <!-- Three columns of text below the carousel -->
    <div class="row">
        <div class="col-lg-4">
            <img class="img-circle" src="img/p1.jpg" alt="Generic placeholder image"
                 style="width: 140px; height: 140px;">
            <h2>æ™ºèƒ½é«˜æ¸…ç›‘æ§æœºå™¨äºº</h2>
            <p>å¯çˆ±çš„é€ å‹ï¼Œæ‘„åƒå®‰é˜²è¿œç¨‹äº’è”çš„å…¨èƒ½è®¾è®¡ï¼Œè®©ä½ éšæ—¶éšåœ°å®ˆæŠ¤æ‚¨çš„å®¶äººï¼Œé™ªä¼´ä½ çš„ç”Ÿæ´»ã€‚</p>
            <p><a class="btn btn-default" href="project.html" role="button">é¡¹ç›®è¯¦æƒ… &raquo;</a></p>
        </div><!-- /.col-lg-4 -->
        <div class="col-lg-4">
            <img class="img-circle" src="img/p2.jpg" alt="Generic placeholder image"
                 style="width: 140px; height: 140px;">
            <h2>NEOKAæ™ºèƒ½æ‰‹ç¯</h2>
            <p>è¦è¿åŠ¨æ›´è¦å®‰å…¨ï¼Œè¿™æ¬¾ã€åä¸ºâ€œè¶èˆâ€çš„NEOKA-V9100æ™ºèƒ½è¿åŠ¨æ‰‹ç¯ä¸ºâ€œå®‰å…¨è¿åŠ¨è€Œç”Ÿâ€ã€‚</p>
            <p><a class="btn btn-default" href="project.html" role="button">é¡¹ç›®è¯¦æƒ… &raquo;</a></p>
        </div><!-- /.col-lg-4 -->
        <div class="col-lg-4">
            <img class="img-circle" src="img/p3.png" alt="Generic placeholder image"
                 style="width: 140px; height: 140px;">
            <h2>é©±èšŠæ‰£</h2>
            <p>éšå¤„ä½¿ç”¨çš„é©±èšŠçº½æ‰£ï¼Œ<br>è§£å†³å¤å­£èšŠè™«é—®é¢˜ã€‚</p>
            <p><a class="btn btn-default" href="project.html" role="button">é¡¹ç›®è¯¦æƒ… &raquo;</a></p>
        </div><!-- /.col-lg-4 -->
    </div><!-- /.row -->

    <div class="container">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <div class="box ui-draggable" id="mainBox">
                    <div class="mHd" style="">
                        <div class="path">
                            <a href="projects.html">æ›´å¤š...</a>
                        </div>
                        <h3>
                            ç§‘æŠ€ <small style="color:#FFF;">å¼€å¯æ™ºæ…§æœªæ¥</small>
                        </h3>
                    </div>
                    <div class="mBd" style="padding-top:10px;">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="thumbnail">
                                    <img alt="300x200" src="img/product-1.jpg"/>
                                    <div class="caption">
                                        <h3 class="break">
                                            <a href="project.html">æ´»æ€§å¯Œæ°¢å‡€æ°´ç›´é¥®æœº</a>
                                        </h3>
                                        <p>
                                        <div style="float:left;"><i class="glyphicon glyphicon-screenshot"
                                                                    title="ç›®æ ‡é‡‘é¢"></i> $20,000
                                        </div>
                                        <div style="float:right;"><i title="æˆªè‡³æ—¥æœŸ"
                                                                     class="glyphicon glyphicon-calendar"></i>
                                            2017-20-20
                                        </div>
                                        </p>
                                        <br>
                                        <div class="progress" style="margin-bottom: 4px;">
                                            <div class="progress-bar progress-bar-success" role="progressbar"
                                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 40%">
                                                <span>40% </span>
                                            </div>
                                        </div>
                                        <div><span style="float:right;"><i
                                                class="glyphicon glyphicon-star-empty"></i></span> <span><i
                                                class="glyphicon glyphicon-user" title="æ”¯æŒäººæ•°"></i> 12345</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="thumbnail">
                                    <img alt="300x200" src="img/product-2.gif"/>
                                    <div class="caption">
                                        <h3 class="break">
                                            <a href="project.html">é…·é©°è§¦æ§é¾™å¤´ï¼Œæ™ºäº«å¨æˆ¿é»‘ç§‘æŠ€</a>
                                        </h3>
                                        <p>
                                        <div style="float:left;"><i class="glyphicon glyphicon-screenshot"
                                                                    title="ç›®æ ‡é‡‘é¢"></i> $20,000
                                        </div>
                                        <div style="float:right;"><i title="æˆªè‡³æ—¥æœŸ"
                                                                     class="glyphicon glyphicon-calendar"></i>
                                            2017-20-20
                                        </div>
                                        </p>
                                        <br>
                                        <div class="progress" style="margin-bottom: 4px;">
                                            <div class="progress-bar progress-bar-success" role="progressbar"
                                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 40%">
                                                <span>40% </span>
                                            </div>
                                        </div>
                                        <div><span style="float:right;"><i
                                                class="glyphicon glyphicon-star-empty"></i></span> <span><i
                                                class="glyphicon glyphicon-user" title="æ”¯æŒäººæ•°"></i> 12345</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="thumbnail">
                                    <img alt="300x200" src="img/product-3.png"/>
                                    <div class="caption">
                                        <h3 class="break">
                                            <a href="project.html">å°ç†ŠçŒ«é±¼çœ¼å…¨æ™¯å®‰é˜²æ‘„åƒæœº</a>
                                        </h3>
                                        <p>
                                        <div style="float:left;"><i class="glyphicon glyphicon-screenshot"
                                                                    title="ç›®æ ‡é‡‘é¢"></i> $20,000
                                        </div>
                                        <div style="float:right;"><i title="æˆªè‡³æ—¥æœŸ"
                                                                     class="glyphicon glyphicon-calendar"></i>
                                            2017-20-20
                                        </div>
                                        </p>
                                        <br>
                                        <div class="progress" style="margin-bottom: 4px;">
                                            <div class="progress-bar progress-bar-success" role="progressbar"
                                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 40%">
                                                <span>40% </span>
                                            </div>
                                        </div>
                                        <div><span style="float:right;"><i
                                                class="glyphicon glyphicon-star-empty"></i></span> <span><i
                                                class="glyphicon glyphicon-user" title="æ”¯æŒäººæ•°"></i> 12345</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="thumbnail">
                                    <img alt="300x200" src="img/product-4.jpg"/>
                                    <div class="caption">
                                        <h3 class="break">
                                            <a href="project.html">ä¸€æ¬¾ç²¾è‡´çš„æœºæ¢°è¡¨</a>
                                        </h3>
                                        <p>
                                        <div style="float:left;"><i class="glyphicon glyphicon-screenshot"
                                                                    title="ç›®æ ‡é‡‘é¢"></i> $20,000
                                        </div>
                                        <div style="float:right;"><i title="æˆªè‡³æ—¥æœŸ"
                                                                     class="glyphicon glyphicon-calendar"></i>
                                            2017-20-20
                                        </div>
                                        </p>
                                        <br>
                                        <div class="progress" style="margin-bottom: 4px;">
                                            <div class="progress-bar progress-bar-success" role="progressbar"
                                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 40%">
                                                <span>40% </span>
                                            </div>
                                        </div>
                                        <div><span style="float:right;"><i
                                                class="glyphicon glyphicon-star-empty"></i></span> <span><i
                                                class="glyphicon glyphicon-user" title="æ”¯æŒäººæ•°"></i> 12345</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="container">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <div class="box ui-draggable" id="mainBox">
                    <div class="mHd" style="">
                        <div class="path">
                            <a href="projects.html">æ›´å¤š...</a>
                        </div>
                        <h3>
                            è®¾è®¡ <small style="color:#FFF;">åˆ›æ„æ”¹å˜ç”Ÿæ´»</small>
                        </h3>
                    </div>
                    <div class="mBd" style="padding-top:10px;">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="thumbnail">
                                    <img alt="300x200" src="img/product-5.jpg"/>
                                    <div class="caption">
                                        <h3 class="break">
                                            <a href="project.html">æ´»æ€§å¯Œæ°¢å‡€æ°´ç›´é¥®æœº</a>
                                        </h3>
                                        <p>
                                        <div style="float:left;"><i class="glyphicon glyphicon-screenshot"
                                                                    title="ç›®æ ‡é‡‘é¢"></i> $20,000
                                        </div>
                                        <div style="float:right;"><i title="æˆªè‡³æ—¥æœŸ"
                                                                     class="glyphicon glyphicon-calendar"></i>
                                            2017-20-20
                                        </div>
                                        </p>
                                        <br>
                                        <div class="progress" style="margin-bottom: 4px;">
                                            <div class="progress-bar progress-bar-success" role="progressbar"
                                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 40%">
                                                <span>40% </span>
                                            </div>
                                        </div>
                                        <div><span style="float:right;"><i
                                                class="glyphicon glyphicon-star-empty"></i></span> <span><i
                                                class="glyphicon glyphicon-user" title="æ”¯æŒäººæ•°"></i> 12345</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="thumbnail">
                                    <img alt="300x200" src="img/product-6.jpg"/>
                                    <div class="caption">
                                        <h3 class="break">
                                            <a href="project.html">é…·é©°è§¦æ§é¾™å¤´ï¼Œæ™ºäº«å¨æˆ¿é»‘ç§‘æŠ€</a>
                                        </h3>
                                        <p>
                                        <div style="float:left;"><i class="glyphicon glyphicon-screenshot"
                                                                    title="ç›®æ ‡é‡‘é¢"></i> $20,000
                                        </div>
                                        <div style="float:right;"><i title="æˆªè‡³æ—¥æœŸ"
                                                                     class="glyphicon glyphicon-calendar"></i>
                                            2017-20-20
                                        </div>
                                        </p>
                                        <br>
                                        <div class="progress" style="margin-bottom: 4px;">
                                            <div class="progress-bar progress-bar-success" role="progressbar"
                                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 40%">
                                                <span>40% </span>
                                            </div>
                                        </div>
                                        <div><span style="float:right;"><i
                                                class="glyphicon glyphicon-star-empty"></i></span> <span><i
                                                class="glyphicon glyphicon-user" title="æ”¯æŒäººæ•°"></i> 12345</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="thumbnail">
                                    <img alt="300x200" src="img/product-7.jpg"/>
                                    <div class="caption">
                                        <h3 class="break">
                                            <a href="project.html">å°ç†ŠçŒ«é±¼çœ¼å…¨æ™¯å®‰é˜²æ‘„åƒæœº</a>
                                        </h3>
                                        <p>
                                        <div style="float:left;"><i class="glyphicon glyphicon-screenshot"
                                                                    title="ç›®æ ‡é‡‘é¢"></i> $20,000
                                        </div>
                                        <div style="float:right;"><i title="æˆªè‡³æ—¥æœŸ"
                                                                     class="glyphicon glyphicon-calendar"></i>
                                            2017-20-20
                                        </div>
                                        </p>
                                        <br>
                                        <div class="progress" style="margin-bottom: 4px;">
                                            <div class="progress-bar progress-bar-success" role="progressbar"
                                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 40%">
                                                <span>40% </span>
                                            </div>
                                        </div>
                                        <div><span style="float:right;"><i
                                                class="glyphicon glyphicon-star-empty"></i></span> <span><i
                                                class="glyphicon glyphicon-user" title="æ”¯æŒäººæ•°"></i> 12345</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="thumbnail">
                                    <img alt="300x200" src="img/product-8.jpg"/>
                                    <div class="caption">
                                        <h3 class="break">
                                            <a href="project.html">ä¸€æ¬¾ç²¾è‡´çš„æœºæ¢°è¡¨</a>
                                        </h3>
                                        <p>
                                        <div style="float:left;"><i class="glyphicon glyphicon-screenshot"
                                                                    title="ç›®æ ‡é‡‘é¢"></i> $20,000
                                        </div>
                                        <div style="float:right;"><i title="æˆªè‡³æ—¥æœŸ"
                                                                     class="glyphicon glyphicon-calendar"></i>
                                            2017-20-20
                                        </div>
                                        </p>
                                        <br>
                                        <div class="progress" style="margin-bottom: 4px;">
                                            <div class="progress-bar progress-bar-success" role="progressbar"
                                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 40%">
                                                <span>40% </span>
                                            </div>
                                        </div>
                                        <div><span style="float:right;"><i
                                                class="glyphicon glyphicon-star-empty"></i></span> <span><i
                                                class="glyphicon glyphicon-user" title="æ”¯æŒäººæ•°"></i> 12345</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="container">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <div class="box ui-draggable" id="mainBox">
                    <div class="mHd" style="">
                        <div class="path">
                            <a href="projects.html">æ›´å¤š...</a>
                        </div>
                        <h3>
                            å†œä¸š <small style="color:#FFF;">ç½‘ç»œå¤©ä¸‹è‚¥ç¾</small>
                        </h3>
                    </div>
                    <div class="mBd" style="padding-top:10px;">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="thumbnail">
                                    <img alt="300x200" src="img/product-9.jpg"/>
                                    <div class="caption">
                                        <h3 class="break">
                                            <a href="project.html">æ´»æ€§å¯Œæ°¢å‡€æ°´ç›´é¥®æœº</a>
                                        </h3>
                                        <p>
                                        <div style="float:left;"><i class="glyphicon glyphicon-screenshot"
                                                                    title="ç›®æ ‡é‡‘é¢"></i> $20,000
                                        </div>
                                        <div style="float:right;"><i title="æˆªè‡³æ—¥æœŸ"
                                                                     class="glyphicon glyphicon-calendar"></i>
                                            2017-20-20
                                        </div>
                                        </p>
                                        <br>
                                        <div class="progress" style="margin-bottom: 4px;">
                                            <div class="progress-bar progress-bar-success" role="progressbar"
                                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 40%">
                                                <span>40% </span>
                                            </div>
                                        </div>
                                        <div><span style="float:right;"><i
                                                class="glyphicon glyphicon-star-empty"></i></span> <span><i
                                                class="glyphicon glyphicon-user" title="æ”¯æŒäººæ•°"></i> 12345</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="thumbnail">
                                    <img alt="300x200" src="img/product-2.gif"/>
                                    <div class="caption">
                                        <h3 class="break">
                                            <a href="project.html">é…·é©°è§¦æ§é¾™å¤´ï¼Œæ™ºäº«å¨æˆ¿é»‘ç§‘æŠ€</a>
                                        </h3>
                                        <p>
                                        <div style="float:left;"><i class="glyphicon glyphicon-screenshot"
                                                                    title="ç›®æ ‡é‡‘é¢"></i> $20,000
                                        </div>
                                        <div style="float:right;"><i title="æˆªè‡³æ—¥æœŸ"
                                                                     class="glyphicon glyphicon-calendar"></i>
                                            2017-20-20
                                        </div>
                                        </p>
                                        <br>
                                        <div class="progress" style="margin-bottom: 4px;">
                                            <div class="progress-bar progress-bar-success" role="progressbar"
                                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 40%">
                                                <span>40% </span>
                                            </div>
                                        </div>
                                        <div><span style="float:right;"><i
                                                class="glyphicon glyphicon-star-empty"></i></span> <span><i
                                                class="glyphicon glyphicon-user" title="æ”¯æŒäººæ•°"></i> 12345</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="thumbnail">
                                    <img alt="300x200" src="img/product-3.png"/>
                                    <div class="caption">
                                        <h3 class="break">
                                            <a href="project.html">å°ç†ŠçŒ«é±¼çœ¼å…¨æ™¯å®‰é˜²æ‘„åƒæœº</a>
                                        </h3>
                                        <p>
                                        <div style="float:left;"><i class="glyphicon glyphicon-screenshot"
                                                                    title="ç›®æ ‡é‡‘é¢"></i> $20,000
                                        </div>
                                        <div style="float:right;"><i title="æˆªè‡³æ—¥æœŸ"
                                                                     class="glyphicon glyphicon-calendar"></i>
                                            2017-20-20
                                        </div>
                                        </p>
                                        <br>
                                        <div class="progress" style="margin-bottom: 4px;">
                                            <div class="progress-bar progress-bar-success" role="progressbar"
                                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 40%">
                                                <span>40% </span>
                                            </div>
                                        </div>
                                        <div><span style="float:right;"><i
                                                class="glyphicon glyphicon-star-empty"></i></span> <span><i
                                                class="glyphicon glyphicon-user" title="æ”¯æŒäººæ•°"></i> 12345</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="thumbnail">
                                    <img alt="300x200" src="img/product-4.jpg"/>
                                    <div class="caption">
                                        <h3 class="break">
                                            <a href="project.html">ä¸€æ¬¾ç²¾è‡´çš„æœºæ¢°è¡¨</a>
                                        </h3>
                                        <p>
                                        <div style="float:left;"><i class="glyphicon glyphicon-screenshot"
                                                                    title="ç›®æ ‡é‡‘é¢"></i> $20,000
                                        </div>
                                        <div style="float:right;"><i title="æˆªè‡³æ—¥æœŸ"
                                                                     class="glyphicon glyphicon-calendar"></i>
                                            2017-20-20
                                        </div>
                                        </p>
                                        <br>
                                        <div class="progress" style="margin-bottom: 4px;">
                                            <div class="progress-bar progress-bar-success" role="progressbar"
                                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 40%">
                                                <span>40% </span>
                                            </div>
                                        </div>
                                        <div><span style="float:right;"><i
                                                class="glyphicon glyphicon-star-empty"></i></span> <span><i
                                                class="glyphicon glyphicon-user" title="æ”¯æŒäººæ•°"></i> 12345</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="container">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <div class="box ui-draggable" id="mainBox">
                    <div class="mHd" style="">
                        <div class="path">
                            <a href="projects.html">æ›´å¤š...</a>
                        </div>
                        <h3>
                            å…¶ä»– <small style="color:#FFF;">å‘ç°æ›´å¤šæƒŠå–œ</small>
                        </h3>
                    </div>
                    <div class="mBd" style="padding-top:10px;">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="thumbnail">
                                    <img alt="300x200" src="img/product-1.jpg"/>
                                    <div class="caption">
                                        <h3 class="break">
                                            <a href="project.html">æ´»æ€§å¯Œæ°¢å‡€æ°´ç›´é¥®æœº</a>
                                        </h3>
                                        <p>
                                        <div style="float:left;"><i class="glyphicon glyphicon-screenshot"
                                                                    title="ç›®æ ‡é‡‘é¢"></i> $20,000
                                        </div>
                                        <div style="float:right;"><i title="æˆªè‡³æ—¥æœŸ"
                                                                     class="glyphicon glyphicon-calendar"></i>
                                            2017-20-20
                                        </div>
                                        </p>
                                        <br>
                                        <div class="progress" style="margin-bottom: 4px;">
                                            <div class="progress-bar progress-bar-success" role="progressbar"
                                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 40%">
                                                <span>40% </span>
                                            </div>
                                        </div>
                                        <div><span style="float:right;"><i
                                                class="glyphicon glyphicon-star-empty"></i></span> <span><i
                                                class="glyphicon glyphicon-user" title="æ”¯æŒäººæ•°"></i> 12345</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="thumbnail">
                                    <img alt="300x200" src="img/product-2.gif"/>
                                    <div class="caption">
                                        <h3 class="break">
                                            <a href="project.html">é…·é©°è§¦æ§é¾™å¤´ï¼Œæ™ºäº«å¨æˆ¿é»‘ç§‘æŠ€</a>
                                        </h3>
                                        <p>
                                        <div style="float:left;"><i class="glyphicon glyphicon-screenshot"
                                                                    title="ç›®æ ‡é‡‘é¢"></i> $20,000
                                        </div>
                                        <div style="float:right;"><i title="æˆªè‡³æ—¥æœŸ"
                                                                     class="glyphicon glyphicon-calendar"></i>
                                            2017-20-20
                                        </div>
                                        </p>
                                        <br>
                                        <div class="progress" style="margin-bottom: 4px;">
                                            <div class="progress-bar progress-bar-success" role="progressbar"
                                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 40%">
                                                <span>40% </span>
                                            </div>
                                        </div>
                                        <div><span style="float:right;"><i
                                                class="glyphicon glyphicon-star-empty"></i></span> <span><i
                                                class="glyphicon glyphicon-user" title="æ”¯æŒäººæ•°"></i> 12345</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="thumbnail">
                                    <img alt="300x200" src="img/product-3.png"/>
                                    <div class="caption">
                                        <h3 class="break">
                                            <a href="project.html">å°ç†ŠçŒ«é±¼çœ¼å…¨æ™¯å®‰é˜²æ‘„åƒæœº</a>
                                        </h3>
                                        <p>
                                        <div style="float:left;"><i class="glyphicon glyphicon-screenshot"
                                                                    title="ç›®æ ‡é‡‘é¢"></i> $20,000
                                        </div>
                                        <div style="float:right;"><i title="æˆªè‡³æ—¥æœŸ"
                                                                     class="glyphicon glyphicon-calendar"></i>
                                            2017-20-20
                                        </div>
                                        </p>
                                        <br>
                                        <div class="progress" style="margin-bottom: 4px;">
                                            <div class="progress-bar progress-bar-success" role="progressbar"
                                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 40%">
                                                <span>40% </span>
                                            </div>
                                        </div>
                                        <div><span style="float:right;"><i
                                                class="glyphicon glyphicon-star-empty"></i></span> <span><i
                                                class="glyphicon glyphicon-user" title="æ”¯æŒäººæ•°"></i> 12345</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="thumbnail">
                                    <img alt="300x200" src="img/product-4.jpg"/>
                                    <div class="caption">
                                        <h3 class="break">
                                            <a href="project.html">ä¸€æ¬¾ç²¾è‡´çš„æœºæ¢°è¡¨</a>
                                        </h3>
                                        <p>
                                        <div style="float:left;"><i class="glyphicon glyphicon-screenshot"
                                                                    title="ç›®æ ‡é‡‘é¢"></i> $20,000
                                        </div>
                                        <div style="float:right;"><i title="æˆªè‡³æ—¥æœŸ"
                                                                     class="glyphicon glyphicon-calendar"></i>
                                            2017-20-20
                                        </div>
                                        </p>
                                        <br>
                                        <div class="progress" style="margin-bottom: 4px;">
                                            <div class="progress-bar progress-bar-success" role="progressbar"
                                                 aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"
                                                 style="width: 40%">
                                                <span>40% </span>
                                            </div>
                                        </div>
                                        <div><span style="float:right;"><i
                                                class="glyphicon glyphicon-star-empty"></i></span> <span><i
                                                class="glyphicon glyphicon-user" title="æ”¯æŒäººæ•°"></i> 12345</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <div class="container">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <div id="footer">
                    <div class="footerNav">
                        <a rel="nofollow" href="http://www.atguigu.com">å…³äºæˆ‘ä»¬</a> | <a rel="nofollow"
                                                                                      href="http://www.atguigu.com">æœåŠ¡æ¡æ¬¾</a>
                        | <a rel="nofollow" href="http://www.atguigu.com">å…è´£å£°æ˜</a> | <a rel="nofollow"
                                                                                        href="http://www.atguigu.com">ç½‘ç«™åœ°å›¾</a>
                        | <a rel="nofollow" href="http://www.atguigu.com">è”ç³»æˆ‘ä»¬</a>
                    </div>
                    <div class="copyRight">
                        Copyright ?2017-2017atguigu.com ç‰ˆæƒæ‰€æœ‰
                    </div>
                </div>

            </div>
        </div>
    </div>

</div><!-- /.container -->
</body>
</html>
```

- `<baseth:href="@{/}">`

    - å°±ç®—é…ç½® `server.servlet.context-path: /aaa`, ä¹Ÿå¯ä»¥æ­£å¸¸è®¿é—®



### 9.6 `static` èµ„æº

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661696345312-26f74d50-297f-46d8-b470-3a3ea367f66a.png)

- `SpringBoot` è¦æ±‚åœ¨ `static` ä¸­å­˜æ”¾é™æ€èµ„æº ,å¤åˆ¶åˆ° `static` æ–‡ä»¶å¤¹ä¸­

    - èµ„æºåŒ…:  [ğŸ“static.zip](https://www.yuque.com/attachments/yuque/0/2022/zip/12811585/1660963709173-585dad43-5a60-45b4-9fa2-97457f611bcf.zip)



## 10. `Zuul` ç½‘å…³é¡¹ç›®

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661699552724-09ee472d-28b1-43c6-ad01-170e80d058f0.png)

------

### 10.1 ä¾èµ–

```xml
<dependencies>
    <!-- ä½œä¸ºå®¢æˆ·ç«¯è®¿é—® Eureka æ³¨å†Œä¸­å¿ƒ -->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
    </dependency>

    <!-- æ•´åˆ Zuul ç½‘å…³ -->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-netflix-zuul</artifactId>
    </dependency>
</dependencies>

<build>
<plugins>
    <!-- è¿™ä¸ªæ’ä»¶å°† SpringBoot åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„ jar åŒ… -->
    <plugin>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-maven-plugin</artifactId>
        <executions>
            <execution>
                <goals>
                    <goal>repackage</goal>
                </goals>
            </execution>
        </executions>
    </plugin>
</plugins>
</build>
```



### 10.2 æ–°å»º `CrowdMainClass` ä¸»å¯åŠ¨ç±»

```java
package com.atguigu.crowd;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.zuul.EnableZuulProxy;

/**
 * `@EnableZuulProxy` å¯åŠ¨ zuul ä»£ç†åŠŸèƒ½
 *
 * @author é™ˆæ±Ÿæ—
 * @date 2022/8/28 22:26
 */
@EnableZuulProxy
@SpringBootApplication
public class CrowdMainClass {

    public static void main(String[] args) {
        SpringApplication.run(CrowdMainClass.class, args);
    }

}
```



### 10.3 æ–°å»º `application.yml` é…ç½®

```yaml
server:
  port: 80

spring:
  application:
    name: atguigu-crowd-zuul

eureka:
  client:
    service-url:
      defaultZone: http://localhost:1000/eureka

zuul:
  # å¿½ç•¥åŸæœ¬çš„å¾®æœåŠ¡åç§°
  ignored-services: "*"
  # åœ¨ zuul ä¸­å…¶ä»–å¾®æœåŠ¡é‡å®šå‘æ—¶ä¿æŒåŸæœ¬çš„å¤´ä¿¡æ¯ï¼ˆè¯·æ±‚å¤´ã€å“åº”å¤´ï¼‰
  sensitive-headers: "*"
  routes:
    crowd-portal:
      service-id: atguigu-crowd-auth
      path: /**

ribbon:
  # 10ç§’ - å¤„ç†è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º5ç§’
  ReadTimeout: 10000
  # 10ç§’ - è¿æ¥å»ºç«‹çš„è¶…æ—¶æ—¶é•¿ï¼Œé»˜è®¤5ç§’
  ConnectTimeout: 10000
```



## 11. å…³äºç¬¬ä¸€æ¬¡è¯·æ±‚è¶…æ—¶

- ç”±äºåœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚ä¸­éœ€è¦å»ºç«‹ç¼“å­˜ã€å»ºç«‹è¿æ¥, æ“ä½œè¾ƒå¤š, æ‰€ä»¥æ¯”è¾ƒè€—æ—¶
- å¦‚æœæŒ‰ç…§é»˜è®¤çš„ `ribbon` è¶…æ—¶æ—¶é—´æ¥å·¥ä½œ, ç¬¬ä¸€æ¬¡è¯·æ±‚ä¼šè¶…è¿‡è¿™ä¸ªæ—¶é—´å¯¼è‡´è¶…æ—¶æŠ¥é”™
- ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜, æŠŠ `ribbon` çš„è¶…æ—¶æ—¶é—´å»¶é•¿
- `application.yml` ä¸­é…ç½®

```yaml
ribbon:
  # 10ç§’ - å¤„ç†è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º5ç§’
  ReadTimeout: 10000
  # 10ç§’ - è¿æ¥å»ºç«‹çš„è¶…æ—¶æ—¶é•¿ï¼Œé»˜è®¤5ç§’
  ConnectTimeout: 10000
```


# åä¸ƒ ä¼šå‘˜æ³¨å†Œ

>  `git checkout -b 17.0.0_member_reg`

## 1. è°ƒç”¨ç¬¬ä¸‰æ–¹çŸ­ä¿¡æ¥å£

- [äº‘å¸‚åœº](https://market.aliyun.com/?spm=5176.product-detail.J_3207526240.2.2ba07b9d1oPiiz)

### 1.1 è¿½åŠ ä¾èµ–ã€`common`å·¥ç¨‹ã€‘

```xml
<!-- ä»¥ä¸‹æ˜¯å‘é€çŸ­ä¿¡æ—¶è°ƒç”¨ç¬¬ä¸‰æ–¹ API æ‰€éœ€çš„ä¾èµ– -->
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>fastjson</artifactId>
    <version>1.2.15</version>
</dependency>

<dependency>
    <groupId>org.apache.httpcomponents</groupId>
    <artifactId>httpclient</artifactId>
    <version>4.5.9</version>
</dependency>

<dependency>
    <groupId>org.eclipse.jetty</groupId>
    <artifactId>jetty-util</artifactId>
    <version>9.4.19.v20190610</version>
</dependency>

<dependency>
    <groupId>commons-lang</groupId>
    <artifactId>commons-lang</artifactId>
    <version>2.6</version>
</dependency>
```



### 1.2 æ–°å»º `HttpUtils` ç±»ã€`common`å·¥ç¨‹ã€‘

```java
package com.aliyun.api.gateway.demo.util;

import org.apache.commons.lang.StringUtils;
import org.apache.http.HttpResponse;
import org.apache.http.NameValuePair;
import org.apache.http.client.HttpClient;
import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.client.methods.HttpDelete;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.client.methods.HttpPut;
import org.apache.http.conn.ClientConnectionManager;
import org.apache.http.conn.scheme.Scheme;
import org.apache.http.conn.scheme.SchemeRegistry;
import org.apache.http.conn.ssl.SSLSocketFactory;
import org.apache.http.entity.ByteArrayEntity;
import org.apache.http.entity.StringEntity;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.message.BasicNameValuePair;

import javax.net.ssl.SSLContext;
import javax.net.ssl.TrustManager;
import javax.net.ssl.X509TrustManager;
import java.io.UnsupportedEncodingException;
import java.net.URLEncoder;
import java.security.KeyManagementException;
import java.security.NoSuchAlgorithmException;
import java.security.cert.X509Certificate;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;

/**
 * @author é™ˆæ±Ÿæ—
 * @date 2022/8/29 09:27
 */
public class HttpUtils {

    /**
     * get
     *
     * @param host
     * @param path
     * @param method
     * @param headers
     * @param querys
     * @return
     * @throws Exception
     */
    public static HttpResponse doGet(String host, String path, String method,
                                     Map<String, String> headers,
                                     Map<String, String> querys)
            throws Exception {
        HttpClient httpClient = wrapClient(host);

        HttpGet request = new HttpGet(buildUrl(host, path, querys));
        for (Map.Entry<String, String> e : headers.entrySet()) {
            request.addHeader(e.getKey(), e.getValue());
        }

        return httpClient.execute(request);
    }

    /**
     * post form
     *
     * @param host
     * @param path
     * @param method
     * @param headers
     * @param querys
     * @param bodys
     * @return
     * @throws Exception
     */
    public static HttpResponse doPost(String host, String path, String method,
                                      Map<String, String> headers,
                                      Map<String, String> querys,
                                      Map<String, String> bodys)
            throws Exception {
        HttpClient httpClient = wrapClient(host);

        HttpPost request = new HttpPost(buildUrl(host, path, querys));
        for (Map.Entry<String, String> e : headers.entrySet()) {
            request.addHeader(e.getKey(), e.getValue());
        }

        if (bodys != null) {
            List<NameValuePair> nameValuePairList = new ArrayList<NameValuePair>();

            for (String key : bodys.keySet()) {
                nameValuePairList.add(new BasicNameValuePair(key, bodys.get(key)));
            }
            UrlEncodedFormEntity formEntity = new UrlEncodedFormEntity(nameValuePairList, "utf-8");
            formEntity.setContentType("application/x-www-form-urlencoded; charset=UTF-8");
            request.setEntity(formEntity);
        }

        return httpClient.execute(request);
    }

    /**
     * Post String
     *
     * @param host
     * @param path
     * @param method
     * @param headers
     * @param querys
     * @param body
     * @return
     * @throws Exception
     */
    public static HttpResponse doPost(String host, String path, String method,
                                      Map<String, String> headers,
                                      Map<String, String> querys,
                                      String body)
            throws Exception {
        HttpClient httpClient = wrapClient(host);

        HttpPost request = new HttpPost(buildUrl(host, path, querys));
        for (Map.Entry<String, String> e : headers.entrySet()) {
            request.addHeader(e.getKey(), e.getValue());
        }

        if (StringUtils.isNotBlank(body)) {
            request.setEntity(new StringEntity(body, "utf-8"));
        }

        return httpClient.execute(request);
    }

    /**
     * Post stream
     *
     * @param host
     * @param path
     * @param method
     * @param headers
     * @param querys
     * @param body
     * @return
     * @throws Exception
     */
    public static HttpResponse doPost(String host, String path, String method,
                                      Map<String, String> headers,
                                      Map<String, String> querys,
                                      byte[] body)
            throws Exception {
        HttpClient httpClient = wrapClient(host);

        HttpPost request = new HttpPost(buildUrl(host, path, querys));
        for (Map.Entry<String, String> e : headers.entrySet()) {
            request.addHeader(e.getKey(), e.getValue());
        }

        if (body != null) {
            request.setEntity(new ByteArrayEntity(body));
        }

        return httpClient.execute(request);
    }

    /**
     * Put String
     *
     * @param host
     * @param path
     * @param method
     * @param headers
     * @param querys
     * @param body
     * @return
     * @throws Exception
     */
    public static HttpResponse doPut(String host, String path, String method,
                                     Map<String, String> headers,
                                     Map<String, String> querys,
                                     String body)
            throws Exception {
        HttpClient httpClient = wrapClient(host);

        HttpPut request = new HttpPut(buildUrl(host, path, querys));
        for (Map.Entry<String, String> e : headers.entrySet()) {
            request.addHeader(e.getKey(), e.getValue());
        }

        if (StringUtils.isNotBlank(body)) {
            request.setEntity(new StringEntity(body, "utf-8"));
        }

        return httpClient.execute(request);
    }

    /**
     * Put stream
     *
     * @param host
     * @param path
     * @param method
     * @param headers
     * @param querys
     * @param body
     * @return
     * @throws Exception
     */
    public static HttpResponse doPut(String host, String path, String method,
                                     Map<String, String> headers,
                                     Map<String, String> querys,
                                     byte[] body)
            throws Exception {
        HttpClient httpClient = wrapClient(host);

        HttpPut request = new HttpPut(buildUrl(host, path, querys));
        for (Map.Entry<String, String> e : headers.entrySet()) {
            request.addHeader(e.getKey(), e.getValue());
        }

        if (body != null) {
            request.setEntity(new ByteArrayEntity(body));
        }

        return httpClient.execute(request);
    }

    /**
     * Delete
     *
     * @param host
     * @param path
     * @param method
     * @param headers
     * @param querys
     * @return
     * @throws Exception
     */
    public static HttpResponse doDelete(String host, String path, String method,
                                        Map<String, String> headers,
                                        Map<String, String> querys)
            throws Exception {
        HttpClient httpClient = wrapClient(host);

        HttpDelete request = new HttpDelete(buildUrl(host, path, querys));
        for (Map.Entry<String, String> e : headers.entrySet()) {
            request.addHeader(e.getKey(), e.getValue());
        }

        return httpClient.execute(request);
    }

    private static String buildUrl(String host, String path, Map<String, String> querys) throws UnsupportedEncodingException {
        StringBuilder sbUrl = new StringBuilder();
        sbUrl.append(host);
        if (!StringUtils.isBlank(path)) {
            sbUrl.append(path);
        }
        if (null != querys) {
            StringBuilder sbQuery = new StringBuilder();
            for (Map.Entry<String, String> query : querys.entrySet()) {
                if (0 < sbQuery.length()) {
                    sbQuery.append("&");
                }
                if (StringUtils.isBlank(query.getKey()) && !StringUtils.isBlank(query.getValue())) {
                    sbQuery.append(query.getValue());
                }
                if (!StringUtils.isBlank(query.getKey())) {
                    sbQuery.append(query.getKey());
                    if (!StringUtils.isBlank(query.getValue())) {
                        sbQuery.append("=");
                        sbQuery.append(URLEncoder.encode(query.getValue(), "utf-8"));
                    }
                }
            }
            if (0 < sbQuery.length()) {
                sbUrl.append("?").append(sbQuery);
            }
        }

        return sbUrl.toString();
    }

    private static HttpClient wrapClient(String host) {
        HttpClient httpClient = new DefaultHttpClient();
        if (host.startsWith("https://")) {
            sslClient(httpClient);
        }

        return httpClient;
    }

    private static void sslClient(HttpClient httpClient) {
        try {
            SSLContext ctx = SSLContext.getInstance("TLS");
            X509TrustManager tm = new X509TrustManager() {
                @Override
                public X509Certificate[] getAcceptedIssuers() {
                    return null;
                }

                @Override
                public void checkClientTrusted(X509Certificate[] xcs, String str) {

                }

                @Override
                public void checkServerTrusted(X509Certificate[] xcs, String str) {

                }
            };
            ctx.init(null, new TrustManager[]{tm}, null);
            SSLSocketFactory ssf = new SSLSocketFactory(ctx);
            ssf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
            ClientConnectionManager ccm = httpClient.getConnectionManager();
            SchemeRegistry registry = ccm.getSchemeRegistry();
            registry.register(new Scheme("https", 443, ssf));
        } catch (KeyManagementException ex) {
            throw new RuntimeException(ex);
        } catch (NoSuchAlgorithmException ex) {
            throw new RuntimeException(ex);
        }
    }
}
```



### 1.3 æ–°å»º `CrowdTest` æµ‹è¯•ç±»ã€`auth` å·¥ç¨‹ã€‘

#### 1.3.1 å‰ç½®: è¿½åŠ ä¾èµ–

```xml
<!-- SpringBoot æµ‹è¯• -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-test</artifactId>
    <version>2.1.6.RELEASE</version>
    <scope>test</scope>
</dependency>
```

------

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661739650139-ba5aeaa8-0737-4890-9b90-9f38ba8a388d.png)

```java
package com.atguigu.crowd.test;

import com.aliyun.api.gateway.demo.util.HttpUtils;
import org.apache.http.HttpResponse;
import org.apache.http.util.EntityUtils;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import java.util.HashMap;
import java.util.Map;

/**
 * @author é™ˆæ±Ÿæ—
 * @date 2022/8/29 09:16
 */
@RunWith(SpringRunner.class)
@SpringBootTest
public class CrowdTest {

    @Test
    public void testSendMessage() {
        String host = "https://dfsns.market.alicloudapi.com";
        String path = "/data/send_sms";
        String method = "POST";
        String appcode = "1948fa6afc674ea3bc2fea47f36e1108";
        Map<String, String> headers = new HashMap<>();
        //æœ€ååœ¨headerä¸­çš„æ ¼å¼(ä¸­é—´æ˜¯è‹±æ–‡ç©ºæ ¼)ä¸ºAuthorization:APPCODE 83359fd73fe94948385f570e3c139105
        headers.put("Authorization", "APPCODE " + appcode);
        //æ ¹æ®APIçš„è¦æ±‚ï¼Œå®šä¹‰ç›¸å¯¹åº”çš„Content-Type
        headers.put("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8");
        Map<String, String> querys = new HashMap<>();
        Map<String, String> bodys = new HashMap<>();
        bodys.put("content", "code:1234");
        bodys.put("phone_number", "185xxxx5080");
        bodys.put("template_id", "TPL_0000");

        try {
            /**
             * é‡è¦æç¤ºå¦‚ä¸‹:
             * HttpUtilsè¯·ä»
             * https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/src/main/java/com/aliyun/api/gateway/demo/util/HttpUtils.java
             * ä¸‹è½½
             *
             * ç›¸åº”çš„ä¾èµ–è¯·å‚ç…§
             * https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/pom.xml
             */
            HttpResponse response = HttpUtils.doPost(host, path, method, headers, querys, bodys);
            // System.out.println(response.toString());
            // è·å–responseçš„body
            // {"status":"OK","request_id":"TIDef01a498c96747a19aa166cd81f9279d"}
            System.out.println(EntityUtils.toString(response.getEntity()));
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

### 1.4 `CrowdUtil` è¿½åŠ æ–¹æ³•ã€`common`å·¥ç¨‹ã€‘

```java
/**
 * ç»™è¿œç¨‹ç¬¬ä¸‰æ–¹æ¥å£å‘é€è¯·æ±‚æŠŠéªŒè¯ç å‘é€åˆ°ç”¨æˆ·æ‰‹æœºä¸Š
 *
 * @param appCode     ç”¨æ¥è°ƒç”¨ç¬¬ä¸‰æ–¹çŸ­ä¿¡ API çš„ AppCode
 * @param templateId  æ¨¡æ¿çš„ç¼–å·
 * @param host        çŸ­ä¿¡æ¥å£è°ƒç”¨çš„ URL åœ°å€
 * @param path        å…·ä½“å‘é€çŸ­ä¿¡åŠŸèƒ½çš„åœ°å€
 * @param method      è¯·æ±‚æ–¹å¼
 * @param phoneNumber æ¥æ”¶çŸ­ä¿¡çš„æ‰‹æœºå·ç 
 * @return æˆåŠŸè¿”å›: éªŒè¯ç 
 */
public static ResultEntity<String> sendShortMessage(String appCode, String templateId, String host, String path, String method, String phoneNumber) {
    // ç”ŸæˆéªŒè¯ç 
    StringBuilder code = new StringBuilder();
    for (int i = 0; i < 4; i++) {
        int random = (int) (Math.random() * 10);
        code.append(random);
    }

    Map<String, String> headers = new HashMap<>();
    //æœ€ååœ¨headerä¸­çš„æ ¼å¼(ä¸­é—´æ˜¯è‹±æ–‡ç©ºæ ¼)ä¸ºAuthorization:APPCODE 83359fd73fe94948385f570e3c139105
    headers.put("Authorization", "APPCODE " + appCode);
    //æ ¹æ®APIçš„è¦æ±‚ï¼Œå®šä¹‰ç›¸å¯¹åº”çš„Content-Type
    headers.put("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8");
    Map<String, String> querys = new HashMap<>();
    Map<String, String> bodys = new HashMap<>();

    bodys.put("content", "code:" + code);
    bodys.put("phone_number", phoneNumber);
    if (templateId == null) {
        // æµ‹è¯•æ¨¡æ¿çš„ Id
        bodys.put("template_id", "TPL_0000");
    } else {
        bodys.put("template_id", templateId);
    }

    try {
        /**
         * é‡è¦æç¤ºå¦‚ä¸‹:
         * HttpUtilsè¯·ä»
         * https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/src/main/java/com/aliyun/api/gateway/demo/util/HttpUtils.java
         * ä¸‹è½½
         *
         * ç›¸åº”çš„ä¾èµ–è¯·å‚ç…§
         * https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/pom.xml
         */
        HttpResponse response = HttpUtils.doPost(host, path, method, headers, querys, bodys);
        System.out.println(response.toString());
        //è·å–responseçš„body
        //System.out.println(EntityUtils.toString(response.getEntity()));

        StatusLine statusLine = response.getStatusLine();
        // çŠ¶æ€ç : [{200: æ­£å¸¸}, {400: è¯·æ±‚å‚æ•°é”™è¯¯}, {403: å¥—é¤ä½™é¢ç”¨å®Œ}, {500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯}]
        int statusCode = statusLine.getStatusCode();
        String reasonPhrase = statusLine.getReasonPhrase();

        if (statusCode == 200) {
            return ResultEntity.successWithData(code.toString());
        } else {
            return ResultEntity.failed(reasonPhrase);
        }
    } catch (Exception e) {
        return ResultEntity.failed(e.getMessage());
    }
}
```



## 2. å‘é€éªŒè¯ç ã€`auth` å·¥ç¨‹ã€‘

- å°†éªŒè¯ç å‘é€åˆ°ç”¨æˆ·æ‰‹æœºä¸Š
- å°†éªŒè¯ç å­˜å…¥ `Redis` ä¸­

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661752982629-d2f728d5-2193-4e09-9e26-1238e5862231.png)

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661303711451-a1e90c90-61a4-4c8c-8822-806ebac12970.png)



### 2.1 é…ç½®è·³è½¬è·¯å¾„å’Œå¯¹åº”çš„é¡µé¢

#### 2.1.1 æ–°å»º `CrowdWebMvcConfig` ç±»

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661741337449-58492ae4-ac1b-41d9-9555-3ce4f4267504.png)

```java
package com.atguigu.crowd.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ViewControllerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/**
 * @author é™ˆæ±Ÿæ—
 * @date 2022/8/29 10:48
 */
@Configuration
public class CrowdWebMvcConfig implements WebMvcConfigurer {

    @Override
    public void addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController("/auth/member/to/reg/page").setViewName("member-reg");
        registry.addViewController("/auth/member/to/login/page").setViewName("member-login");
    }

}
```



### 2.2 ä¿®æ”¹ä»£ç  `portal.html`

```html
<!--                        <li><a href="login.html">ç™»å½•</a></li>-->
<!--                        <li><a href="reg.html">æ³¨å†Œ</a></li>-->
<li><a th:href="@{/auth/member/to/login/page}">ç™»å½•</a></li>
<li><a th:href="@{/auth/member/to/reg/page}">æ³¨å†Œ</a></li>
```



### 2.3 æ–°å»º `member-reg.html` æ³¨å†Œé¡µé¢

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661742933900-febbd4fc-ff6d-4b2a-9904-f8b58fbfeb3c.png)

```html
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keys" content="">
    <meta name="author" content="">
    <base th:href="@{/}">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/login.css">
    <script type="text/javascript" src="jquery/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="layer/layer.js"></script>
    <script type="text/javascript">
        // layer.msg("aaa...");

        $(function () {
            $("#sendBtn").click(function () {
                // 1. è·å–æ¥é€çŸ­ä¿¡çš„æ‰‹æœºå·ç 
                let phoneNum = $.trim($("[name=phoneNum]").val());

                // 2. å‘é€è¯·æ±‚
                $.ajax({
                    url: "auth/member/send/short/message.json",
                    type: "post",
                    data: {
                        phoneNum: phoneNum
                    },
                    dataType: "json",
                    success: function (response) {
                        var result = response.result;
                        if ("SUCCESS" === result) {
                            layer.msg("å‘é€æˆåŠŸ")
                        }

                        if ("FAILED" === result) {
                            layer.msg("å‘é€å¤±è´¥, è¯·é‡è¯•")
                        }
                    },
                    error: function (response) {
                        layer.msg(response.status + " " + response.statusText);
                    }
                })
            })
        })
    </script>
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <div><a class="navbar-brand" th:href="@{/}" style="font-size:32px;">å°šç­¹ç½‘-åˆ›æ„äº§å“ä¼—ç­¹å¹³å°</a></div>
        </div>
    </div>
</nav>

<div class="container">

    <form action="/auth/do/member/register" method="post" class="form-signin" role="form">
        <h2 class="form-signin-heading"><i class="glyphicon glyphicon-log-in"></i> ç”¨æˆ·æ³¨å†Œ</h2>
        <p th:text="${message}">è¿™é‡Œæ˜¾ç¤ºä»è¯·æ±‚åŸŸå–å‡ºçš„æç¤ºæ¶ˆæ¯</p>
        <div class="form-group has-success has-feedback">
            <input type="text" class="form-control" id="loginacct" name="loginacct" placeholder="è¯·è¾“å…¥ç™»å½•è´¦å·" autofocus>
            <span class="glyphicon glyphicon-user form-control-feedback"></span>
        </div>
        <div class="form-group has-success has-feedback">
            <input type="text" class="form-control" id="userpswd" name="userpswd" placeholder="è¯·è¾“å…¥ç™»å½•å¯†ç "
                   style="margin-top:10px;">
            <span class="glyphicon glyphicon-lock form-control-feedback"></span>
        </div>
        <div class="form-group has-success has-feedback">
            <input type="text" class="form-control" id="username" name="username" placeholder="è¯·è¾“å…¥ç™»å½•æ˜µç§°" autofocus>
            <span class="glyphicon glyphicon-user form-control-feedback"></span>
        </div>
        <div class="form-group has-success has-feedback">
            <input type="text" class="form-control" id="email" name="email" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€"
                   style="margin-top:10px;">
            <span class="glyphicon glyphicon glyphicon-envelope form-control-feedback"></span>
        </div>
        <div class="form-group has-success has-feedback">
            <input type="text" class="form-control" id="phoneNum" name="phoneNum" placeholder="è¯·è¾“å…¥æ‰‹æœºå·"
                   style="margin-top:10px;">
            <span class="glyphicon glyphicon glyphicon-earphone form-control-feedback"></span>
        </div>
        <div class="form-group has-success has-feedback">
            <input type="text" class="form-control" id="code" name="code" placeholder="è¯·è¾“å…¥éªŒè¯ç " style="margin-top:10px;">
            <span class="glyphicon glyphicon glyphicon-comment form-control-feedback"></span>
        </div>
        <button id="sendBtn" type="button" class="btn btn-lg btn-success btn-block"> è·å–éªŒè¯ç </button>
        <button type="submit" class="btn btn-lg btn-success btn-block"> æ³¨å†Œ</button>
    </form>

</div>

</body>
</html>
```



#### 2.3.1 æ·»åŠ  `layer`åˆ° `static` ä¸‹ [ğŸ“layer.zip](https://www.yuque.com/attachments/yuque/0/2022/zip/12811585/1661304823359-ba71611a-3f5d-482b-ad14-5451941d27a6.zip)

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661741626640-e781ac6d-c56d-4fe4-b722-59e628c8b5d9.png)



### 2.4 è¿½åŠ ä¾èµ–

```xml
<!-- å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨, é…ç½®æ–‡ä»¶è¿›è¡Œç»‘å®š -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-configuration-processor</artifactId>
    <optional>true</optional>
</dependency>
```



### 2.5 æ–°å»º `ShortMessageProperties` ç±»

```java
package com.atguigu.crowd.config;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.stereotype.Component;

/**
 * ç¬¬ä¸‰æ–¹çŸ­ä¿¡æ¥å£å±æ€§
 *
 * @author é™ˆæ±Ÿæ—
 * @date 2022/8/29 11:24
 */
@NoArgsConstructor
@AllArgsConstructor
@Data
@Component
@ConfigurationProperties(prefix = "short.message")
public class ShortMessageProperties {

    private String appCode;
    private String templateId;
    private String host;
    private String method;
    private String path;

}
```



### 2.6 è¿½åŠ é…ç½®

```yaml
# ç¬¬ä¸‰æ–¹çŸ­ä¿¡æ¥å£
short:
  message:
    app-code: 1948fa6afc674ea3bc2fea47f36e1108
    host: https://dfsns.market.alicloudapi.com
    path: /data/send_sms
    method: POST
```



### 2.7 æ–°å»º `MemberHandler` å‘é€çŸ­ä¿¡

```java
package com.atguigu.crowd.handler;

import com.atguigu.crowd.api.RedisRemoteService;
import com.atguigu.crowd.config.ShortMessageProperties;
import com.atguigu.crowd.constant.CrowdConstant;
import com.atguigu.crowd.util.CrowdUtil;
import com.atguigu.crowd.util.ResultEntity;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import java.util.concurrent.TimeUnit;

/**
 * @author é™ˆæ±Ÿæ—
 * @date 2022/8/29 11:21
 */
@Controller
public class MemberHandler {

    @Autowired
    private ShortMessageProperties shortMessageProperties;

    @Autowired
    private RedisRemoteService redisRemoteService;

    /**
     * å‘é€çŸ­ä¿¡éªŒè¯ç 
     *
     * @param phoneNum æ‰‹æœºå·ç 
     * @return
     */
    @ResponseBody
    @RequestMapping("/auth/member/send/short/message.json")
    public ResultEntity<String> sendMessage(
            @RequestParam("phoneNum") String phoneNum) {
        try {
            // 1. å‘é€éªŒè¯ç 
            ResultEntity<String> sendMessageResultEntity = CrowdUtil.sendShortMessage(
                    shortMessageProperties.getAppCode(),
                    shortMessageProperties.getTemplateId(),
                    shortMessageProperties.getHost(),
                    shortMessageProperties.getPath(),
                    shortMessageProperties.getMethod(),
                    phoneNum
            );

            // 2. åˆ¤æ–­å‘é€ç»“æœ
            if(ResultEntity.SUCCESS.equals(sendMessageResultEntity.getResult())) {
                // 3. æˆåŠŸ: å°†éªŒè¯ç å­˜å…¥ Redis
                String code = sendMessageResultEntity.getData();
                String key = CrowdConstant.REDIS_CODE_PREFIX + phoneNum;
                ResultEntity<String> saveCodeResultEntity = redisRemoteService.setRedisKeyValueRemoteWithTimeout(key, code, 15, TimeUnit.MINUTES);
                if(ResultEntity.SUCCESS.equals(saveCodeResultEntity.getResult())) {
                    return ResultEntity.successWithoutData();
                } else {
                    return saveCodeResultEntity;
                }
            } else {
                return sendMessageResultEntity;
            }
        } catch (Exception e){
            return ResultEntity.failed(e.getMessage());
        }
    }
}
```



### 2.8 è¿½åŠ ä»£ç  `CrowdConstant`ã€`common`ã€‘

```java
public static final String REDIS_CODE_PREFIX = "REDIS_CODE_PREFIX_";
```



## 3. æ‰§è¡Œæ³¨å†Œæµç¨‹

- å¦‚æœé’ˆå¯¹æ³¨å†Œæ“ä½œæ‰€åšçš„å„é¡¹éªŒè¯èƒ½å¤Ÿé€šè¿‡, åˆ™å°† Member ä¿¡æ¯å­˜å…¥æ•°æ®åº“

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661318337459-34acb207-e4f6-442c-bcc7-d6535d5bcc1c.png)



- **æ“ä½œ**: ç»™ `t_member` è¡¨ä¸­å­—æ®µ `loginacct` è®¾ç½®å”¯ä¸€

### 3.1 è¿½åŠ ä»£ç  `MySQLRemoteService`ã€`API` å·¥ç¨‹ã€‘

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661753173442-0bc49c95-f1ee-40e2-8638-f9fe7685858c.png)

```java
/**
 * ä¿å­˜
 *
 * @param memberPO ä¼šå‘˜å®ä½“ç±»
 * @return
 */
@RequestMapping("/save/member/remote")
ResultEntity<String> saveMember(@RequestBody MemberPO memberPO);
```



### 3.2 `MySQL` é¡¹ç›®

#### 3.2.1 è¿½åŠ ä»£ç  `MemberProviderHandler`

```java
/**
 * ä¿å­˜
 *
 * @param memberPO ä¼šå‘˜å®ä½“ç±»
 * @return
 */
@RequestMapping("/save/member/remote")
public ResultEntity<String> saveMember(@RequestBody MemberPO memberPO) {
    try {
        memberService.saveMember(memberPO);
        return ResultEntity.successWithoutData();
    } catch (Exception e) {
        if (e instanceof DuplicateKeyException) {
            return ResultEntity.failed(CrowdConstant.MESSAGE_LOGIN_ACCT_ALREADY_IN_USE);
        }

        return ResultEntity.failed(e.getMessage());
    }
}
```



#### 3.2.2 è¿½åŠ ä»£ç  `MemberService`

```java
/**
 * ä¿å­˜
 *
 * @param memberPO ä¼šå‘˜å®ä½“ç±»
 * @return
 */
void saveMember(MemberPO memberPO);
```



#### 3.2.3 è¿½åŠ ä»£ç  `MemberServiceImpl`

```java
@Transactional(
    propagation = Propagation.REQUIRES_NEW, 
    rollbackFor = Exception.class
)
@Override
public void saveMember(MemberPO memberPO) {
    memberPOMapper.insert(memberPO);
}
```



### 3.3 æµ‹è¯• `http://localhost:2000/save/member/remote`

- `body`: `{"loginacct": "tom","userpswd": "123"}`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661762061989-533b9ba6-7d23-46bc-aecb-164a9a1e141e.png)

- `Content-Type`: `application/json;charset=utf-8`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661319471006-2d33c481-848c-4fc9-b2d2-47390293465e.png)

- ç»“æœ

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661762078859-d289e693-501b-4702-837c-6bfdbef7310c.png)



### 3.4 `Entity` å·¥ç¨‹

#### 3.4.1 æ–°å»º `MemberVO` å°è£…è¡¨å•æ•°æ®

```java
package com.atguigu.crowd.entity.vo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

/**
 * @author é™ˆæ±Ÿæ—
 * @date 2022/8/29 16:35
 */
@NoArgsConstructor
@AllArgsConstructor
@Data
public class MemberVO {

    private String loginacct;

    private String userpswd;

    private String username;

    private String email;

    private String phoneNum;

    private String code;

}
```



### 3.5 `Auth` é¡¹ç›®

#### 3.5.1 è¿½åŠ ä»£ç  `MemberHandler`

```java
@RequestMapping("/auth/do/member/register")
public String register(MemberVO memberVO, ModelMap modelMape) {
    // 1. è·å–ç”¨æˆ·è¾“å…¥çš„æ‰‹æœºå·ç 
    String phoneNum = memberVO.getPhoneNum();
    
    // 2. æ‹¼ Redis ä¸­å­˜å‚¨éªŒè¯ç çš„ Key
    String key = CrowdConstant.REDIS_CODE_PREFIX + phoneNum;
    
    // 3. ä» Redis è¯»å– Key å¯¹åº”çš„ Value
    ResultEntity<String> resultEntity = redisRemoteService.getRedisStringValue(key);
    
    // 4. æ£€æŸ¥æŸ¥è¯¢æ“ä½œæ˜¯å¦æœ‰æ•ˆ
    String result = resultEntity.getResult();
    if(resultEntity.FAILD.equals(result)) {
        // ATTR_NAME_MESSAGE = message;
        modelMape.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, resultEntity.getMessage());
        return "member-reg";
    }
        
    String redisCode = resultEntity.getData();
    
    if(redisCode == null) {
        // MESSAGE_CODE_NOT_EXISTS = éªŒè¯ç å·²è¿‡æœŸ!è¯·æ£€æŸ¥æ‰‹æœºå·ç æ˜¯å¦æ­£ç¡®æˆ–é‡æ–°å‘é€!
        modelMape.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_CODE_NOT_EXISTS);
        return "member-reg";
    }
    
    // 5. å¦‚æœä» Redis èƒ½å¤ŸæŸ¥è¯¢åˆ° Value åˆ™æ¯”è¾ƒè¡¨å•çš„éªŒè¯ç å’Œ Redis çš„éªŒè¯ç 
    String formCode = memberVO.getCode();
    
    if(!Object.equals(formCode, redisCode)) {
        // MESSAGE_CODE_INVALID = éªŒè¯ç ä¸æ­£ç¡®!
        modelMape.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_CODE_INVALID);
        return "member-reg";
    }
    
    // 6. å¦‚æœéªŒè¯ç ä¸€è‡´åˆ™ä» Redis åˆ é™¤
    redisRemoteService.removeRedisKeyRemote(key);
    
    // 7. æ‰§è¡Œå¯†ç åŠ å¯†
    BCryptPasswordEncoder bCryptPasswordEncoder = new BCryptPasswordEncoder();
    String userpswdBeforeEncode = memberVO.getUserpswd();
    String userpswdAfterEncode = bCryptPasswordEncoder.encode(userpswdBeforeEncode);
    
    memberVO.serUserpswd(userpswdAfterEncode);
    // 8. æ‰§è¡Œä¿å­˜
    // 8.1 åˆ›å»ºç©ºçš„ memberPO å¯¹è±¡
    MemberPO memberPO = new MemberPO();
    
    // 8.2 å¤åˆ¶å±æ€§
    BeanUtils.copyProperties(memberVO, memberPO);
    
    // 8.3 è°ƒç”¨è¿œç¨‹çš„æ–¹æ³•
    ResultEntity<String> saveMemberResultEntity = mysqlRemoteService.saveMember(memberPO);
    if(saveMemberResultEntity.FAILD.equals(result)) {
        modelMape.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, saveMemberResultEntity.getMessage());
        return "member-reg";
    }
    
    // ä½¿ç”¨é‡å®šå‘é¿å…åˆ·æ–°æµè§ˆå™¨å¯¼è‡´é‡æ–°æ‰§è¡Œæ³¨å†Œæµç¨‹
    return "redirect:/auth/member/to/login/page";
}
```



#### 3.5.2 ç™»å½•é¡µé¢ `member-login.html`

```html
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keys" content="">
    <meta name="author" content="">
    <base th:href="@{/}">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/login.css">
    <script src="jquery/jquery-2.1.1.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <div><a class="navbar-brand" th:href="@{/}" style="font-size:32px;">å°šç­¹ç½‘-åˆ›æ„äº§å“ä¼—ç­¹å¹³å°</a></div>
        </div>
    </div>
</nav>

<div class="container">

    <form class="form-signin" role="form">
        <h2 class="form-signin-heading"><i class="glyphicon glyphicon-log-in"></i> ç”¨æˆ·ç™»å½•</h2>
        <div class="form-group has-success has-feedback">
            <input type="text" class="form-control" id="loginacct" name="loginacct" placeholder="è¯·è¾“å…¥ç™»å½•è´¦å·" autofocus>
            <span class="glyphicon glyphicon-user form-control-feedback"></span>
        </div>
        <div class="form-group has-success has-feedback">
            <input type="text" class="form-control" id="userpswd" name="userpswd" placeholder="è¯·è¾“å…¥ç™»å½•å¯†ç "
                   style="margin-top:10px;">
            <span class="glyphicon glyphicon-lock form-control-feedback"></span>
        </div>
        <div class="checkbox" style="text-align:right;"><a th:href="@{/auth/member/to/reg/page}">æˆ‘è¦æ³¨å†Œ</a></div>
        <button type="submit" class="btn btn-lg btn-success btn-block">ç™»å½•</button>
    </form>
</div>

</body>
</html>
```



### 3.6 `Common` å·¥ç¨‹

#### 3.6.1 è¿½åŠ ä»£ç  `CrowdContant`

```java
public static final String MESSAGE_CODE_NOT_EXISTS = "éªŒè¯ç å·²è¿‡æœŸ!è¯·æ£€æŸ¥æ‰‹æœºå·ç æ˜¯å¦æ­£ç¡®æˆ–é‡æ–°å‘é€!";
public static final String MESSAGE_CODE_INVALID = "éªŒè¯ç ä¸æ­£ç¡®!";

public static final String REDIS_CODE_PREFIX = "REDIS_CODE_PREFIX_";
public static final String ATTR_NAME_MESSAGE = "message";
```




# åå…« ä¼šå‘˜ç™»å½•

```
git checkout -b 18.0.0_member_login
```

## 1. ç™»å½•æµç¨‹

- æ£€æŸ¥è´¦å·å¯†ç æ­£ç¡®åå°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥ `Session`, è¡¨ç¤ºç”¨æˆ·å·²ç™»å½•

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661501170375-e4fa33c7-9564-4a02-8e2e-6f8988022eef.png)



### 1.1 `Entity`

#### 1.1.1 æ–°å»º `MemberLoginVO`

```java
package com.atguigu.crowd.entity.vo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.io.Serializable;

/**
 * @author é™ˆæ±Ÿæ—
 * @date 2022/8/29 21:09
 */
@Data
@NoArgsConstructor
@AllArgsConstructor
public class MemberLoginVO implements Serializable {

    private static final long serialVersionUID = 1L;

    private Integer id;

    private String username;

    private String email;

}
```





### 1.2 `Auth` å·¥ç¨‹

#### 1.2.1 ä¿®æ”¹ä»£ç  `member-login.html`

```html
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keys" content="">
    <meta name="author" content="">
    <base th:href="@{/}">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/login.css">
    <script src="jquery/jquery-2.1.1.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <div><a class="navbar-brand" th:href="@{/}" style="font-size:32px;">å°šç­¹ç½‘-åˆ›æ„äº§å“ä¼—ç­¹å¹³å°</a></div>
        </div>
    </div>
</nav>

<div class="container">
    <form action="/auth/member/do/login" method="post" class="form-signin" role="form">
        <h2 class="form-signin-heading"><i class="glyphicon glyphicon-log-in"></i> ç”¨æˆ·ç™»å½•</h2>
        <p th:text="${message}">è¿™é‡Œæ˜¾ç¤ºä»è¯·æ±‚åŸŸå–å‡ºçš„æç¤ºæ¶ˆæ¯</p>
        <div class="form-group has-success has-feedback">
            <input type="text" class="form-control" id="loginacct" name="loginacct" placeholder="è¯·è¾“å…¥ç™»å½•è´¦å·" autofocus>
            <span class="glyphicon glyphicon-user form-control-feedback"></span>
        </div>
        <div class="form-group has-success has-feedback">
            <input type="text" class="form-control" id="userpswd" name="userpswd" placeholder="è¯·è¾“å…¥ç™»å½•å¯†ç "
                   style="margin-top:10px;">
            <span class="glyphicon glyphicon-lock form-control-feedback"></span>
        </div>
        <div class="checkbox" style="text-align:right;"><a th:href="@{/auth/member/to/reg/page}">æˆ‘è¦æ³¨å†Œ</a></div>
        <button type="submit" class="btn btn-lg btn-success btn-block">ç™»å½•</button>
    </form>
</div>

</body>
</html>
```



#### 1.2.2 è¿½åŠ ä»£ç  `MemberHandler`

```java
/**
 * ä¼šå‘˜ç™»å½•
 *
 * @param loginacct è´¦æˆ·
 * @param userpswd å¯†ç 
 * @param modelMap
 * @param session
 * @return
 */
@RequestMapping("/auth/member/do/login")
public String doLogin(
        @RequestParam("loginacct") String loginacct,
        @RequestParam("userpswd") String userpswd,
        ModelMap modelMap,
        HttpSession session) {
    ResultEntity<MemberPO> resultEntity = mySQLRemoteService.getMemberPOByLoginAcctRemote(loginacct);
    if (ResultEntity.FAILED.equals(resultEntity.getResult())) {
        modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, resultEntity.getMessage());
        return "member-login";
    }

    MemberPO memberPO = resultEntity.getData();
    if (memberPO == null) {
        modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_LOGIN_FAILED);
        return "member-login";
    }

    // 2. æ¯”è¾ƒå¯†ç 
    String userpswdDataBase = memberPO.getUserpswd();

    BCryptPasswordEncoder bCryptPasswordEncoder = new BCryptPasswordEncoder();
    bCryptPasswordEncoder.matches(userpswd, userpswdDataBase);

    // 3. åˆ›å»º MemberLoginVO å¯¹è±¡ä¼ å…¥ Session åŸŸ
    MemberLoginVO memberLoginVO = new MemberLoginVO(memberPO.getId(), memberPO.getUsername(), memberPO.getEmail());
    // ATTR_NAME_LOGIN_MEMBER = loginMember
    session.setAttribute(CrowdConstant.ATTR_NAME_LOGIN_MEMBER, memberLoginVO);

    return "redirect:/auth/member/to/conter/page";
}
```



#### 1.2.3 è¿½åŠ ä»£ç  `CrowdWebMvcConfig` è®¾ç½®è·³è½¬é¡µé¢

```java
registry.addViewController("/auth/member/to/conter/page").setViewName("member-conter");
```



#### 1.2.4 æ–°å»ºé¡µé¢ `member-conter.html`

```html
<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <base th:href="@{/}">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/theme.css">
    <script src="jquery/jquery-2.1.1.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="script/docs.min.js"></script>
    <script src="script/back-to-top.js"></script>
    <script src="script/echarts.js"></script>
    <style>
        #footer {
            padding: 15px 0;
            background: #fff;
            border-top: 1px solid #ddd;
            text-align: center;
        }

        #topcontrol {
            color: #fff;
            z-index: 99;
            width: 30px;
            height: 30px;
            font-size: 20px;
            background: #222;
            position: relative;
            right: 14px !important;
            bottom: 11px !important;
            border-radius: 3px !important;
        }

        #topcontrol:after {
            /*top: -2px;*/
            left: 8.5px;
            content: "\f106";
            position: absolute;
            text-align: center;
            font-family: FontAwesome;
        }

        #topcontrol:hover {
            color: #fff;
            background: #18ba9b;
            -webkit-transition: all 0.3s ease-in-out;
            -moz-transition: all 0.3s ease-in-out;
            -o-transition: all 0.3s ease-in-out;
            transition: all 0.3s ease-in-out;
        }

    </style>
</head>
<body>
<div class="navbar-wrapper">
    <div class="container">
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand" th:href="@{/}" style="font-size:32px;">å°šç­¹ç½‘-åˆ›æ„äº§å“ä¼—ç­¹å¹³å°</a>
                </div>
                <div id="navbar" class="navbar-collapse collapse" style="float:right;">
                    <ul class="nav navbar-nav">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i
                                    class="glyphicon glyphicon-user"></i> [[${session.loginMember.username}]]<span
                                    class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="member.html"><i class="glyphicon glyphicon-scale"></i> ä¼šå‘˜ä¸­å¿ƒ</a></li>
                                <li><a href="#"><i class="glyphicon glyphicon-comment"></i> æ¶ˆæ¯</a></li>
                                <li class="divider"></li>
                                <li><a href="index.html"><i class="glyphicon glyphicon-off"></i> é€€å‡ºç³»ç»Ÿ</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

    </div>
</div>
<div class="container">
    <div class="row clearfix">
        <div class="col-sm-3 col-md-3 column">
            <div class="row">
                <div class="col-md-12">
                    <div class="thumbnail" style="    border-radius: 0px;">
                        <img src="img/services-box1.jpg" class="img-thumbnail" alt="">
                        <div class="caption" style="text-align:center;">
                            <h3>
                                [[${session.loginMember.username}]]
                            </h3>
                            <span class="label label-danger" style="cursor:pointer;"
                                  onclick="window.location.href='accttype.html'">æœªå®åè®¤è¯</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="list-group">
                <div class="list-group-item active">
                    èµ„äº§æ€»è§ˆ<span class="badge"><i class="glyphicon glyphicon-chevron-right"></i></span>
                </div>
                <div class="list-group-item " style="cursor:pointer;"
                     onclick="window.location.href='minecrowdfunding.html'">
                    æˆ‘çš„ä¼—ç­¹<span class="badge"><i class="glyphicon glyphicon-chevron-right"></i></span>
                </div>
            </div>
        </div>
        <div class="col-sm-9 col-md-9 column">
            <blockquote style="border-left: 5px solid #f60;color:#f60;padding: 0 0 0 20px;">
                <b>
                    æˆ‘çš„é’±åŒ…
                </b>
            </blockquote>
            <div id="main" style="width: 600px;height:400px;"></div>
            <blockquote style="border-left: 5px solid #f60;color:#f60;padding: 0 0 0 20px;">
                <b>
                    ç†è´¢
                </b>
            </blockquote>
            <div id="main1" style="width: 600px;height:400px;"></div>
            <blockquote style="border-left: 5px solid #f60;color:#f60;padding: 0 0 0 20px;">
                <b>
                    æ¯”ä¾‹
                </b>
            </blockquote>
            <div id="main2" style="width: 600px;height:400px;"></div>
        </div>
    </div>
</div>
<div class="container" style="margin-top:20px;">
    <div class="row clearfix">
        <div class="col-md-12 column">
            <div id="footer">
                <div class="footerNav">
                    <a rel="nofollow" href="http://www.atguigu.com">å…³äºæˆ‘ä»¬</a> | <a rel="nofollow"
                                                                                  href="http://www.atguigu.com">æœåŠ¡æ¡æ¬¾</a>
                    | <a rel="nofollow" href="http://www.atguigu.com">å…è´£å£°æ˜</a> | <a rel="nofollow"
                                                                                    href="http://www.atguigu.com">ç½‘ç«™åœ°å›¾</a>
                    | <a rel="nofollow" href="http://www.atguigu.com">è”ç³»æˆ‘ä»¬</a>
                </div>
                <div class="copyRight">
                    Copyright ?2017-2017atguigu.com ç‰ˆæƒæ‰€æœ‰
                </div>
            </div>

        </div>
    </div>
</div>

<script>
    $('#myTab a').click(function (e) {
        e.preventDefault()
        $(this).tab('show')
    })
    $('#myTab1 a').click(function (e) {
        e.preventDefault()
        $(this).tab('show')
    })

    var myChart = echarts.init(document.getElementById('main'));

    // æŒ‡å®šå›¾è¡¨çš„é…ç½®é¡¹å’Œæ•°æ®
    option = {
        title: {
            text: 'ä¸ƒæ—¥å¹´åŒ–æ”¶ç›Šç‡(%)'
        },
        tooltip: {
            trigger: 'axis'
        },
        legend: {
            data: ['åŸºé‡‘', 'è‚¡ç¥¨']
        },
        toolbox: {
            show: false,
            feature: {
                dataZoom: {
                    yAxisIndex: 'none'
                },
                dataView: {readOnly: false},
                magicType: {type: ['line', 'bar']},
                restore: {},
                saveAsImage: {}
            }
        },
        xAxis: {
            type: 'category',
            boundaryGap: false,
            data: ['2017-05-16', '2017-05-17', '2017-05-18', '2017-05-19', '2017-05-20', '2017-05-21', '2017-05-22']
        },
        yAxis: {
            type: 'value',
            axisLabel: {
                formatter: '{value} '
            }
        },
        series: [
            {
                name: 'åŸºé‡‘',
                type: 'line',
                data: [1, 1, 5, 3, 2, 3, 2],
                markPoint: {
                    data: [
                        {type: 'max', name: 'æœ€å¤§å€¼'},
                        {type: 'min', name: 'æœ€å°å€¼'}
                    ]
                },
                markLine: {
                    data: [
                        {type: 'average', name: 'å¹³å‡å€¼'}
                    ]
                }
            },
            {
                name: 'è‚¡ç¥¨',
                type: 'line',
                data: [1, -2, 2, 5, 3, 2, 4],
                markPoint: {
                    data: [
                        {name: 'å‘¨æœ€ä½', value: -2, xAxis: 1, yAxis: -1.5}
                    ]
                },
                markLine: {
                    data: [
                        {type: 'average', name: 'å¹³å‡å€¼'},
                        [{
                            symbol: 'none',
                            x: '90%',
                            yAxis: 'max'
                        }, {
                            symbol: 'circle',
                            label: {
                                normal: {
                                    position: 'start',
                                    formatter: 'æœ€å¤§å€¼'
                                }
                            },
                            type: 'max',
                            name: 'æœ€é«˜ç‚¹'
                        }]
                    ]
                }
            }
        ]
    };
    myChart.setOption(option);
    var myChart1 = echarts.init(document.getElementById('main1'));

    // æŒ‡å®šå›¾è¡¨çš„é…ç½®é¡¹å’Œæ•°æ®
    option1 = {
        color: ['#3398DB'],
        tooltip: {
            trigger: 'axis',
            axisPointer: {            // åæ ‡è½´æŒ‡ç¤ºå™¨ï¼Œåæ ‡è½´è§¦å‘æœ‰æ•ˆ
                type: 'shadow'        // é»˜è®¤ä¸ºç›´çº¿ï¼Œå¯é€‰ä¸ºï¼š'line' | 'shadow'
            }
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        xAxis: [
            {
                type: 'category',
                data: ['åŸºé‡‘', 'ç¥¨æ®', 'å®šæœŸç†è´¢', 'å˜ç°è´·'],
                axisTick: {
                    alignWithLabel: true
                }
            }
        ],
        yAxis: [
            {
                type: 'value'
            }
        ],
        series: [
            {
                name: 'ç›´æ¥è®¿é—®',
                type: 'bar',
                barWidth: '60%',
                data: [10, 52, 200, 334, 390, 330, 220]
            }
        ]
    };

    // ä½¿ç”¨åˆšæŒ‡å®šçš„é…ç½®é¡¹å’Œæ•°æ®æ˜¾ç¤ºå›¾è¡¨ã€‚
    myChart1.setOption(option1);

    var myChart2 = echarts.init(document.getElementById('main2'));

    // æŒ‡å®šå›¾è¡¨çš„é…ç½®é¡¹å’Œæ•°æ®
    option2 = {
        title: {
            text: 'æŸç«™ç‚¹ç”¨æˆ·è®¿é—®æ¥æº',
            subtext: 'çº¯å±è™šæ„',
            x: 'center'
        },
        tooltip: {
            trigger: 'item',
            formatter: "{a} <br/>{b} : {c} ({d}%)"
        },
        legend: {
            orient: 'vertical',
            left: 'left',
            data: ['ç›´æ¥è®¿é—®', 'é‚®ä»¶è¥é”€', 'è”ç›Ÿå¹¿å‘Š', 'è§†é¢‘å¹¿å‘Š', 'æœç´¢å¼•æ“']
        },
        series: [
            {
                name: 'è®¿é—®æ¥æº',
                type: 'pie',
                radius: '55%',
                center: ['50%', '60%'],
                data: [
                    {value: 335, name: 'ç›´æ¥è®¿é—®'},
                    {value: 310, name: 'é‚®ä»¶è¥é”€'},
                    {value: 234, name: 'è”ç›Ÿå¹¿å‘Š'},
                    {value: 135, name: 'è§†é¢‘å¹¿å‘Š'},
                    {value: 1548, name: 'æœç´¢å¼•æ“'}
                ],
                itemStyle: {
                    emphasis: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            }
        ]
    };

    // ä½¿ç”¨åˆšæŒ‡å®šçš„é…ç½®é¡¹å’Œæ•°æ®æ˜¾ç¤ºå›¾è¡¨ã€‚
    myChart2.setOption(option2);
</script>
</body>
</html>
```



## 2. ä¼šå‘˜é€€å‡ºç™»å½•

### 2.1 `auth` å·¥ç¨‹

#### 2.1.1 ä¿®æ”¹ä»£ç `member-conter.html`

```html
<!--<li><a href="index.html"><i class="glyphicon glyphicon-off"></i> é€€å‡ºç³»ç»Ÿ</a></li>-->
<li><a th:href="@{/auth/member/logout}"><i class="glyphicon glyphicon-off"></i> é€€å‡ºç³»ç»Ÿ</a></li>
```



#### 2.1.2 è¿½åŠ ä»£ç  `MemberHandler`

```java
/**
 * é€€å‡ºç™»å½•
 * 
 * @param session
 * @return
 */
@RequestMapping("/auth/member/logout")
public String logout(HttpSession session) {

    session.invalidate();

    return "redirect:/";
}
```



## 3. çŸ¥è¯†ç‚¹: Session å…±äº«, è§£å†³ Session ä¸äº’é€šçš„é—®é¢˜

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661512959472-2c320b0f-fa66-49a7-b6ef-2c79c3ac8131.png)

- åœ¨åˆ†å¸ƒå¼å’Œé›†ç¾¤ç¯å¢ƒä¸‹,  æ¯ä¸ªå…·ä½“æ¨¡å—è¿è¡Œåœ¨å•ç‹¬çš„ Tomcat ä¸Š, è€Œ Session æ˜¯è¢«ä¸åŒ Tomcat æ‰€ "åŒºéš”" çš„, æ‰€ä»¥ä¸èƒ½äº’é€š, ä¼šå¯¼è‡´ç¨‹åºè¿è¡Œæ—¶, ç”¨æˆ·ä¼šè¯å‘ç”Ÿé”™è¯¯

    - æœ‰çš„æœåŠ¡å™¨ä¸Šæœ‰, æœ‰çš„æœåŠ¡å™¨ä¸Šæ²¡æœ‰

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661514510084-6df436b4-7639-49f6-ba64-5b695c7f1e5e.png)

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661514533002-7fbb4bb6-851d-41c1-84c5-3158fd1f0c62.png)

### 3.1 ä¼šè¯æ§åˆ¶å›é¡¾

- æµè§ˆå™¨: å‘é€ `Cookie` æ•°æ®
- æœåŠ¡å™¨: è§£æ `Cookie` æ•°æ®
- æœåŠ¡å™¨: æŸ¥æ‰¾å¯¹åº”çš„ `Session`, å¦‚æœæ²¡æœ‰åˆ™æ–°å»º
- æœåŠ¡å™¨: æŠŠæ–°å»ºçš„ `Session` å­˜å…¥ `Redis`

========= ========

- æµè§ˆå™¨: è¯·æ±‚è¦æ±‚åœ¨åŸæœ‰çš„ `Session` ä¸­å­˜å…¥æ–°æ•°æ®
- æœåŠ¡å™¨: æ ¹æ® `Cookie` æŠŠæ—§çš„ `Session` æ‰¾åˆ°, å­˜å…¥æ•°æ®, å­˜å› Redis



#### 3.1.1 Cookie çš„å·¥ä½œæœºåˆ¶

- æœåŠ¡å™¨ç«¯è¿”å› `Cookie` ä¿¡æ¯ç»™æµè§ˆå™¨

    - `Java` ä»£ç : `response.addCookie(cookie å¯¹è±¡);`
    - `Http` å“åº”æ¶ˆæ¯å¤´: `Set-Cookie`: `Cookie` çš„åå­— = `Cookie` çš„å€¼, æµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡å™¨ç«¯è¿”å›çš„ `Cookie`, ä»¥åçš„æ¯ä¸€æ¬¡è¯·æ±‚éƒ½ä¼šæŠŠ `Cookie` å¸¦ä¸Š
    - Http è¯·æ±‚æ¶ˆæ¯å¤´: `Cookie`: `Cookie` çš„åå­— = `Cookie` çš„å€¼



#### 3.1.2 Session çš„å·¥ä½œæœºåˆ¶

- è·å– `Session` å¯¹è±¡:` request.getSession();`

    - æ£€æŸ¥å½“å‰è¯·æ±‚æ˜¯å¦æºå¸¦äº† `JSESSIONID` è¿™ä¸ª `Cookie`

        - å¸¦äº†: æ ¹æ®è¿™ä¸ª `JSESSIONID` åœ¨æœåŠ¡å™¨ç«¯æŸ¥æ‰¾å¯¹åº”çš„ `Session` å¯¹è±¡

            - èƒ½æ‰¾åˆ°: å°±æŠŠæ‰¾åˆ°çš„ `Seesion` å¯¹è±¡è¿”å›
            - æ²¡æ‰¾åˆ°: æ–°å»º `Session` å¯¹è±¡è¿”å›, åŒæ—¶è¿”å› `JSESSIONID` çš„ `Cookie`

        - æ²¡å¸¦: æ–°å»º `Session` å¯¹è±¡è¿”å›, åŒæ—¶è¿”å› `JSESSIONID` çš„ `Cookie`



### 3.2 è§£å†³æ–¹æ¡ˆæ¢ç´¢

#### 3.2.1 Session åŒæ­¥

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661514573168-4b3e0b73-8e36-4e2b-bb18-aedb5fbf8c9d.png)![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661514589044-b0761750-12b5-478f-80cc-14ca350a0d0c.png)

- é—®é¢˜1: é€ æˆ `Session` åœ¨å„ä¸ªæœåŠ¡å™¨ä¸Š "åŒé‡" ä¿å­˜

    - `TomcatA` ä¿å­˜äº† 1G çš„ `Session` æ•°æ®, `TomcatB` ä¹Ÿéœ€è¦ä¿å­˜ 1G çš„ `Session` æ•°æ®
    - æ•°æ®é‡å¤ªå¤§çš„ä¼šå¯¼è‡´ `Tomcat` æ€§èƒ½ä¸‹é™

- é—®é¢˜2: æ•°æ®åŒæ­¥å¯¹æ€§èƒ½æœ‰ä¸€å®šå½±å“
- é—®é¢˜3: å¯¹åº”é›†ç¾¤å¤–çš„æœåŠ¡å™¨æ— æ•ˆ



#### 3.2.2 å°† `Session` æ•°æ®å­˜å‚¨åœ¨ `Cookie` ä¸­

- åšæ³•: æ‰€æœ‰ä¼šè¯æ•°æ®åœ¨æµè§ˆå™¨ç«¯ä½¿ç”¨ `Cookie` ä¿å­˜, æœåŠ¡å™¨ç«¯ä¸å­˜å‚¨å¦‚ä½•ä¼šè¯æ‰‹æœº

    - å¥½å¤„: æœåŠ¡å™¨ç«¯å¤§å¤§å‡è½»äº†æ•°æ®å­˜å‚¨çš„å‹åŠ›ã€‚ä¸ä¼šæœ‰ `Session` ä¸ä¸€è‡´çš„é—®é¢˜
    - ç¼ºç‚¹:

        - `Cookie` èƒ½å¤Ÿå­˜å‚¨çš„æ•°æ®éå¸¸æœ‰é™ã€‚ä¸€èˆ¬æ˜¯ 4KBã€‚ä¸èƒ½å­˜å‚¨ä¸°å¯Œçš„æ•°æ®
        - `Cookie` æ•°æ®åœ¨æµè§ˆå™¨ç«¯å­˜å‚¨, å¾ˆå¤§ç¨‹åº¦ä¸Šä¸å—æœåŠ¡å™¨ç«¯çš„æ§åˆ¶, å¦‚æœæµè§ˆå™¨ç«¯æ¸…ç† `Cookie`, ç›¸å…³æ•°æ®ä¼šä¸¢å¤±



#### 3.2.3 åå‘ä»£ç† `hash` ä¸€è‡´æ€§

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661515160158-b2f4d58a-0d86-4c34-ae32-29b465222cd1.png)

- é—®é¢˜1: å…·ä½“ä¸€ä¸ªæµè§ˆå™¨, ä¸“é—¨è®¿é—®æŸä¸€ä¸ªå…·ä½“æœåŠ¡å™¨, å¦‚æœæµè§ˆå™¨å®•æœº, ä¼šä¸¢å¤±æ•°æ®ã€‚å­˜åœ¨å•ç‚¹æ•…éšœé£é™©
- é—®é¢˜2: ä»…ä»…é€‚ç”¨äºé›†ç¾¤èŒƒå›´å†…, è¶…å‡ºé›†ç¾¤èŒƒå›´, è´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ— æ•ˆ



#### 3.2.4 åç«¯ç»Ÿä¸€å­˜å‚¨ Session æ•°æ®

- åç«¯å­˜å‚¨ Session æ•°æ®æ—¶, ä¸€èˆ¬éœ€è¦ä½¿ç”¨ Redis è¿™æ ·çš„å†…å­˜æ•°æ®åº“ï¼Œè€Œä¸€èˆ¬ä¸é‡‡ç”¨ MySQL è¿™æ ·çš„å…³ç³»å‹æ•°æ®åº“ã€‚åŸå› å¦‚ä¸‹

    - Session æ•°æ®å­˜å–æ¯”è¾ƒé¢‘ç¹ã€‚å†…å­˜è®¿é—®é€Ÿåº¦å¿«
    - Session æœ‰è¿‡æœŸæ—¶é—´, Redis è¿™æ ·çš„å†…å­˜æ•°æ®åº“èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿å®ç°è¿‡æœŸé‡Šæ”¾

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661515652333-64a76e2d-ec08-4925-8421-60f8b830804e.png)

- ä¼˜ç‚¹:

    - è®¿é—®é€Ÿåº¦æ¯”è¾ƒå¿«ã€‚è™½ç„¶éœ€è¦ç»è¿‡ç½‘ç»œè®¿é—®, ä½†æ˜¯ç°åœ¨ç¡¬ä»¶æ¡ä»¶å·²ç»èƒ½å¤Ÿè¾¾åˆ°ç½‘ç»œè®¿é—®æ¯”ç¡¬ç›˜è®¿é—®è¿˜è¦å¿«

        - ç¡¬ç›˜è®¿é—®é€Ÿåº¦: 200M/s
        - ç½‘ç»œè®¿é—®é€Ÿåº¦: 1G/s

    - Redis å¯ä»¥é…ç½®ä¸»ä»å¤åˆ¶é›†ç¾¤, ä¸æ‹…å¿ƒå•ç‚¹æ•…éšœ



### 3.3 `SpringSession` ä½¿ç”¨

- è£…é¥°æ¨¡å¼
- `SpringSession` ä½¿å¾—æ”¯æŒé›†ç¾¤ä¼šè¯å˜å¾—å¾®ä¸è¶³é“ï¼Œè€Œæ— éœ€ç»‘å®šåˆ°åº”ç”¨ç¨‹åºå®¹å™¨ç‰¹å®šçš„è§£å†³æ–¹æ¡ˆ
- ä»¥ä¸‹æ–‡æ¡£é’ˆå¯¹åœ¨ `SpringBoot` ç¯å¢ƒä¸‹ä½¿ç”¨
- å®ç°è·¨é¡¹ç›®å­˜å– Session

    - ç‹¬ç«‹é¡¹ç›®æµ‹è¯•ä½¿ç”¨
    - `pro18-spring-session-a` å­˜

        - ç«¯å£ 8181

    - `pro18-spring-session-b` å–

        - ç«¯å£ 8182

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661562452557-a4def515-53a9-4974-972d-387a2df677af.png)

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661562486613-e72c7a45-663f-4a40-b18c-3b56142e5b51.png)



![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661562475253-0123cd9b-2e29-48d1-8f97-dc590cb7db6b.png)

#### 3.3.1 å…±åŒä»£ç 

##### 3.3.1.1 å¼•å…¥ä¾èµ–

```xml
çˆ¶å¼•ç”¨ springboot
<dependencies>
  <dependency>  
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
  </dependency>
  <!-- å¼•å…¥ SpringBoot & Redis åœºæ™¯ -->
  <dependency>  
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
  </dependency>
  <!-- å¼•å…¥ SpringBoot & SpringSeesion åœºæ™¯ -->
  <dependency>  
    <groupId>org.springframework.session</groupId>
    <artifactId>spring-session-data-redis</artifactId>
  </dependency>
</dependencies>
```



##### 3.3.1.2 æ–°å»º `MainClass` ä¸»å¯åŠ¨ç±»

```java
@SpringBootApplication
public class MainClass {

    public static void main(String[] args) {
        SpringApplication.run(MainClass.class, args);
    }

}
```



##### 3.3.1.3 æ–°å»º `application.yml` é…ç½®

```yaml
server:
  port: 8181

# Redis é…ç½®
spring:
  redis:
    host: 127.0.0.1

# SpringSession é…ç½®
  session:
    store-type: redis
```

- æ³¨æ„: å­˜å…¥ `Session` åŸŸçš„å®ä½“ç±»å¯¹è±¡éœ€è¦æ”¯æŒåºåˆ—åŒ–



#### 3.3.2 `pro18-spring-session-a`

##### 3.3.2.1 æ–°å»º `HelloHandler` ç±»

```java
@RestController
public class HelloHandler {
    
   @RequestMapping("/test/spring/session")
   public String testSession(HttpSession session) {
       session.setAttribute("king", "hello-king");
       
       return "æ•°æ®å­˜å…¥ Session åŸŸ";
   }
   
}
```



#### 3.3.3 `pro18-spring-session-b`

##### 3.3.3.1 æ–°å»º`HelloHandler`ç±»

```java
@RestController
public class HelloHandler {
    
   @RequestMapping("/test/spring/session/retrieve")
   public String testSession(HttpSession session) {
       String value = session.getAttribute("king");
       
       return value;
   }
   
}
```



### 3.4 `SpringSession` åŸºæœ¬åŸç†

- æ¦‚å†µ: `SpringSession` ä»åº•å±‚å…¨æ–¹ä½"æ¥ç®¡"äº† `Tomcat` å¯¹ `Session` çš„ç®¡ç†

#### 3.4.1 `SpringSession` éœ€è¦å®Œæˆçš„ä»»åŠ¡

- åŒ…è£… `Request` å¯¹è±¡
- æ‰¾ `Session` çš„æ—¶å€™è®¿é—® `Redis` æ‰¾
- æ‰¾åˆ°åŒ…è£…ä»¥åå¾—  `Session`
- ä¼ ç»™ `Handler`

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661562248532-8636c529-6b69-41e3-95c8-5622afa8431d.png)



#### 3.4.2 `SessionRepositoryFilter`

- åˆ©ç”¨ Filter åŸç†, åœ¨æ¯æ¬¡è¯·æ±‚åˆ°è¾¾ç›®æ ‡æ–¹æ³•ä¹‹å‰, å°†åŸç”Ÿ `HttpSeesionRequest`/`HttpServletResponse` å¯¹è±¡åŒ…è£…æˆä¸º `SessoinRepositoryRequest`/`ResponseWrapper`
- åŒ…è£… `request` å¯¹è±¡æ—¶è¦åšåˆ°: åŒ…è£…åå’ŒåŒ…è£…å‰çš„**ç±»å‹å…¼å®¹**

    - æ‰€è°“ç±»å‹å…¼å®¹: "åŒ…è£…å¾—åˆ°çš„å¯¹è±¡ `instanceof` åŒ…è£…å‰ç±»å‹" è¿”å› `true`

- åªæœ‰åšåˆ°äº†ç±»å‹çš„å…¼å®¹, åé¢ä½¿ç”¨åŒ…è£…è¿‡çš„å¯¹è±¡æ‰èƒ½ä¿æŒä½¿ç”¨æ–¹æ³•ä¸å˜ã€‚

    - åŒ…è£…è¿‡çš„å¯¹è±¡ç±»å‹å…¼å®¹ã€ä½¿ç”¨æ–¹æ³•ä¸å˜, æ‰èƒ½å®ç° "å·æ¢æ¢æŸ±"

- ä½†æ˜¯å¦‚æœç›´æ¥å®ç° `HttpServletRequest` æ¥å£, æˆ‘ä»¬åˆçŸ¥é“å¦‚ä½•å®ç°å„ä¸ªæŠ½è±¡æ–¹æ³•

    - è¿™ä¸ªé—®é¢˜å¯ä»¥å€ŸåŠ©åŸå§‹è¢«åŒ…è£…çš„å¯¹è±¡æ¥è§£å†³

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661563117912-1161408d-478c-4841-96f9-11fd6d9b33ff.png)



## 4. æ˜Ÿå›¾/æ¶æ„å›¾

- å•ä¸€æ¶æ„

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661567926586-fc92341c-87aa-4487-9c4e-c39f58c1c430.png)

- åˆ†å¸ƒå¼æ¶æ„

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661568221042-fe361def-4fa5-4e74-a848-e0e23ff48873.png)



## 5. ç™»å½•æ£€æŸ¥

- æŠŠé¡¹ç›®ä¸­å¿…é¡»ç™»å½•æ‰èƒ½è®¿é—®çš„åŠŸèƒ½ä¿æŠ¤èµ·æ¥, å¦‚æœæ²¡æœ‰ç™»å½•å°±è®¿é—®åˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661569729881-d91ee6df-526d-4670-adff-0f4789518180.png)



### 5.1 ä»£ç : è®¾ç½® `Session` å…±äº«

#### 5.1.1 `zuulã€auth` å·¥ç¨‹

- è¿½åŠ ä¾èµ–

```xml
<!-- å¼•å…¥ SpringBoot & Redis åœºæ™¯ -->
<dependency>  
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>

<!-- å¼•å…¥ SpringBoot & SpringSession åœºæ™¯ -->
<dependency>  
  <groupId>org.springframework.session</groupId>
  <artifactId>spring-session-data-redis</artifactId>
</dependency>
```

- è¿½åŠ é…ç½®

```yaml
spring:
  redis:
    host: localhost
  session:
    store-type: redis
```



### 5.2 ä»£ç : å‡†å¤‡ä¸éœ€è¦ç™»å½•æ£€æŸ¥çš„èµ„æº

#### 5.2.1 æ–°å»º `AccessPassResources` ç±»

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661822425179-cc305e7e-eb17-4b6f-8e2f-7f898f653c69.png)

```java
package com.atguigu.crowd.constant;

import java.util.HashSet;
import java.util.Set;

/**
 * ç‰¹å®šè¯·æ±‚åœ°å€å’Œé™æ€èµ„æº
 *
 * @author é™ˆæ±Ÿæ—
 * @date 2022/8/30 09:19
 */
public class AccessPassResources {

    public static final Set<String> PASS_RES_SET = new HashSet<>();

    static {
        PASS_RES_SET.add("/");
        PASS_RES_SET.add("/auth/member/to/reg/page");
        PASS_RES_SET.add("/auth/member/to/login/page");
        PASS_RES_SET.add("/auth/member/logout");
        PASS_RES_SET.add("/auth/member/do/login");
        PASS_RES_SET.add("/auth/do/member/register");
        PASS_RES_SET.add("/auth/member/send/short/message.json");
    }

    public static final Set<String> STATIC_RES_SET = new HashSet<>();

    static {
        STATIC_RES_SET.add("bootstrap");
        STATIC_RES_SET.add("css");
        STATIC_RES_SET.add("fonts");
        STATIC_RES_SET.add("img");
        STATIC_RES_SET.add("jquery");
        STATIC_RES_SET.add("layer");
        STATIC_RES_SET.add("script");
        STATIC_RES_SET.add("ztree");
    }

    /**
     * ç”¨äºåˆ¤æ–­æŸä¸ª ServletPath å€¼æ˜¯å¦å¯¹åº”ä¸€ä¸ªé™æ€èµ„æº
     *
     * @param servletPath
     * @return true æ˜¯é™æ€èµ„æº false ä¸æ˜¯é™æ€èµ„æº
     */
    public static boolean judgeCurrentServletPathWetherStaticResource(String servletPath) {
        // 1. æ’é™¤å­—ç¬¦ä¸²æ— æ•ˆçš„æƒ…å†µ
        if (servletPath == null || servletPath.length() == 0) {
            throw new RuntimeException(CrowdConstant.MESSAGE_STRING_INVALIDATE);
        }

        // 2. æ ¹æ® "/" æ‹†åˆ† ServletPath å­—ç¬¦ä¸²
        String[] split = servletPath.split("/");

        // 3. è€ƒè™‘ç¬¬ä¸€ä¸ªæ–œæ å·¦è¾¹ç»è¿‡æ‹†åˆ†åå¾—åˆ°æœ‰ä¸ªç©ºå­—ç¬¦ä¸²æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ , æ‰€ä»¥éœ€è¦ä½¿ç”¨ä¸‹æ ‡ 1 å–ç¬¬äºŒä¸ªå…ƒç´ 
        String firstLevelPath = split[1];

        // 4. åˆ¤æ–­æ˜¯å¦åœ¨è¿™ä¸ªé›†åˆä¸­
        return STATIC_RES_SET.contains(firstLevelPath);
    }

    public static void main(String[] args) {
        String servletPath = "/css/aaa/ccc";
        boolean result = judgeCurrentServletPathWetherStaticResource(servletPath);
        System.out.println(result);
    }

}
```



### 5.3 ä»£ç : `zuul` å·¥ç¨‹

- (å·²é…ç½®) é…ç½® `zuul.sensitive-headers: "*" `# åœ¨ zuul å‘å…¶ä»–å¾®æœåŠ¡é‡å®šå‘æ—¶ä¿æŒåŸæœ¬çš„å¤´ä¿¡æ¯ï¼ˆè¯·æ±‚å¤´ã€å“åº”å¤´ï¼‰



#### 5.3.1 æ–°å»º `CrowdAccessFilter` ç±»

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661823427261-a52e6cab-3061-489f-9c37-0350a4692914.png)

```java
package com.atguigu.crowd.filter;

import com.atguigu.crowd.constant.AccessPassResources;
import com.atguigu.crowd.constant.CrowdConstant;
import com.netflix.zuul.ZuulFilter;
import com.netflix.zuul.context.RequestContext;
import com.netflix.zuul.exception.ZuulException;
import org.springframework.stereotype.Component;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import java.io.IOException;

/**
 * @author é™ˆæ±Ÿæ—
 * @date 2022/8/30 09:24
 */
@Component
public class CrowdAccessFilter extends ZuulFilter {

    @Override
    public boolean shouldFilter() {
        // 1. è·å– RequestContext å¯¹è±¡
        RequestContext requestContext = RequestContext.getCurrentContext();

        // 2. é€šè¿‡ RequestContext å¯¹è±¡è·å–å½“å‰è¯·æ±‚å¯¹è±¡
        //ï¼ˆæ¡†æ¶åº•å±‚æ˜¯å€ŸåŠ© ThreadLocal ä»å½“å‰çº¿ç¨‹ä¸Šè·å–äº‹å…ˆç»‘å®šçš„ Request å¯¹è±¡ï¼‰
        HttpServletRequest request = requestContext.getRequest();

        // 3. è·å– ServletPath
        String servletPath = request.getServletPath();

        // 4. æ ¹æ® servletPath åˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦å¯¹åº”å¯ä»¥ç›´æ¥æ”¾è¡Œçš„ç‰¹å®šè¯·æ±‚
        boolean containsResult = AccessPassResources.PASS_RES_SET.contains(servletPath);
        if (containsResult) {
            // å¦‚æœå½“å‰è¯·æ±‚æ˜¯å¯ä»¥ç›´æ¥æ”¾è¡Œçš„ç‰¹å®šåŠŸèƒ½è¯·æ±‚åˆ™è¿”å› false æ”¾è¡Œ
            return false;
        }

        // åˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦ä¸ºé™æ€èµ„æº
        // å·¥å…·æ–¹æ³•è¿”å› true: è¯´æ˜å½“å‰è¯·æ±‚æ˜¯é™æ€èµ„æºè¯·æ±‚, å–åä¸º falseï¼ˆè¡¨ç¤ºæ”¾è¡Œä¸åšç™»å½•æ£€æŸ¥ï¼‰
        // å·¥å…·æ–¹æ³•è¿”å› false: è¡¨ç¤ºå½“å‰è¯·æ±‚è¡¨ç¤ºå¯ä»¥æ”¾è¡Œçš„ç‰¹å®šè¯·æ±‚ä¹Ÿä¸æ˜¯é™æ€èµ„æº, å–åä¸º trueï¼ˆè¡¨ç¤ºéœ€è¦åšç™»å½•æ£€æŸ¥ï¼‰
        return !AccessPassResources.judgeCurrentServletPathWetherStaticResource(servletPath);
    }

    /**
     * ç™»å½•æ£€æŸ¥
     *
     * @return
     * @throws ZuulException
     */
    @Override
    public Object run() throws ZuulException {
        // 1. è·å–å½“å‰è¯·æ±‚å¯¹è±¡
        RequestContext requestContext = RequestContext.getCurrentContext();
        HttpServletRequest request = requestContext.getRequest();

        // 2. è·å–å½“å‰ Session å¯¹è±¡
        HttpSession session = request.getSession();

        // 3. å°è¯•ä» Session å¯¹è±¡ä¸­è·å–å·²ç™»å½•çš„ç”¨æˆ·
        Object loginMember = session.getAttribute(CrowdConstant.ATTR_NAME_LOGIN_MEMBER);

        // 4. åˆ¤æ–­ loginMember æ˜¯å¦ä¸ºç©º
        if (loginMember == null) {
            // 5. æœªç™»å½•çŠ¶æ€, è·³è½¬è‡³ç™»å½•é¡µé¢
            // ä» requestContext å¯¹è±¡ä¸­è·å– Response å¯¹è±¡
            HttpServletResponse response = requestContext.getResponse();

            // 6. å°†æç¤ºæ¶ˆæ¯å­˜å…¥ Session åŸŸ
            session.setAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_ACCESS_FORBIDEN);

            // 7. é‡å®šå‘åˆ° auth å·¥ç¨‹ä¸­çš„ç™»å½•é¡µé¢
            try {
                response.sendRedirect("/auth/member/to/login/page");
            } catch (IOException e) {
                e.printStackTrace();
            }
        }

        return null;
    }

    @Override
    public String filterType() {
        // è¿™é‡Œè¿”å› pre æ„æ€æ˜¯åœ¨ç›®æ ‡å¾®æœåŠ¡å‰æ‰§è¡Œè¿‡æ»¤
        return "pre";
    }

    @Override
    public int filterOrder() {
        return 0;
    }

}
```



#### 5.3.2 è¿½åŠ ä¾èµ–

```xml
<!-- ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨å·¥å…·ç±» -->
<dependency>
    <groupId>com.atguigu.crowd</groupId>
    <artifactId>atcrowdfunding05-common-util</artifactId>
    <version>1.0-SNAPSHOT</version>
</dependency>

<!-- ä¸ºèƒ½å¤Ÿä½¿ç”¨å®ä½“ç±» -->
<dependency>
    <groupId>com.atguigu.crowd</groupId>
    <artifactId>atcrowdfunding09-member-entity</artifactId>
    <version>1.0-SNAPSHOT</version>
</dependency>
```



### 5.4 `auth` å·¥ç¨‹

#### 5.4.1 è¿½åŠ ä»£ç  `member-login.html`

```html
<p th:text="${session.message}">è¿™é‡Œæ˜¾ç¤ºçš„æ˜¯ç™»å½•æ£€æŸ¥åå‘ç°ä¸å…è®¸è®¿é—®æ—¶çš„æç¤ºæ¶ˆæ¯</p>
```



## 6 ä¿®æ”¹é‡å®šå‘åœ°å€, ä½¿ç”¨ `zuul`

### 6.1 å› ä¸º `Cookie` é—®é¢˜ä¸èƒ½ä½¿ç”¨é‡å®šå‘è·¨é¡¹ç›®è·³è½¬, æ‰€ä»¥é›†ä¸­è®¿é—® `zuul` æ¥è¿›è¡Œé‡å®šå‘

- æè¿°é—®é¢˜: `http://localhost:4000` å’Œ `http://localhost:80` æ˜¯ä¸¤ä¸ªä¸åŒçš„ç½‘ç«™, æµè§ˆå™¨å·¥ä½œæ—¶ä¸ä¼šä½¿ç”¨ç›¸åŒ `Cookie`
- è§£å†³: é‡å®šå‘çš„åœ°å€éƒ½æŒ‰ç…§é€šè¿‡ `Zuul` è®¿é—®çš„æ–¹å¼å†™åœ°å€



1. è¿½åŠ ä»£ç  `CrowdConstant` å­˜å‚¨åœ°å€ ã€`common` å·¥ç¨‹ã€‘

```java
public static final String ZUUL_PATH_VALUE = "http://localhost";
```

1. ä¿®æ”¹ `redirect` ä»£ç  `MemberHandler`ã€`auth` å·¥ç¨‹ã€‘

```java
package com.atguigu.crowd.handler;

import com.atguigu.crowd.api.MySQLRemoteService;
import com.atguigu.crowd.api.RedisRemoteService;
import com.atguigu.crowd.config.ShortMessageProperties;
import com.atguigu.crowd.constant.CrowdConstant;
import com.atguigu.crowd.entity.po.MemberPO;
import com.atguigu.crowd.entity.vo.MemberLoginVO;
import com.atguigu.crowd.entity.vo.MemberVO;
import com.atguigu.crowd.util.CrowdUtil;
import com.atguigu.crowd.util.ResultEntity;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import javax.servlet.http.HttpSession;
import java.util.Objects;
import java.util.concurrent.TimeUnit;

/**
 * @author é™ˆæ±Ÿæ—
 * @date 2022/8/29 11:21
 */
@Controller
public class MemberHandler {

    @Autowired
    private ShortMessageProperties shortMessageProperties;

    @Autowired
    private RedisRemoteService redisRemoteService;

    @Autowired
    private MySQLRemoteService mySQLRemoteService;

    /**
     * é€€å‡ºç™»å½•
     *
     * @param session
     * @return
     */
    @RequestMapping("/auth/member/logout")
    public String logout(HttpSession session) {

        session.invalidate();

        return "redirect:" + CrowdConstant.ZUUL_PATH_VALUE + "/";
    }

    /**
     * ä¼šå‘˜ç™»å½•
     *
     * @param loginacct è´¦æˆ·
     * @param userpswd  å¯†ç 
     * @param modelMap
     * @param session
     * @return
     */
    @RequestMapping("/auth/member/do/login")
    public String doLogin(
            @RequestParam("loginacct") String loginacct,
            @RequestParam("userpswd") String userpswd,
            ModelMap modelMap,
            HttpSession session) {
        ResultEntity<MemberPO> resultEntity = mySQLRemoteService.getMemberPOByLoginAcctRemote(loginacct);
        if (ResultEntity.FAILED.equals(resultEntity.getResult())) {
            modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, resultEntity.getMessage());
            return "member-login";
        }

        MemberPO memberPO = resultEntity.getData();
        if (memberPO == null) {
            modelMap.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_LOGIN_FAILED);
            return "member-login";
        }

        // 2. æ¯”è¾ƒå¯†ç 
        String userpswdDataBase = memberPO.getUserpswd();

        BCryptPasswordEncoder bCryptPasswordEncoder = new BCryptPasswordEncoder();
        bCryptPasswordEncoder.matches(userpswd, userpswdDataBase);

        // 3. åˆ›å»º MemberLoginVO å¯¹è±¡ä¼ å…¥ Session åŸŸ
        MemberLoginVO memberLoginVO = new MemberLoginVO(memberPO.getId(), memberPO.getUsername(), memberPO.getEmail());
        // ATTR_NAME_LOGIN_MEMBER = loginMember
        session.setAttribute(CrowdConstant.ATTR_NAME_LOGIN_MEMBER, memberLoginVO);

        return "redirect:" + CrowdConstant.ZUUL_PATH_VALUE + "/auth/member/to/conter/page";
    }

    /**
     * æ‰§è¡Œæ³¨å†Œ
     *
     * @param memberVO
     * @param modelMape
     * @return
     */
    @RequestMapping("/auth/do/member/register")
    public String register(MemberVO memberVO, ModelMap modelMape) {
        // 1. è·å–ç”¨æˆ·è¾“å…¥çš„æ‰‹æœºå·ç 
        String phoneNum = memberVO.getPhoneNum();

        // 2. æ‹¼ Redis ä¸­å­˜å‚¨éªŒè¯ç çš„ Key
        String key = CrowdConstant.REDIS_CODE_PREFIX + phoneNum;

        // 3. ä» Redis è¯»å– Key å¯¹åº”çš„ Value
        ResultEntity<String> resultEntity = redisRemoteService.getRedisKeyValueByKey(key);

        // 4. æ£€æŸ¥æŸ¥è¯¢æ“ä½œæ˜¯å¦æœ‰æ•ˆ
        String result = resultEntity.getResult();
        if (ResultEntity.FAILED.equals(result)) {
            modelMape.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, resultEntity.getMessage());
            return "member-reg";
        }

        String redisCode = resultEntity.getData();

        if (redisCode == null) {
            // MESSAGE_CODE_NOT_EXISTS = éªŒè¯ç å·²è¿‡æœŸ!è¯·æ£€æŸ¥æ‰‹æœºå·ç æ˜¯å¦æ­£ç¡®æˆ–é‡æ–°å‘é€!
            modelMape.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_CODE_NOT_EXISTS);
            return "member-reg";
        }

        // 5. å¦‚æœä» Redis èƒ½å¤ŸæŸ¥è¯¢åˆ° Value åˆ™æ¯”è¾ƒè¡¨å•çš„éªŒè¯ç å’Œ Redis çš„éªŒè¯ç 
        String formCode = memberVO.getCode();

        if (!Objects.equals(formCode, redisCode)) {
            // MESSAGE_CODE_INVALID = éªŒè¯ç ä¸æ­£ç¡®!
            modelMape.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_CODE_INVALID);
            return "member-reg";
        }

        // 6. å¦‚æœéªŒè¯ç ä¸€è‡´åˆ™ä» Redis åˆ é™¤
        redisRemoteService.removeRedisKeyRemote(key);

        // 7. æ‰§è¡Œå¯†ç åŠ å¯†
        BCryptPasswordEncoder bCryptPasswordEncoder = new BCryptPasswordEncoder();
        String userpswdBeforeEncode = memberVO.getUserpswd();
        String userpswdAfterEncode = bCryptPasswordEncoder.encode(userpswdBeforeEncode);

        memberVO.setUserpswd(userpswdAfterEncode);
        // 8. æ‰§è¡Œä¿å­˜
        // 8.1 åˆ›å»ºç©ºçš„ memberPO å¯¹è±¡
        MemberPO memberPO = new MemberPO();

        // 8.2 å¤åˆ¶å±æ€§
        BeanUtils.copyProperties(memberVO, memberPO);

        // 8.3 è°ƒç”¨è¿œç¨‹çš„æ–¹æ³•
        ResultEntity<String> saveMemberResultEntity = mySQLRemoteService.saveMember(memberPO);
        if (ResultEntity.FAILED.equals(saveMemberResultEntity.getResult())) {
            modelMape.addAttribute(CrowdConstant.ATTR_NAME_MESSAGE, saveMemberResultEntity.getMessage());
            return "member-reg";
        }

        // ä½¿ç”¨é‡å®šå‘é¿å…åˆ·æ–°æµè§ˆå™¨å¯¼è‡´é‡æ–°æ‰§è¡Œæ³¨å†Œæµç¨‹
        return "redirect:" + CrowdConstant.ZUUL_PATH_VALUE + "/auth/member/to/login/page";
    }

    /**
     * å‘é€çŸ­ä¿¡éªŒè¯ç 
     *
     * @param phoneNum æ‰‹æœºå·ç 
     * @return
     */
    @ResponseBody
    @RequestMapping("/auth/member/send/short/message.json")
    public ResultEntity<String> sendMessage(
            @RequestParam("phoneNum") String phoneNum) {
        try {
            // 1. å‘é€éªŒè¯ç 
            ResultEntity<String> sendMessageResultEntity = CrowdUtil.sendShortMessage(
                    shortMessageProperties.getAppCode(),
                    shortMessageProperties.getTemplateId(),
                    shortMessageProperties.getHost(),
                    shortMessageProperties.getPath(),
                    shortMessageProperties.getMethod(),
                    phoneNum
            );

            // 2. åˆ¤æ–­å‘é€ç»“æœ
            if (ResultEntity.SUCCESS.equals(sendMessageResultEntity.getResult())) {
                // 3. æˆåŠŸ: å°†éªŒè¯ç å­˜å…¥ Redis
                String code = sendMessageResultEntity.getData();
                String key = CrowdConstant.REDIS_CODE_PREFIX + phoneNum;
                ResultEntity<String> saveCodeResultEntity = redisRemoteService.setRedisKeyValueRemoteWithTimeout(key, code, 15, TimeUnit.MINUTES);
                if (ResultEntity.SUCCESS.equals(saveCodeResultEntity.getResult())) {
                    return ResultEntity.successWithoutData();
                } else {
                    return saveCodeResultEntity;
                }
            } else {
                return sendMessageResultEntity;
            }
        } catch (Exception e) {
            return ResultEntity.failed(e.getMessage());
        }
    }
}
```



### 6.2 å‰ç«¯é‡å®šå‘åœ°å€, ä½¿ç”¨ Session å…±äº«å­˜å‚¨ `zuul` åœ°å€è§£å†³

#### 6.2.1 é¡¹ç›®å¯åŠ¨è‡ªåŠ¨å­˜å‚¨ `zuul` åœ°å€

![img](https://cdn.nlark.com/yuque/0/2022/png/12811585/1661859079702-404e4150-be6c-49cb-bef0-8f5b1ddbd4f0.png)

```java
package com.atguigu.crowd.filter;

import com.atguigu.crowd.constant.AccessPassResources;
import com.atguigu.crowd.constant.CrowdConstant;
import com.netflix.zuul.ZuulFilter;
import com.netflix.zuul.context.RequestContext;
import com.netflix.zuul.exception.ZuulException;
import org.springframework.stereotype.Component;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;
import java.io.IOException;

/**
 * @author é™ˆæ±Ÿæ—
 * @date 2022/8/30 09:24
 */
@Component
public class CrowdAccessFilter extends ZuulFilter {

    @Override
    public boolean shouldFilter() {
        // 1. è·å– RequestContext å¯¹è±¡
        RequestContext requestContext = RequestContext.getCurrentContext();

        // 2. é€šè¿‡ RequestContext å¯¹è±¡è·å–å½“å‰è¯·æ±‚å¯¹è±¡
        //ï¼ˆæ¡†æ¶åº•å±‚æ˜¯å€ŸåŠ© ThreadLocal ä»å½“å‰çº¿ç¨‹ä¸Šè·å–äº‹å…ˆç»‘å®šçš„ Request å¯¹è±¡ï¼‰
        HttpServletRequest request = requestContext.getRequest();

        setSessionValue(request.getSession());

        // 3. è·å– ServletPath
        String servletPath = request.getServletPath();

        // 4. æ ¹æ® servletPath åˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦å¯¹åº”å¯ä»¥ç›´æ¥æ”¾è¡Œçš„ç‰¹å®šè¯·æ±‚
        boolean containsResult = AccessPassResources.PASS_RES_SET.contains(servletPath);
        if (containsResult) {
            // å¦‚æœå½“å‰è¯·æ±‚æ˜¯å¯ä»¥ç›´æ¥æ”¾è¡Œçš„ç‰¹å®šåŠŸèƒ½è¯·æ±‚åˆ™è¿”å› false æ”¾è¡Œ
            return false;
        }

        // åˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦ä¸ºé™æ€èµ„æº
        // å·¥å…·æ–¹æ³•è¿”å› true: è¯´æ˜å½“å‰è¯·æ±‚æ˜¯é™æ€èµ„æºè¯·æ±‚, å–åä¸º falseï¼ˆè¡¨ç¤ºæ”¾è¡Œä¸åšç™»å½•æ£€æŸ¥ï¼‰
        // å·¥å…·æ–¹æ³•è¿”å› false: è¡¨ç¤ºå½“å‰è¯·æ±‚è¡¨ç¤ºå¯ä»¥æ”¾è¡Œçš„ç‰¹å®šè¯·æ±‚ä¹Ÿä¸æ˜¯é™æ€èµ„æº, å–åä¸º trueï¼ˆè¡¨ç¤ºéœ€è¦åšç™»å½•æ£€æŸ¥ï¼‰
        return !AccessPassResources.judgeCurrentServletPathWetherStaticResource(servletPath);
    }

    /**
     * å­˜å‚¨ zuul åœ°å€
     *
     * @param session
     */
    public void setSessionValue(HttpSession session) {
        if (!(CrowdConstant.ZUUL_PATH_VALUE.equals(session.getAttribute(CrowdConstant.ZUUL_PATH_KEY)))) {
            session.setAttribute(CrowdConstant.ZUUL_PATH_KEY, CrowdConstant.ZUUL_PATH_VALUE);
        }
    }

    /**
     * ç™»å½•æ£€æŸ¥
     *
     * @return
     * @throws ZuulException
     */
    @Override
    public Object run() throws ZuulException {
        // 1. è·å–å½“å‰è¯·æ±‚å¯¹è±¡
        RequestContext requestContext = RequestContext.getCurrentContext();
        HttpServletRequest request = requestContext.getRequest();

        // 2. è·å–å½“å‰ Session å¯¹è±¡
        HttpSession session = request.getSession();

        // 3. å°è¯•ä» Session å¯¹è±¡ä¸­è·å–å·²ç™»å½•çš„ç”¨æˆ·
        Object loginMember = session.getAttribute(CrowdConstant.ATTR_NAME_LOGIN_MEMBER);

        // 4. åˆ¤æ–­ loginMember æ˜¯å¦ä¸ºç©º
        if (loginMember == null) {
            // 5. æœªç™»å½•çŠ¶æ€, è·³è½¬è‡³ç™»å½•é¡µé¢
            // ä» requestContext å¯¹è±¡ä¸­è·å– Response å¯¹è±¡
            HttpServletResponse response = requestContext.getResponse();

            // 6. å°†æç¤ºæ¶ˆæ¯å­˜å…¥ Session åŸŸ
            session.setAttribute(CrowdConstant.ATTR_NAME_MESSAGE, CrowdConstant.MESSAGE_ACCESS_FORBIDEN);

            // 7. é‡å®šå‘åˆ° auth å·¥ç¨‹ä¸­çš„ç™»å½•é¡µé¢
            try {
                response.sendRedirect("/auth/member/to/login/page");
            } catch (IOException e) {
                e.printStackTrace();
            }
        }

        return null;
    }

    @Override
    public String filterType() {
        // è¿™é‡Œè¿”å› pre æ„æ€æ˜¯åœ¨ç›®æ ‡å¾®æœåŠ¡å‰æ‰§è¡Œè¿‡æ»¤
        return "pre";
    }

    @Override
    public int filterOrder() {
        return 0;
    }

}
```





#### 6.2.2 è¿½åŠ ä»£ç  `CrowdConstant` ã€`common`å·¥ç¨‹ã€‘

```java
public static final String ZUUL_PATH_KEY = "zuulPath";
public static final String ZUUL_PATH_VALUE = "http://localhost";
```



#### 6.2.3 å‰ç«¯é‡å®šå‘å¯ä»¥ä½¿ç”¨ `${session.zuulPath}`è·å–åœ°å€

